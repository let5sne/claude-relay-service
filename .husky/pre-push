#!/usr/bin/env sh

# ä¿æŠ¤privateåˆ†æ”¯ï¼Œé˜²æ­¢æ„å¤–æ¨é€
while read local_ref local_sha remote_ref remote_sha; do
  if [ "$remote_ref" = "refs/heads/private" ]; then
    echo "âŒ é”™è¯¯ï¼šç¦æ­¢ç›´æ¥æ¨é€privateåˆ†æ”¯ï¼"
    echo "ğŸ’¡ è¿™æ˜¯ä½ çš„ç§æœ‰å•†ä¸šåŠŸèƒ½åˆ†æ”¯ï¼Œéœ€è¦æ˜ç¡®ç¡®è®¤åæ‰èƒ½æ¨é€ã€‚"
    echo ""
    echo "å¦‚æœä½ ç¡®å®éœ€è¦æ¨é€privateåˆ†æ”¯ï¼Œè¯·ä½¿ç”¨ï¼š"
    echo "  git push --no-verify origin private"
    echo ""
    exit 1
  fi
done

echo "Running local CI (backend) before push..."
npm run -s ci:backend || exit 1

# Optional frontend lint if dependencies already installed to keep hook fast
if [ -d "web/admin-spa/node_modules" ]; then
  echo "Running frontend lint..."
  (cd web/admin-spa && npm run -s lint) || exit 1
else
  echo "Skipping frontend lint (web/admin-spa/node_modules not found)."
  echo "Run 'npm run ci:frontend' manually for a full check."
fi
