import{r as _,q as z,x as r,y as l,z as t,K as F,aV as q,aT as E,P as a,Q as L,ac as B,C as T,c as H,L as V,O as I,aX as st,o as at,V as ot,_ as et,Y as X,aq as R,B as G,D as lt,I as J,S as tt,R as Y}from"./vue-vendor-Bsazo-x0.js";import{c as D,s as N,a as rt,_ as Q}from"./index-BxF-7946.js";import{C as it}from"./chart-D0-mP5KW.js";import{R as nt}from"./vendor-CrxIEVZC.js";import"./element-plus-DcHmMMW3.js";const dt={class:"cost-efficiency-analysis"},ut={class:"card p-6"},gt={class:"mb-6 flex items-center justify-between"},ct={class:"flex gap-3"},xt={key:0,class:"flex h-64 items-center justify-center"},pt={key:1},yt={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},mt={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},vt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},ft={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},bt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},kt={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},ht={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},_t={class:"overflow-x-auto"},$t={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},wt={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Ct={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},Pt={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},Ft={class:"rounded-full bg-blue-100 px-2 py-1 text-xs dark:bg-blue-900/30"},At={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},St={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Ut={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Tt={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Vt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Dt={key:2,class:"flex flex-col items-center justify-center py-12"},Rt={__name:"CostEfficiencyAnalysis",setup(A){const b=_(!1),n=_({range:"30d",platform:"all"}),h=_({}),g=_([]),o=m=>m>=1e6?(m/1e6).toFixed(2)+"M":m>=1e3?(m/1e3).toFixed(2)+"K":(m==null?void 0:m.toString())||"0",$=async()=>{var m,v;b.value=!0;try{const S={...n.value};console.log("ğŸ” Loading cost efficiency data with params:",S);const[x,s]=await Promise.all([D.get("/admin/dashboard/cost-efficiency/summary",{params:S}),D.get("/admin/dashboard/cost-efficiency/accounts",{params:{...S,limit:50}})]);console.log("ğŸ“Š Summary response:",x),console.log("ğŸ“‹ Accounts response:",s),x!=null&&x.success?(h.value=x.data||{},console.log("âœ… Summary data loaded:",h.value)):(console.warn("âš ï¸ Summary response missing success flag:",x),h.value={}),s!=null&&s.success?(g.value=((m=s.data)==null?void 0:m.items)||[],console.log("âœ… Accounts data loaded:",g.value.length,"items")):(console.warn("âš ï¸ Accounts response missing success flag:",s),g.value=[]),((v=x==null?void 0:x.data)==null?void 0:v.available)===!1&&N("æ•°æ®åº“æœªå¯ç”¨,æ— æ³•åŠ è½½ç»Ÿè®¡æ•°æ®","warning")}catch(S){console.error("âŒ Failed to load cost efficiency data:",S),N("åŠ è½½æ€§ä»·æ¯”æ•°æ®å¤±è´¥: "+(S.message||"æœªçŸ¥é”™è¯¯"),"error"),h.value={},g.value=[]}finally{b.value=!1}};return z(()=>{$()}),(m,v)=>{var S,x,s;return l(),r("div",dt,[t("div",ut,[t("div",gt,[v[4]||(v[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"è´¦æˆ·æ€§ä»·æ¯”å¯¹æ¯”"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," å¯¹æ¯”ä¸åŒè´¦æˆ·çš„æˆæœ¬æ•ˆç‡å’Œä½¿ç”¨æƒ…å†µ ")],-1)),t("div",ct,[F(t("select",{"onUpdate:modelValue":v[0]||(v[0]=e=>n.value.range=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:$},v[2]||(v[2]=[t("option",{value:"today"},"ä»Šæ—¥",-1),t("option",{value:"7days"},"7å¤©",-1),t("option",{value:"30d"},"30å¤©",-1),t("option",{value:"total"},"å…¨éƒ¨",-1)]),544),[[q,n.value.range]]),F(t("select",{"onUpdate:modelValue":v[1]||(v[1]=e=>n.value.platform=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:$},v[3]||(v[3]=[E('<option value="all">å…¨éƒ¨å¹³å°</option><option value="claude">Claude</option><option value="claude-console">Console</option><option value="gemini">Gemini</option><option value="openai">OpenAI</option>',5)]),544),[[q,n.value.platform]])])]),b.value?(l(),r("div",xt,v[5]||(v[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):g.value.length>0||h.value.totals?(l(),r("div",pt,[t("div",yt,[t("div",mt,[v[6]||(v[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»è´¦æˆ·æ•°",-1)),t("div",vt,a(((S=h.value.totals)==null?void 0:S.accountCount)||0),1)]),t("div",ft,[v[7]||(v[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¹³å‡æˆæœ¬/ç™¾ä¸‡Token",-1)),t("div",bt," $"+a((((x=h.value.totals)==null?void 0:x.costPerMillion)||0).toFixed(2)),1)]),t("div",kt,[v[8]||(v[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¹³å‡æˆåŠŸç‡",-1)),t("div",ht,a(((((s=h.value.totals)==null?void 0:s.successRate)||0)*100).toFixed(1))+"% ",1)])]),t("div",_t,[t("table",$t,[v[9]||(v[9]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è´¦æˆ· "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å¹³å° "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¯·æ±‚æ•° "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»æˆæœ¬ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æˆæœ¬/ç™¾ä¸‡Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æˆåŠŸç‡ ")])],-1)),t("tbody",wt,[(l(!0),r(L,null,B(g.value,e=>(l(),r("tr",{key:e.accountId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Ct,a(e.accountName),1),t("td",Pt,[t("span",Ft,a(e.platform),1)]),t("td",At,a(o(e.totalRequests)),1),t("td",St,a(o(e.totalTokens)),1),t("td",Ut," $"+a((e.totalCost||0).toFixed(6)),1),t("td",Tt," $"+a((e.costPerMillion||0).toFixed(2)),1),t("td",Vt,[t("span",{class:T(["rounded-full px-2 py-1 text-xs",e.successRate>=.95?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":e.successRate>=.8?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"])},a(((e.successRate||0)*100).toFixed(1))+"% ",3)])]))),128))])])])])):(l(),r("div",Dt,v[10]||(v[10]=[E('<div class="mb-4 text-6xl">ğŸ“Š</div><h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100">æš‚æ— æ•°æ®</h3><p class="mb-4 text-center text-sm text-gray-600 dark:text-gray-400"> å½“å‰æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°è´¦æˆ·ä½¿ç”¨æ•°æ® </p><div class="text-xs text-gray-500 dark:text-gray-500"><p>å¯èƒ½çš„åŸå› :</p><ul class="mt-2 list-inside list-disc space-y-1"><li>æ•°æ®åº“æœªå¯ç”¨æˆ–æœªé…ç½®</li><li>é€‰æ‹©çš„æ—¶é—´èŒƒå›´å†…æ²¡æœ‰ä½¿ç”¨è®°å½•</li><li>æ‰€æœ‰è´¦æˆ·éƒ½è¢«ç­›é€‰æ¡ä»¶æ’é™¤</li></ul></div>',4)])))])])}}},It={class:"api-key-breakdown-analysis"},qt={class:"card p-6"},Lt={class:"mb-6 flex items-center justify-between"},Mt={class:"flex gap-3"},Bt=["value"],Kt={key:0,class:"flex h-64 items-center justify-center"},jt={key:1,class:"flex h-64 flex-col items-center justify-center text-gray-500"},zt={key:2},Nt={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},Et={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Ot={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Qt={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Yt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Gt={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Ht={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Wt={class:"overflow-x-auto"},Xt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Zt={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Jt=["onClick"],te={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},ee={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},se={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},ae={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},oe={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},le={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},re={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},ie={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},ne={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},de={class:"bg-gray-50 px-4 py-4 dark:bg-gray-800/50",colspan:"9"},ue={key:0,class:"flex justify-center py-4"},ge={key:1,class:"space-y-2"},ce={class:"mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},xe={class:"max-h-96 overflow-y-auto"},pe={class:"min-w-full text-xs"},ye={class:"divide-y divide-gray-200 dark:divide-gray-600"},me={class:"px-3 py-2 text-gray-700 dark:text-gray-300"},ve={class:"px-3 py-2 text-gray-700 dark:text-gray-300"},fe={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},be={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},ke={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},he={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},_e={class:"px-3 py-2 text-right font-medium text-gray-900 dark:text-gray-100"},$e={class:"px-3 py-2 text-right font-medium text-gray-900 dark:text-gray-100"},we={class:"px-3 py-2 text-center"},Ce={key:0,class:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",title:"æ­¤è¯·æ±‚çš„ token æ•°æ®éœ€è¦äººå·¥æ ¸å¯¹"},Pe={key:1,class:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",title:"æ­¤è®°å½•å·²æ‰‹åŠ¨æ›´æ–°"},Fe={key:2,class:"rounded bg-green-100 px-2 py-1 text-xs text-green-800 dark:bg-green-900/30 dark:text-green-300"},Ae={key:2,class:"py-4 text-center text-sm text-gray-500"},Se={key:3,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Ue={__name:"ApiKeyBreakdownAnalysis",setup(A){const b=_(!1),n=_([]),h=_(""),g=_({range:"30d"}),o=_([]),$=_(new Set),m=_({}),v=_({}),S=H(()=>o.value.reduce((u,c)=>u+(c.requests||0),0)),x=H(()=>o.value.reduce((u,c)=>u+(c.totalCost||0),0)),s=u=>u>=1e6?(u/1e6).toFixed(2)+"M":u>=1e3?(u/1e3).toFixed(2)+"K":(u==null?void 0:u.toString())||"0",e=u=>{if(!u)return"-";const c=new Date(u);return Number.isNaN(c.getTime())?u:`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")} ${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}`},i=u=>{if(!u)return"-";const c=new Date(u);if(Number.isNaN(c.getTime()))return u;const C=String(c.getMonth()+1).padStart(2,"0"),M=String(c.getDate()).padStart(2,"0"),k=String(c.getHours()).padStart(2,"0"),P=String(c.getMinutes()).padStart(2,"0"),y=String(c.getSeconds()).padStart(2,"0");return`${C}-${M} ${k}:${P}:${y}`},w=async()=>{var u;try{console.log("ğŸ” Loading accounts for API key breakdown");const c=await D.get("/admin/dashboard/cost-efficiency/accounts",{params:{range:"30d",platform:"all",limit:100}});console.log("ğŸ“‹ Accounts response:",c),c!=null&&c.success&&((u=c==null?void 0:c.data)!=null&&u.items)?(n.value=c.data.items.map(C=>({id:C.accountId,name:C.accountName,platform:C.platform})),console.log("âœ… Accounts loaded:",n.value.length,"accounts")):(console.warn("âš ï¸ Accounts response missing data:",c),n.value=[])}catch(c){console.error("âŒ Failed to load accounts:",c),N("åŠ è½½è´¦æˆ·åˆ—è¡¨å¤±è´¥: "+(c.message||"æœªçŸ¥é”™è¯¯"),"error"),n.value=[]}},f=async()=>{if(!h.value){o.value=[];return}b.value=!0;try{console.log("ğŸ” Loading API key breakdown for account:",h.value);const u=await D.get(`/admin/accounts/${h.value}/usage-breakdown`,{params:{...g.value,limit:100}});console.log("ğŸ”‘ Breakdown response:",u),u!=null&&u.success?(o.value=u.items||[],console.log("âœ… Breakdown loaded:",o.value.length,"API keys"),$.value.clear(),v.value={}):(console.warn("âš ï¸ Breakdown response missing success flag:",u),o.value=[])}catch(u){console.error("âŒ Failed to load API key breakdown:",u),N("åŠ è½½ API Key æ˜ç»†å¤±è´¥: "+(u.message||"æœªçŸ¥é”™è¯¯"),"error"),o.value=[]}finally{b.value=!1}},p=async u=>{$.value.has(u)?($.value.delete(u),$.value=new Set($.value)):($.value.add(u),$.value=new Set($.value),await d(u))},d=async u=>{m.value[u]=!0;try{const c=await D.get(`/admin/api-keys/${u}/usage-details`,{params:{range:g.value.range,limit:50}});c.success&&(v.value[u]=c.items||[])}catch{N("åŠ è½½è¯·æ±‚è¯¦æƒ…å¤±è´¥","error"),v.value[u]=[]}finally{m.value[u]=!1}};return z(()=>{w()}),(u,c)=>(l(),r("div",It,[t("div",qt,[t("div",Lt,[c[4]||(c[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"API Key è°ƒç”¨æ˜ç»†"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," æŸ¥çœ‹æ¯ä¸ª API Key çš„è¯¦ç»†è°ƒç”¨ç»Ÿè®¡ ")],-1)),t("div",Mt,[F(t("select",{"onUpdate:modelValue":c[0]||(c[0]=C=>h.value=C),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:f},[c[2]||(c[2]=t("option",{value:""},"é€‰æ‹©è´¦æˆ·",-1)),(l(!0),r(L,null,B(n.value,C=>(l(),r("option",{key:C.id,value:C.id},a(C.name)+" ("+a(C.platform)+") ",9,Bt))),128))],544),[[q,h.value]]),F(t("select",{"onUpdate:modelValue":c[1]||(c[1]=C=>g.value.range=C),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:f},c[3]||(c[3]=[t("option",{value:"today"},"ä»Šæ—¥",-1),t("option",{value:"7days"},"7å¤©",-1),t("option",{value:"30d"},"30å¤©",-1),t("option",{value:"total"},"å…¨éƒ¨",-1)]),544),[[q,g.value.range]])])]),b.value?(l(),r("div",Kt,c[5]||(c[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):h.value?o.value.length>0?(l(),r("div",zt,[t("div",Nt,[t("div",Et,[c[7]||(c[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"API Key æ€»æ•°",-1)),t("div",Ot,a(o.value.length),1)]),t("div",Qt,[c[8]||(c[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»è¯·æ±‚æ•°",-1)),t("div",Yt,a(s(S.value)),1)]),t("div",Gt,[c[9]||(c[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»æˆæœ¬",-1)),t("div",Ht," $"+a(x.value.toFixed(6)),1)])]),t("div",Wt,[t("table",Xt,[c[12]||(c[12]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," API Key "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¯·æ±‚æ•° "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¾“å…¥Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¾“å‡ºToken "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ç¼“å­˜åˆ›å»º "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ç¼“å­˜è¯»å– "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»æˆæœ¬ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æœ€åä½¿ç”¨ ")])],-1)),t("tbody",Zt,[(l(!0),r(L,null,B(o.value,C=>{var M;return l(),r(L,{key:C.apiKeyId},[t("tr",{class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:k=>p(C.apiKeyId)},[t("td",te,[t("i",{class:T(["mr-2 text-xs text-gray-400",$.value.has(C.apiKeyId)?"fas fa-chevron-down":"fas fa-chevron-right"])},null,2),I(" "+a(C.apiKeyName),1)]),t("td",ee,a(s(C.requests)),1),t("td",se,a(s(C.inputTokens)),1),t("td",ae,a(s(C.outputTokens)),1),t("td",oe,a(s(C.cacheCreateTokens||0)),1),t("td",le,a(s(C.cacheReadTokens||0)),1),t("td",re,a(s(C.totalTokens)),1),t("td",ie," $"+a((C.totalCost||0).toFixed(6)),1),t("td",ne,a(e(C.lastUsedAt)),1)],8,Jt),$.value.has(C.apiKeyId)?(l(),r("tr",{key:`${C.apiKeyId}-details`},[t("td",de,[m.value[C.apiKeyId]?(l(),r("div",ue,c[10]||(c[10]=[t("div",{class:"loading-spinner h-8 w-8 border-4 border-indigo-500"},null,-1)]))):((M=v.value[C.apiKeyId])==null?void 0:M.length)>0?(l(),r("div",ge,[t("div",ce," è¯¦ç»†è¯·æ±‚è®°å½• (æœ€è¿‘ "+a(v.value[C.apiKeyId].length)+" æ¡) ",1),t("div",xe,[t("table",pe,[c[11]||(c[11]=t("thead",{class:"bg-gray-100 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left text-gray-600 dark:text-gray-300"}," æ—¶é—´ "),t("th",{class:"px-3 py-2 text-left text-gray-600 dark:text-gray-300"}," æ¨¡å‹ "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," è¾“å…¥ "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," è¾“å‡º "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," ç¼“å­˜åˆ›å»º "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," ç¼“å­˜è¯»å– "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," æ€»è®¡ "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," è´¹ç”¨ "),t("th",{class:"px-3 py-2 text-center text-gray-600 dark:text-gray-300"}," çŠ¶æ€ ")])],-1)),t("tbody",ye,[(l(!0),r(L,null,B(v.value[C.apiKeyId],k=>{var P,y;return l(),r("tr",{key:k.id,class:"hover:bg-gray-100 dark:hover:bg-gray-700"},[t("td",me,a(i(k.occurred_at)),1),t("td",ve,a(k.model),1),t("td",fe,a(k.input_tokens),1),t("td",be,a(k.output_tokens),1),t("td",ke,a(k.cache_create_tokens),1),t("td",he,a(k.cache_read_tokens),1),t("td",_e,a(k.total_tokens),1),t("td",$e," $"+a(parseFloat(k.total_cost||0).toFixed(6)),1),t("td",we,[(P=k.metadata)!=null&&P._no_usage_data?(l(),r("span",Ce," éœ€æ ¸å¯¹ ")):(y=k.metadata)!=null&&y._manually_updated?(l(),r("span",Pe," å·²æ›´æ–° ")):(l(),r("span",Fe," æ­£å¸¸ "))])])}),128))])])])])):(l(),r("div",Ae,"æš‚æ— è¯¦ç»†è®°å½•"))])])):V("",!0)],64)}),128))])])])])):(l(),r("div",Se,c[13]||(c[13]=[t("i",{class:"fas fa-inbox mb-4 text-4xl"},null,-1),t("p",null,"è¯¥è´¦æˆ·æš‚æ—  API Key è°ƒç”¨æ•°æ®",-1)]))):(l(),r("div",jt,c[6]||(c[6]=[t("i",{class:"fas fa-key mb-4 text-4xl"},null,-1),t("p",null,"è¯·é€‰æ‹©ä¸€ä¸ªè´¦æˆ·æŸ¥çœ‹ API Key è°ƒç”¨æ˜ç»†",-1)])))])]))}},Te={class:"cost-trends-analysis"},Ve={class:"card p-6"},De={class:"mb-6 flex items-center justify-between"},Re={class:"flex gap-3"},Ie={key:0,class:"flex h-64 items-center justify-center"},qe={key:1,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Le={key:2},Me={class:"mb-6 h-80"},Be={class:"grid grid-cols-1 gap-4 md:grid-cols-4"},Ke={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},je={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},ze={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Ne={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},Ee={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Oe={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},Qe={class:"rounded-lg bg-gradient-to-br from-orange-50 to-red-50 p-4 dark:from-orange-900/20 dark:to-red-900/20"},Ye={__name:"CostTrendsAnalysis",setup(A){const b=rt(),{isDarkMode:n}=st(b),h=_(!1),g=_(null);let o=null;const $=_({range:"30d",interval:"day"}),m=_([]),v=H(()=>{if(m.value.length===0)return{totalCost:0,avgCost:0,maxCost:0,growthRate:0};const s=m.value.map(u=>u.totalCost||u.cost||0),e=s.reduce((u,c)=>u+c,0),i=e/s.length,w=Math.max(...s),f=s[0]||0,p=s[s.length-1]||0,d=f>0?(p-f)/f*100:0;return{totalCost:e,avgCost:i,maxCost:w,growthRate:d}}),S=async()=>{var s,e;h.value=!0;try{console.log("ğŸ” Loading cost trends with params:",$.value);const i=await D.get("/admin/dashboard/cost-efficiency/trends",{params:$.value});console.log("ğŸ“ˆ Trends response:",i),i!=null&&i.success?(m.value=((s=i.data)==null?void 0:s.data)||[],console.log("âœ… Trends data loaded:",m.value.length,"data points"),x()):(console.warn("âš ï¸ Trends response missing success flag:",i),m.value=[]),((e=i==null?void 0:i.data)==null?void 0:e.available)===!1&&N("æ•°æ®åº“æœªå¯ç”¨,æ— æ³•åŠ è½½è¶‹åŠ¿æ•°æ®","warning")}catch(i){console.error("âŒ Failed to load cost trends:",i),N("åŠ è½½è¶‹åŠ¿æ•°æ®å¤±è´¥: "+(i.message||"æœªçŸ¥é”™è¯¯"),"error"),m.value=[]}finally{h.value=!1}},x=()=>{if(!g.value||m.value.length===0)return;o&&o.destroy();const s=m.value.map(i=>i.timestamp?new Date(i.timestamp).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):i.date||i.label||""),e=m.value.map(i=>i.totalCost||i.cost||0);o=new it(g.value,{type:"line",data:{labels:s,datasets:[{label:"æˆæœ¬",data:e,borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:i=>`æˆæœ¬: $${i.parsed.y.toFixed(6)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:i=>`$${i.toFixed(6)}`,color:n.value?"#9ca3af":"#6b7280"},grid:{color:n.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}},x:{ticks:{color:n.value?"#9ca3af":"#6b7280"},grid:{color:n.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}}}}})};return at(n,()=>{x()}),z(()=>{S()}),ot(()=>{o&&o.destroy()}),(s,e)=>(l(),r("div",Te,[t("div",Ve,[t("div",De,[e[4]||(e[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"æˆæœ¬è¶‹åŠ¿åˆ†æ"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},"æŸ¥çœ‹æˆæœ¬å˜åŒ–è¶‹åŠ¿å’Œé¢„æµ‹")],-1)),t("div",Re,[F(t("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>$.value.range=i),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:S},e[2]||(e[2]=[t("option",{value:"7days"},"7å¤©",-1),t("option",{value:"30d"},"30å¤©",-1),t("option",{value:"90d"},"90å¤©",-1)]),544),[[q,$.value.range]]),F(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>$.value.interval=i),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:S},e[3]||(e[3]=[t("option",{value:"hour"},"æŒ‰å°æ—¶",-1),t("option",{value:"day"},"æŒ‰å¤©",-1),t("option",{value:"week"},"æŒ‰å‘¨",-1)]),544),[[q,$.value.interval]])])]),h.value?(l(),r("div",Ie,e[5]||(e[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):m.value.length===0?(l(),r("div",qe,e[6]||(e[6]=[t("div",{class:"mb-4 text-6xl"},"ğŸ“ˆ",-1),t("h3",{class:"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100"},"æš‚æ— è¶‹åŠ¿æ•°æ®",-1),t("p",{class:"text-center text-sm text-gray-600 dark:text-gray-400"}," å½“å‰æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°æˆæœ¬è¶‹åŠ¿æ•°æ® ",-1)]))):(l(),r("div",Le,[t("div",Me,[t("canvas",{ref_key:"chartCanvas",ref:g},null,512)]),t("div",Be,[t("div",Ke,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»æˆæœ¬",-1)),t("div",je," $"+a(v.value.totalCost.toFixed(6)),1)]),t("div",ze,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¹³å‡æˆæœ¬",-1)),t("div",Ne," $"+a(v.value.avgCost.toFixed(6)),1)]),t("div",Ee,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æœ€é«˜æˆæœ¬",-1)),t("div",Oe," $"+a(v.value.maxCost.toFixed(6)),1)]),t("div",Qe,[e[10]||(e[10]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¢é•¿ç‡",-1)),t("div",{class:T(["mt-1 text-xl font-bold",v.value.growthRate>=0?"text-red-600":"text-green-600"])},a(v.value.growthRate>=0?"+":"")+a(v.value.growthRate.toFixed(1))+"% ",3)])])]))])]))}},j="/admin",O={async getAccountCostProfile(A){return(await D.get(`${j}/accounts/${A}/cost-profile`)).data},async updateCostProfile(A,b){return(await D.put(`${j}/accounts/${A}/cost-profile`,b)).data},async createBill(A,b){return(await D.post(`${j}/accounts/${A}/bills`,b)).data},async listBills(A,b={}){return(await D.get(`${j}/accounts/${A}/bills`,{params:{limit:b.limit||20,offset:b.offset||0}})).data},async inferPricing(A){return(await D.post(`${j}/accounts/${A}/infer-pricing`)).data},async validateCosts(A,b){return(await D.post(`${j}/accounts/${A}/validate-costs`,{billingPeriod:b})).data},async getCostComparison(A,b,n){return(await D.get(`${j}/accounts/${A}/cost-comparison`,{params:{startDate:b,endDate:n}})).data},async importBillsCSV(A,b){return(await D.post(`${j}/accounts/${A}/bills/import`,b,{headers:{"Content-Type":"multipart/form-data"}})).data}},Ge={class:"modal-content"},He={class:"modal-header"},We={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Xe={class:"modal-body"},Ze={class:"mb-6"},Je={class:"mb-6"},ts={key:0,class:"config-section"},es={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ss={key:1,class:"config-section"},as={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},os=["onUpdate:modelValue"],ls=["onUpdate:modelValue"],rs=["onUpdate:modelValue"],is=["onClick"],ns={key:2,class:"config-section"},ds={class:"mb-4"},us={class:"mb-4"},gs={class:"mb-4"},cs={key:3,class:"config-section"},xs={class:"mb-4"},ps={class:"config-section"},ys={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ms={class:"mb-6"},vs={class:"modal-footer"},fs=["disabled"],bs={__name:"CostProfileModal",props:{account:{type:Object,required:!0}},emits:["close","saved"],setup(A,{emit:b}){const n=A,h=b,g=_(!1),o=et({billingType:"standard",confidenceLevel:"low",pointConversion:{pointsPerRequest:1,pointsPerToken:.001,costPerPoint:.01},tieredPricing:[{minTokens:0,maxTokens:1e6,costPerMillion:3}],pricingFormula:{baseTokenCost:3e-6,perRequestFee:.002,weight:.5},relativeEfficiency:1,fixedCosts:{monthly_base:0,api_access_fee:0},notes:""});async function $(){if(!n.account.costProfile)return;const x=n.account.costProfile;o.billingType=x.billingType||"standard",o.confidenceLevel=x.confidenceLevel||"low",o.notes=x.notes||"",x.pointConversion&&(o.pointConversion={...x.pointConversion}),x.tieredPricing&&x.tieredPricing.length>0&&(o.tieredPricing=[...x.tieredPricing]),x.pricingFormula&&(o.pricingFormula={...x.pricingFormula}),x.relativeEfficiency&&(o.relativeEfficiency=x.relativeEfficiency),x.fixedCosts&&(o.fixedCosts={...x.fixedCosts})}function m(){o.tieredPricing.push({minTokens:0,maxTokens:1e6,costPerMillion:3})}function v(x){o.tieredPricing.splice(x,1)}async function S(){var x,s;g.value=!0;try{await O.updateCostProfile(n.account.id,o),h("saved")}catch(e){alert(`ä¿å­˜å¤±è´¥: ${((s=(x=e.response)==null?void 0:x.data)==null?void 0:s.error)||e.message}`)}finally{g.value=!1}}return z(()=>{$()}),(x,s)=>(l(),r("div",{class:"modal-overlay",onClick:s[14]||(s[14]=X(e=>x.$emit("close"),["self"]))},[t("div",Ge,[t("div",He,[t("h3",We," æˆæœ¬é…ç½® - "+a(A.account.name),1),t("button",{class:"close-btn",onClick:s[0]||(s[0]=e=>x.$emit("close"))},s[15]||(s[15]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Xe,[t("form",{onSubmit:X(S,["prevent"])},[t("div",Ze,[s[17]||(s[17]=t("label",{class:"form-label"},"è®¡ä»·æ¨¡å¼",-1)),F(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>o.billingType=e),class:"form-input"},s[16]||(s[16]=[E('<option value="standard" data-v-1a99438c>æ ‡å‡†å®šä»·ï¼ˆä½¿ç”¨å…¬å¼€ä»·æ ¼è¡¨ï¼‰</option><option value="point_based" data-v-1a99438c>ç§¯åˆ†åˆ¶è®¡è´¹</option><option value="tiered" data-v-1a99438c>é˜¶æ¢¯å®šä»·</option><option value="hybrid" data-v-1a99438c>æ··åˆè®¡è´¹</option><option value="estimated" data-v-1a99438c>ä¼°ç®—æ¨¡å¼</option>',5)]),512),[[q,o.billingType]]),s[18]||(s[18]=t("p",{class:"form-hint"},"é€‰æ‹©è´¦æˆ·çš„è®¡è´¹æ–¹å¼",-1))]),t("div",Je,[s[20]||(s[20]=t("label",{class:"form-label"},"ç½®ä¿¡åº¦çº§åˆ«",-1)),F(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>o.confidenceLevel=e),class:"form-input"},s[19]||(s[19]=[E('<option value="high" data-v-1a99438c>é«˜ - å·²éªŒè¯å‡†ç¡®</option><option value="medium-high" data-v-1a99438c>è¾ƒé«˜ - å¤šæ¬¡éªŒè¯</option><option value="medium" data-v-1a99438c>ä¸­ç­‰ - éƒ¨åˆ†éªŒè¯</option><option value="low-medium" data-v-1a99438c>è¾ƒä½ - å°‘é‡éªŒè¯</option><option value="low" data-v-1a99438c>ä½ - æœªéªŒè¯</option>',5)]),512),[[q,o.confidenceLevel]]),s[21]||(s[21]=t("p",{class:"form-hint"},"æŒ‡ç¤ºæˆæœ¬è®¡ç®—çš„å¯ä¿¡ç¨‹åº¦",-1))]),o.billingType==="point_based"?(l(),r("div",ts,[s[25]||(s[25]=t("h4",{class:"section-title"},"ç§¯åˆ†æ¢ç®—é…ç½®",-1)),t("div",es,[t("div",null,[s[22]||(s[22]=t("label",{class:"form-label"},"æ¯è¯·æ±‚ç§¯åˆ†",-1)),F(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>o.pointConversion.pointsPerRequest=e),class:"form-input",placeholder:"1",step:"0.001",type:"number"},null,512),[[R,o.pointConversion.pointsPerRequest,void 0,{number:!0}]])]),t("div",null,[s[23]||(s[23]=t("label",{class:"form-label"},"æ¯Tokenç§¯åˆ†",-1)),F(t("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>o.pointConversion.pointsPerToken=e),class:"form-input",placeholder:"0.001",step:"0.00001",type:"number"},null,512),[[R,o.pointConversion.pointsPerToken,void 0,{number:!0}]])]),t("div",null,[s[24]||(s[24]=t("label",{class:"form-label"},"æ¯ç§¯åˆ†æˆæœ¬ ($)",-1)),F(t("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>o.pointConversion.costPerPoint=e),class:"form-input",placeholder:"0.01",step:"0.0001",type:"number"},null,512),[[R,o.pointConversion.costPerPoint,void 0,{number:!0}]])])])])):V("",!0),o.billingType==="tiered"?(l(),r("div",ss,[s[31]||(s[31]=t("h4",{class:"section-title"},"é˜¶æ¢¯å®šä»·é…ç½®",-1)),(l(!0),r(L,null,B(o.tieredPricing,(e,i)=>(l(),r("div",{key:i,class:"tier-item"},[t("div",as,[t("div",null,[s[26]||(s[26]=t("label",{class:"form-label"},"æœ€å°Token",-1)),F(t("input",{"onUpdate:modelValue":w=>e.minTokens=w,class:"form-input",placeholder:"0",type:"number"},null,8,os),[[R,e.minTokens,void 0,{number:!0}]])]),t("div",null,[s[27]||(s[27]=t("label",{class:"form-label"},"æœ€å¤§Token",-1)),F(t("input",{"onUpdate:modelValue":w=>e.maxTokens=w,class:"form-input",placeholder:"1000000",type:"number"},null,8,ls),[[R,e.maxTokens,void 0,{number:!0}]])]),t("div",null,[s[28]||(s[28]=t("label",{class:"form-label"},"æˆæœ¬/ç™¾ä¸‡Token ($)",-1)),F(t("input",{"onUpdate:modelValue":w=>e.costPerMillion=w,class:"form-input",placeholder:"3.0",step:"0.01",type:"number"},null,8,rs),[[R,e.costPerMillion,void 0,{number:!0}]])])]),o.tieredPricing.length>1?(l(),r("button",{key:0,class:"btn-sm btn-danger mt-2",type:"button",onClick:w=>v(i)},s[29]||(s[29]=[t("i",{class:"fas fa-trash"},null,-1),I(" åˆ é™¤ ",-1)]),8,is)):V("",!0)]))),128)),t("button",{class:"btn-secondary mt-2",type:"button",onClick:m},s[30]||(s[30]=[t("i",{class:"fas fa-plus"},null,-1),I(" æ·»åŠ é˜¶æ¢¯ ",-1)]))])):V("",!0),o.billingType==="hybrid"?(l(),r("div",ns,[s[36]||(s[36]=t("h4",{class:"section-title"},"æ··åˆè®¡è´¹å…¬å¼",-1)),t("div",ds,[s[32]||(s[32]=t("label",{class:"form-label"},"åŸºç¡€Tokenæˆæœ¬ ($)",-1)),F(t("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>o.pricingFormula.baseTokenCost=e),class:"form-input",placeholder:"0.000003",step:"0.000001",type:"number"},null,512),[[R,o.pricingFormula.baseTokenCost,void 0,{number:!0}]])]),t("div",us,[s[33]||(s[33]=t("label",{class:"form-label"},"æ¯è¯·æ±‚å›ºå®šè´¹ç”¨ ($)",-1)),F(t("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>o.pricingFormula.perRequestFee=e),class:"form-input",placeholder:"0.002",step:"0.0001",type:"number"},null,512),[[R,o.pricingFormula.perRequestFee,void 0,{number:!0}]])]),t("div",gs,[s[34]||(s[34]=t("label",{class:"form-label"},"æƒé‡ç³»æ•°",-1)),F(t("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>o.pricingFormula.weight=e),class:"form-input",max:"1",min:"0",placeholder:"0.5",step:"0.1",type:"number"},null,512),[[R,o.pricingFormula.weight,void 0,{number:!0}]]),s[35]||(s[35]=t("p",{class:"form-hint"},"0-1ä¹‹é—´ï¼Œè¡¨ç¤ºTokenæˆæœ¬å’Œè¯·æ±‚è´¹ç”¨çš„æ··åˆæ¯”ä¾‹",-1))])])):V("",!0),o.billingType==="estimated"?(l(),r("div",cs,[s[39]||(s[39]=t("h4",{class:"section-title"},"ä¼°ç®—å‚æ•°",-1)),t("div",xs,[s[37]||(s[37]=t("label",{class:"form-label"},"ç›¸å¯¹æ•ˆç‡ç³»æ•°",-1)),F(t("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>o.relativeEfficiency=e),class:"form-input",placeholder:"1.0",step:"0.1",type:"number"},null,512),[[R,o.relativeEfficiency,void 0,{number:!0}]]),s[38]||(s[38]=t("p",{class:"form-hint"},"ç›¸å¯¹äºæ ‡å‡†ä»·æ ¼çš„å€æ•°ï¼ˆå¦‚0.8è¡¨ç¤ºæ¯”æ ‡å‡†ä¾¿å®œ20%ï¼‰",-1))])])):V("",!0),t("div",ps,[s[42]||(s[42]=t("h4",{class:"section-title"},"å›ºå®šè´¹ç”¨ï¼ˆå¯é€‰ï¼‰",-1)),t("div",ys,[t("div",null,[s[40]||(s[40]=t("label",{class:"form-label"},"æœˆåº¦åŸºç¡€è´¹ç”¨ ($)",-1)),F(t("input",{"onUpdate:modelValue":s[10]||(s[10]=e=>o.fixedCosts.monthly_base=e),class:"form-input",placeholder:"0",step:"0.01",type:"number"},null,512),[[R,o.fixedCosts.monthly_base,void 0,{number:!0}]])]),t("div",null,[s[41]||(s[41]=t("label",{class:"form-label"},"APIè®¿é—®è´¹ ($)",-1)),F(t("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>o.fixedCosts.api_access_fee=e),class:"form-input",placeholder:"0",step:"0.01",type:"number"},null,512),[[R,o.fixedCosts.api_access_fee,void 0,{number:!0}]])])])]),t("div",ms,[s[43]||(s[43]=t("label",{class:"form-label"},"å¤‡æ³¨è¯´æ˜",-1)),F(t("textarea",{"onUpdate:modelValue":s[12]||(s[12]=e=>o.notes=e),class:"form-input",placeholder:"è®°å½•é…ç½®æ¥æºæˆ–ç‰¹æ®Šè¯´æ˜",rows:"3"},null,512),[[R,o.notes]])])],32)]),t("div",vs,[t("button",{class:"btn-secondary",type:"button",onClick:s[13]||(s[13]=e=>x.$emit("close"))},"å–æ¶ˆ"),t("button",{class:"btn-primary",disabled:g.value,type:"button",onClick:S},[t("i",{class:T(["fas fa-save",{"fa-spin":g.value}])},null,2),I(" "+a(g.value?"ä¿å­˜ä¸­...":"ä¿å­˜é…ç½®"),1)],8,fs)])])]))}},ks=Q(bs,[["__scopeId","data-v-1a99438c"]]),hs={class:"modal-content"},_s={class:"modal-header"},$s={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},ws={class:"modal-body"},Cs={key:0,class:"space-y-6"},Ps={class:"mb-4"},Fs={class:"mb-4"},As={class:"mb-4"},Ss={class:"mb-4"},Us={class:"mb-4"},Ts={class:"text-center"},Vs={key:1,class:"space-y-6"},Ds={key:0,class:"overflow-x-auto"},Rs={class:"min-w-full text-xs"},Is={class:"divide-y divide-gray-200 dark:divide-gray-700"},qs={class:"px-2 py-1"},Ls={class:"px-2 py-1 text-right"},Ms={class:"px-2 py-1"},Bs={class:"px-2 py-1 text-gray-600 dark:text-gray-400"},Ks={class:"mt-2 text-xs text-gray-500"},js={class:"text-center"},zs={class:"modal-footer"},Ns=["disabled"],Es={__name:"BillEntryModal",props:{account:{type:Object,required:!0}},emits:["close","saved"],setup(A,{emit:b}){const n=A,h=b,g=_(!1),o=_(!1),$=_([]),m=et({billingPeriod:"",totalCost:null,currency:"USD",notes:"",attachment:null});function v(s){const e=s.target.files[0];e&&(m.attachment=e)}function S(s){const e=s.target.files[0];if(!e)return;const i=new FileReader;i.onload=w=>{try{const p=w.target.result.split(`
`).filter(u=>u.trim()),d=p[0].split(",").map(u=>u.trim());$.value=p.slice(1).map(u=>{const c=u.split(",").map(M=>M.trim()),C={};return d.forEach((M,k)=>{C[M]=c[k]||""}),C})}catch(f){alert("CSV è§£æå¤±è´¥: "+f.message)}},i.readAsText(e)}async function x(){var s,e;g.value=!0;try{if(o.value){for(const i of $.value)await O.createBill(n.account.id,{billingPeriod:i.billingPeriod,totalCost:parseFloat(i.totalCost),currency:i.currency||"USD",notes:i.notes||""});alert(`æˆåŠŸå½•å…¥ ${$.value.length} æ¡è´¦å•`)}else await O.createBill(n.account.id,{billingPeriod:m.billingPeriod,totalCost:m.totalCost,currency:m.currency,notes:m.notes}),alert("è´¦å•å½•å…¥æˆåŠŸ");h("saved"),h("close")}catch(i){alert(`å½•å…¥å¤±è´¥: ${((e=(s=i.response)==null?void 0:s.data)==null?void 0:e.error)||i.message}`)}finally{g.value=!1}}return(s,e)=>(l(),r("div",{class:"modal-overlay",onClick:e[8]||(e[8]=X(i=>s.$emit("close"),["self"]))},[t("div",hs,[t("div",_s,[t("h3",$s," å½•å…¥è´¦å• - "+a(A.account.name),1),t("button",{class:"close-btn",onClick:e[0]||(e[0]=i=>s.$emit("close"))},e[9]||(e[9]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",ws,[o.value?(l(),r("div",Vs,[e[24]||(e[24]=E('<div class="rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20" data-v-93b9649c><h4 class="mb-2 text-sm font-semibold text-blue-900 dark:text-blue-300" data-v-93b9649c><i class="fas fa-info-circle" data-v-93b9649c></i> CSV æ ¼å¼è¯´æ˜ </h4><p class="mb-2 text-xs text-blue-800 dark:text-blue-400" data-v-93b9649c> CSV æ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹åˆ—ï¼ˆç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼‰ï¼š </p><code class="block rounded bg-white p-2 text-xs dark:bg-gray-800 dark:text-gray-300" data-v-93b9649c> billingPeriod,totalCost,currency,notes<br data-v-93b9649c> 2025-01,123.45,USD,ä¸€æœˆè´¦å•<br data-v-93b9649c> 2025-02,145.67,USD,äºŒæœˆè´¦å• </code></div>',1)),t("div",null,[e[20]||(e[20]=t("label",{class:"form-label"},"é€‰æ‹© CSV æ–‡ä»¶",-1)),t("input",{accept:".csv",class:"form-input",type:"file",onChange:S},null,32)]),$.value.length>0?(l(),r("div",Ds,[e[22]||(e[22]=t("h4",{class:"mb-2 text-sm font-semibold text-gray-900 dark:text-gray-100"}," é¢„è§ˆï¼ˆå‰5æ¡ï¼‰ ",-1)),t("table",Rs,[e[21]||(e[21]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-2 py-1 text-left"},"è®¡è´¹å‘¨æœŸ"),t("th",{class:"px-2 py-1 text-right"},"é‡‘é¢"),t("th",{class:"px-2 py-1 text-left"},"å¸ç§"),t("th",{class:"px-2 py-1 text-left"},"å¤‡æ³¨")])],-1)),t("tbody",Is,[(l(!0),r(L,null,B($.value.slice(0,5),(i,w)=>(l(),r("tr",{key:w},[t("td",qs,a(i.billingPeriod),1),t("td",Ls,"$"+a(i.totalCost),1),t("td",Ms,a(i.currency),1),t("td",Bs,a(i.notes||"-"),1)]))),128))])]),t("p",Ks,"å…± "+a($.value.length)+" æ¡è®°å½•",1)])):V("",!0),t("div",js,[t("button",{class:"text-sm text-indigo-600 hover:text-indigo-700 dark:text-indigo-400",type:"button",onClick:e[6]||(e[6]=i=>o.value=!1)},e[23]||(e[23]=[t("i",{class:"fas fa-arrow-left"},null,-1),I(" è¿”å›å•ä¸ªå½•å…¥ ",-1)]))])])):(l(),r("div",Cs,[t("form",{onSubmit:X(x,["prevent"])},[t("div",Ps,[e[10]||(e[10]=t("label",{class:"form-label"},"è®¡è´¹å‘¨æœŸ",-1)),F(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>m.billingPeriod=i),class:"form-input",placeholder:"2025-01",required:"",type:"month"},null,512),[[R,m.billingPeriod]]),e[11]||(e[11]=t("p",{class:"form-hint"},"æ ¼å¼ï¼šYYYY-MMï¼ˆå¦‚ 2025-01ï¼‰",-1))]),t("div",Fs,[e[12]||(e[12]=t("label",{class:"form-label"},"å®é™…è´¦å•é‡‘é¢ ($)",-1)),F(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>m.totalCost=i),class:"form-input",placeholder:"123.45",required:"",step:"0.01",type:"number"},null,512),[[R,m.totalCost,void 0,{number:!0}]]),e[13]||(e[13]=t("p",{class:"form-hint"},"ä»è´¦å•ä¸­è·å–çš„å®é™…è´¹ç”¨",-1))]),t("div",As,[e[15]||(e[15]=t("label",{class:"form-label"},"å¸ç§",-1)),F(t("select",{"onUpdate:modelValue":e[3]||(e[3]=i=>m.currency=i),class:"form-input"},e[14]||(e[14]=[t("option",{value:"USD"},"ç¾å…ƒ (USD)",-1),t("option",{value:"CNY"},"äººæ°‘å¸ (CNY)",-1),t("option",{value:"EUR"},"æ¬§å…ƒ (EUR)",-1)]),512),[[q,m.currency]])]),t("div",Ss,[e[16]||(e[16]=t("label",{class:"form-label"},"è´¦å•å¤‡æ³¨",-1)),F(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=i=>m.notes=i),class:"form-input",placeholder:"è®°å½•è´¦å•æ¥æºã€ç‰¹æ®Šæƒ…å†µç­‰",rows:"3"},null,512),[[R,m.notes]])]),t("div",Us,[e[17]||(e[17]=t("label",{class:"form-label"},"è´¦å•æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰",-1)),t("input",{accept:".pdf,.png,.jpg,.jpeg",class:"form-input",type:"file",onChange:v},null,32),e[18]||(e[18]=t("p",{class:"form-hint"},"æ”¯æŒPDFã€å›¾ç‰‡æ ¼å¼",-1))])],32),t("div",Ts,[t("button",{class:"text-sm text-indigo-600 hover:text-indigo-700 dark:text-indigo-400",type:"button",onClick:e[5]||(e[5]=i=>o.value=!0)},e[19]||(e[19]=[t("i",{class:"fas fa-upload"},null,-1),I(" åˆ‡æ¢åˆ°æ‰¹é‡å¯¼å…¥ ",-1)]))])]))]),t("div",zs,[t("button",{class:"btn-secondary",type:"button",onClick:e[7]||(e[7]=i=>s.$emit("close"))},"å–æ¶ˆ"),t("button",{class:"btn-primary",disabled:g.value||o.value&&$.value.length===0,type:"button",onClick:x},[t("i",{class:T(["fas fa-save",{"fa-spin":g.value}])},null,2),I(" "+a(g.value?"æäº¤ä¸­...":o.value?`æ‰¹é‡æäº¤ (${$.value.length})`:"æäº¤è´¦å•"),1)],8,Ns)])])]))}},Os=Q(Es,[["__scopeId","data-v-93b9649c"]]),Qs={class:"modal-content-large"},Ys={class:"modal-header"},Gs={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Hs={class:"modal-body"},Ws={class:"mb-6"},Xs={class:"flex gap-3"},Zs=["disabled"],Js={key:0,class:"space-y-6"},ta={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},ea={class:"stat-card"},sa={class:"stat-value text-blue-600 dark:text-blue-400"},aa={class:"stat-card"},oa={class:"stat-value text-green-600 dark:text-green-400"},la={class:"stat-card"},ra={class:"stat-hint"},ia={key:0,class:"quality-section"},na={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},da={class:"quality-metric"},ua={class:"flex items-center justify-between"},ga={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},ca={class:"progress-bar mt-2"},xa={class:"quality-metric"},pa={class:"flex items-center justify-between"},ya={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},ma={class:"progress-bar mt-2"},va={class:"quality-metric"},fa={class:"flex items-center justify-between"},ba={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},ka={class:"progress-bar mt-2"},ha={class:"details-section"},_a={class:"grid grid-cols-1 gap-3 text-sm md:grid-cols-2"},$a={class:"detail-item"},wa={class:"detail-value"},Ca={class:"detail-item"},Pa={class:"detail-value"},Fa={class:"detail-item"},Aa={class:"detail-value"},Sa={class:"detail-item"},Ua={key:1,class:"comparison-section"},Ta={class:"mb-4 flex items-center justify-between"},Va={key:2,class:"suggestions-section"},Da={class:"space-y-2"},Ra={key:1,class:"empty-state"},Ia={class:"modal-footer"},qa={__name:"InferenceValidationPanel",props:{account:{type:Object,required:!0}},emits:["close"],setup(A){const b=A,n=_(!1),h=_(""),g=_(null),o=_(null),$=_(!1),m=_(null);let v=null;async function S(){var p,d;if(!h.value){alert("è¯·é€‰æ‹©éªŒè¯å‘¨æœŸ");return}n.value=!0;try{const u=await O.validateCosts(b.account.id,h.value);if(console.log("Validation result:",u),!u){alert("éªŒè¯å¤±è´¥ï¼šæœªæ”¶åˆ°æœåŠ¡å™¨å“åº”");return}if(u.validated===!1&&u.reason==="database_disabled"){alert(`æˆæœ¬éªŒè¯åŠŸèƒ½éœ€è¦ PostgreSQL æ•°æ®åº“æ”¯æŒã€‚

è¯·åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® POSTGRES_ENABLED=true å¹¶é…ç½®æ•°æ®åº“è¿æ¥å‚æ•°åé‡å¯æœåŠ¡ã€‚`);return}if(u.validated===!1&&u.reason==="no_bill_data"){alert(u.message||`æœªæ‰¾åˆ° ${h.value} çš„è´¦å•æ•°æ®ã€‚

è¯·å…ˆå½•å…¥è¯¥å‘¨æœŸçš„è´¦å•æ•°æ®ã€‚`);return}g.value=u,e(),await x()}catch(u){console.error("Validation error:",u),alert(`éªŒè¯å¤±è´¥: ${((d=(p=u.response)==null?void 0:p.data)==null?void 0:d.error)||u.message}`)}finally{n.value=!1}}async function x(){$.value=!0;try{const p=new Date(h.value+"-01"),d=new Date(p);d.setMonth(d.getMonth()-5);const u=await O.getCostComparison(b.account.id,d.toISOString().slice(0,10),p.toISOString().slice(0,10));o.value=u,await lt(),s()}catch(p){console.error("Failed to load comparison:",p)}finally{$.value=!1}}function s(){if(!m.value||!o.value)return;v&&v.dispose(),v=nt(m.value);const p={tooltip:{trigger:"axis",backgroundColor:"rgba(0, 0, 0, 0.8)",textStyle:{color:"#fff"}},legend:{data:["è®¡ç®—æˆæœ¬","å®é™…è´¦å•"],textStyle:{color:document.documentElement.classList.contains("dark")?"#9CA3AF":"#4B5563"}},xAxis:{type:"category",data:o.value.periods||[],axisLabel:{color:document.documentElement.classList.contains("dark")?"#9CA3AF":"#6B7280"}},yAxis:{type:"value",name:"æˆæœ¬ ($)",axisLabel:{color:document.documentElement.classList.contains("dark")?"#9CA3AF":"#6B7280"}},series:[{name:"è®¡ç®—æˆæœ¬",type:"line",data:o.value.calculatedCosts||[],smooth:!0,itemStyle:{color:"#3B82F6"}},{name:"å®é™…è´¦å•",type:"line",data:o.value.actualBills||[],smooth:!0,itemStyle:{color:"#10B981"}}]};v.setOption(p)}function e(){var u;if(!g.value)return;const p=[],d=Math.abs(g.value.deviationPercent||0);d>20?p.push("åå·®è¾ƒå¤§ï¼Œå»ºè®®é‡æ–°æ¨å¯¼è®¡ä»·å‚æ•°æˆ–æ£€æŸ¥è´¦å•æ•°æ®å‡†ç¡®æ€§"):d>10?p.push("åå·®é€‚ä¸­ï¼Œå¯è€ƒè™‘å½•å…¥æ›´å¤šè´¦å•æ•°æ®ä»¥æé«˜æ¨å¯¼ç²¾åº¦"):d<5&&p.push("è®¡ç®—ç²¾åº¦ä¼˜ç§€ï¼Œå½“å‰é…ç½®å¯é "),((u=g.value.quality)==null?void 0:u.r_squared)<.8&&p.push("RÂ²ç³»æ•°è¾ƒä½ï¼Œæ¨å¯¼æ¨¡å‹å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼Œå»ºè®®æ‰‹åŠ¨è°ƒæ•´å‚æ•°"),g.value.suggestions=p}function i(p){const d=Math.abs(p||0);return d<5?"text-green-600 dark:text-green-400":d<10?"text-yellow-600 dark:text-yellow-400":d<20?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400"}function w(p){return{high:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300","medium-high":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300","low-medium":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",low:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}[p]||"bg-gray-100 text-gray-800"}function f(p){return{high:"é«˜","medium-high":"è¾ƒé«˜",medium:"ä¸­ç­‰","low-medium":"è¾ƒä½",low:"ä½"}[p]||p}return z(()=>{const p=new Date;h.value=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`}),(p,d)=>{var u,c;return l(),r("div",{class:"modal-overlay",onClick:d[3]||(d[3]=X(C=>p.$emit("close"),["self"]))},[t("div",Qs,[t("div",Ys,[t("h3",Gs," æˆæœ¬éªŒè¯ - "+a(A.account.name),1),t("button",{class:"close-btn",onClick:d[0]||(d[0]=C=>p.$emit("close"))},d[4]||(d[4]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Hs,[t("div",Ws,[d[5]||(d[5]=t("label",{class:"form-label"},"é€‰æ‹©éªŒè¯å‘¨æœŸ",-1)),t("div",Xs,[F(t("input",{"onUpdate:modelValue":d[1]||(d[1]=C=>h.value=C),class:"form-input flex-1",placeholder:"2025-01",type:"month"},null,512),[[R,h.value]]),t("button",{class:"btn-primary",disabled:n.value,onClick:S},[t("i",{class:T(["fas fa-play",{"fa-spin":n.value}])},null,2),I(" "+a(n.value?"éªŒè¯ä¸­...":"å¼€å§‹éªŒè¯"),1)],8,Zs)])]),g.value?(l(),r("div",Js,[t("div",ta,[t("div",ea,[d[6]||(d[6]=t("div",{class:"stat-label"},"è®¡ç®—æˆæœ¬",-1)),t("div",sa," $"+a(((u=g.value.calculatedCost)==null?void 0:u.toFixed(4))||"0.0000"),1),d[7]||(d[7]=t("div",{class:"stat-hint"},"åŸºäºä½¿ç”¨é‡è®¡ç®—",-1))]),t("div",aa,[d[8]||(d[8]=t("div",{class:"stat-label"},"å®é™…è´¦å•",-1)),t("div",oa," $"+a(((c=g.value.actualBill)==null?void 0:c.toFixed(4))||"0.0000"),1),d[9]||(d[9]=t("div",{class:"stat-hint"},"ä»è´¦å•è®°å½•è·å–",-1))]),t("div",la,[d[10]||(d[10]=t("div",{class:"stat-label"},"åå·®ç‡",-1)),t("div",{class:T(["stat-value",i(g.value.deviationPercent)])},a(Math.abs(g.value.deviationPercent||0).toFixed(2))+"% ",3),t("div",ra,a(g.value.deviationPercent>0?"é«˜ä¼°":"ä½ä¼°"),1)])]),g.value.quality?(l(),r("div",ia,[d[14]||(d[14]=t("h4",{class:"mb-4 text-sm font-semibold text-gray-900 dark:text-gray-100"}," æ¨å¯¼è´¨é‡è¯„åˆ† ",-1)),t("div",na,[t("div",da,[t("div",ua,[d[11]||(d[11]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"æ€»åˆ†",-1)),t("span",ga,a((g.value.quality.score*100).toFixed(1))+"% ",1)]),t("div",ca,[t("div",{class:"progress-fill bg-green-500",style:G({width:g.value.quality.score*100+"%"})},null,4)])]),t("div",xa,[t("div",pa,[d[12]||(d[12]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"RÂ² å†³å®šç³»æ•°",-1)),t("span",ya,a((g.value.quality.r_squared*100).toFixed(1))+"% ",1)]),t("div",ma,[t("div",{class:"progress-fill bg-blue-500",style:G({width:g.value.quality.r_squared*100+"%"})},null,4)])]),t("div",va,[t("div",fa,[d[13]||(d[13]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"å¹³å‡ç»å¯¹è¯¯å·®",-1)),t("span",ba,a((g.value.quality.mean_absolute_error*100).toFixed(2))+"% ",1)]),t("div",ka,[t("div",{class:"progress-fill bg-yellow-500",style:G({width:(1-g.value.quality.mean_absolute_error)*100+"%"})},null,4)])])])])):V("",!0),t("div",ha,[d[19]||(d[19]=t("h4",{class:"mb-3 text-sm font-semibold text-gray-900 dark:text-gray-100"},"éªŒè¯è¯¦æƒ…",-1)),t("div",_a,[t("div",$a,[d[15]||(d[15]=t("span",{class:"detail-label"},"è®¡è´¹å‘¨æœŸ:",-1)),t("span",wa,a(g.value.billingPeriod),1)]),t("div",Ca,[d[16]||(d[16]=t("span",{class:"detail-label"},"è®¡ç®—æ–¹æ³•:",-1)),t("span",Pa,a(g.value.calculationMethod),1)]),t("div",Fa,[d[17]||(d[17]=t("span",{class:"detail-label"},"æ•°æ®æ¥æº:",-1)),t("span",Aa,a(g.value.costSource),1)]),t("div",Sa,[d[18]||(d[18]=t("span",{class:"detail-label"},"ç½®ä¿¡åº¦:",-1)),t("span",{class:T(["inline-flex rounded-full px-2 py-0.5 text-xs font-semibold",w(g.value.confidenceLevel)])},a(f(g.value.confidenceLevel)),3)])])]),o.value?(l(),r("div",Ua,[t("div",Ta,[d[21]||(d[21]=t("h4",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"æˆæœ¬å¯¹æ¯”è¶‹åŠ¿",-1)),t("button",{class:"btn-sm btn-secondary",onClick:x},[t("i",{class:T(["fas fa-sync-alt",{"fa-spin":$.value}])},null,2),d[20]||(d[20]=I(" åˆ·æ–° ",-1))])]),t("div",{ref_key:"chartContainer",ref:m,class:"chart-container"},null,512)])):V("",!0),g.value.suggestions?(l(),r("div",Va,[d[23]||(d[23]=t("h4",{class:"mb-3 text-sm font-semibold text-gray-900 dark:text-gray-100"},[t("i",{class:"fas fa-lightbulb text-yellow-500"}),I(" ä¼˜åŒ–å»ºè®® ")],-1)),t("ul",Da,[(l(!0),r(L,null,B(g.value.suggestions,(C,M)=>(l(),r("li",{key:M,class:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400"},[d[22]||(d[22]=t("i",{class:"fas fa-check-circle mt-0.5 text-green-500"},null,-1)),t("span",null,a(C),1)]))),128))])])):V("",!0)])):(l(),r("div",Ra,d[24]||(d[24]=[t("i",{class:"fas fa-chart-line mb-3 text-4xl text-gray-300 dark:text-gray-600"},null,-1),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},' é€‰æ‹©è®¡è´¹å‘¨æœŸå¹¶ç‚¹å‡»"å¼€å§‹éªŒè¯"ä»¥æŸ¥çœ‹ç»“æœ ',-1)])))]),t("div",Ia,[t("button",{class:"btn-secondary",type:"button",onClick:d[2]||(d[2]=C=>p.$emit("close"))},"å…³é—­")])])])}}},La=Q(qa,[["__scopeId","data-v-55a1ec88"]]),Ma={class:"cost-tracking-management"},Ba={class:"card p-6"},Ka={class:"mb-6 flex items-center justify-between"},ja={class:"flex gap-3"},za=["disabled"],Na={key:0,class:"flex h-64 items-center justify-center"},Ea={key:1,class:"overflow-x-auto"},Oa={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Qa={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Ya={class:"px-4 py-3"},Ga={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Ha={class:"text-xs text-gray-500 dark:text-gray-400"},Wa={class:"px-4 py-3"},Xa={class:"px-4 py-3"},Za={class:"text-sm text-gray-900 dark:text-gray-100"},Ja={class:"px-4 py-3"},to={key:1,class:"text-xs text-gray-400"},eo={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},so={class:"px-4 py-3 text-right"},ao={class:"flex justify-end gap-2"},oo=["onClick"],lo=["onClick"],ro=["disabled","onClick"],io=["onClick"],no={key:0,class:"py-12 text-center"},uo={__name:"CostTrackingManagement",setup(A){const b=_(!1),n=_([]),h=_({platform:"all"}),g=_(null),o=_(!1),$=_(!1),m=_(!1),v=_(null),S=H(()=>h.value.platform==="all"?n.value:n.value.filter(k=>k.platform===h.value.platform));async function x(){b.value=!0;try{let k=[];try{const y=await D.get("/admin/claude-accounts");y.success&&y.data&&k.push(...y.data.map(U=>({...U,platform:U.platform||"claude"})))}catch(y){console.warn("Failed to load Claude accounts:",y.message)}try{const y=await D.get("/admin/claude-console-accounts");y.success&&y.data&&k.push(...y.data.map(U=>({...U,platform:U.platform||"claude-console"})))}catch(y){console.warn("Failed to load Claude Console accounts:",y.message)}try{const y=await D.get("/admin/gemini-accounts");y.success&&y.data&&k.push(...y.data.map(U=>({...U,platform:U.platform||"gemini"})))}catch(y){console.warn("Failed to load Gemini accounts:",y.message)}try{const y=await D.get("/admin/openai-accounts");y.success&&y.data&&k.push(...y.data.map(U=>({...U,platform:U.platform||"openai"})))}catch(y){console.warn("Failed to load OpenAI accounts:",y.message)}try{const y=await D.get("/admin/openai-responses-accounts");y.success&&y.data&&k.push(...y.data.map(U=>({...U,platform:U.platform||"openai-responses"})))}catch(y){console.warn("Failed to load OpenAI Responses accounts:",y.message)}if(console.log("All accounts:",k),k.length===0){n.value=[],b.value=!1;return}const P=await Promise.all(k.map(async y=>{try{const U=await O.getAccountCostProfile(y.id);return{...y,costProfile:(U==null?void 0:U.profile)||null}}catch(U){return console.log(`No cost profile for account ${y.id}:`,U.message),{...y,costProfile:null}}}));n.value=P,console.log("Accounts with profiles:",P)}catch(k){console.error("Unexpected error loading accounts:",k)}finally{b.value=!1}}function s(k){g.value=k,o.value=!0}function e(k){g.value=k,$.value=!0}function i(k){g.value=k,m.value=!0}async function w(k){var P,y,U,W;if(confirm(`ç¡®å®šè¦ä¸ºè´¦æˆ· "${k.name}" æ¨å¯¼è®¡ä»·å‚æ•°å—ï¼Ÿè¿™å°†åŸºäºå†å²è´¦å•æ•°æ®è¿›è¡Œåˆ†æã€‚`)){v.value=k.id;try{const K=await O.inferPricing(k.id);alert(`æ¨å¯¼æˆåŠŸï¼
è´¨é‡åˆ†æ•°: ${(((P=K.quality)==null?void 0:P.score)*100||0).toFixed(1)}%
RÂ²: ${(((y=K.quality)==null?void 0:y.r_squared)*100||0).toFixed(1)}%`),await x()}catch(K){alert(`æ¨å¯¼å¤±è´¥: ${((W=(U=K.response)==null?void 0:U.data)==null?void 0:W.error)||K.message}`)}finally{v.value=null}}}function f(){o.value=!1,x()}function p(){$.value=!1}function d(k){return{claude:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300","claude-console":"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300",gemini:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",openai:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}[k]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}function u(k){return{high:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300","medium-high":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300","low-medium":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",low:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}[k]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}function c(k){return{high:"é«˜","medium-high":"è¾ƒé«˜",medium:"ä¸­ç­‰","low-medium":"è¾ƒä½",low:"ä½"}[k]||k}function C(k){return{standard:"æ ‡å‡†å®šä»·",point_based:"ç§¯åˆ†åˆ¶",tiered:"é˜¶æ¢¯å®šä»·",hybrid:"æ··åˆè®¡è´¹",estimated:"ä¼°ç®—æ¨¡å¼"}[k]||"æœªé…ç½®"}function M(k){return k?new Date(k).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"-"}return z(()=>{x()}),(k,P)=>(l(),r("div",Ma,[t("div",Ba,[t("div",Ka,[P[6]||(P[6]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"æˆæœ¬é…ç½®ä¸éªŒè¯"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," ç®¡ç†è´¦æˆ·è®¡ä»·æ¨¡å¼ã€å½•å…¥è´¦å•ã€æ¨å¯¼å‚æ•°å’ŒéªŒè¯æˆæœ¬å‡†ç¡®æ€§ ")],-1)),t("div",ja,[F(t("select",{"onUpdate:modelValue":P[0]||(P[0]=y=>h.value.platform=y),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",onChange:x},P[4]||(P[4]=[E('<option value="all" data-v-6e67f7b6>å…¨éƒ¨å¹³å°</option><option value="claude" data-v-6e67f7b6>Claude</option><option value="claude-console" data-v-6e67f7b6>Console</option><option value="gemini" data-v-6e67f7b6>Gemini</option><option value="openai" data-v-6e67f7b6>OpenAI</option><option value="openai-responses" data-v-6e67f7b6>OpenAI Responses</option>',6)]),544),[[q,h.value.platform]]),t("button",{class:"btn-primary flex items-center gap-2",disabled:b.value,onClick:x},[t("i",{class:T(["fas fa-sync-alt",{"fa-spin":b.value}])},null,2),P[5]||(P[5]=I(" åˆ·æ–° ",-1))],8,za)])]),b.value?(l(),r("div",Na,P[7]||(P[7]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):(l(),r("div",Ea,[t("table",Oa,[P[11]||(P[11]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è´¦æˆ· "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å¹³å° "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è®¡ä»·æ¨¡å¼ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ç½®ä¿¡åº¦ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æœ€åéªŒè¯ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ“ä½œ ")])],-1)),t("tbody",Qa,[(l(!0),r(L,null,B(S.value,y=>{var U,W,K;return l(),r("tr",{key:y.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Ya,[t("div",Ga,a(y.name),1),t("div",Ha,a(y.id),1)]),t("td",Wa,[t("span",{class:T(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",d(y.platform)])},a(y.platform),3)]),t("td",Xa,[t("span",Za,a(C((U=y.costProfile)==null?void 0:U.billingType)),1)]),t("td",Ja,[(W=y.costProfile)!=null&&W.confidenceLevel?(l(),r("span",{key:0,class:T(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",u(y.costProfile.confidenceLevel)])},a(c(y.costProfile.confidenceLevel)),3)):(l(),r("span",to,"-"))]),t("td",eo,a((K=y.costProfile)!=null&&K.lastValidatedAt?M(y.costProfile.lastValidatedAt):"-"),1),t("td",so,[t("div",ao,[t("button",{class:"btn-sm btn-secondary",title:"é…ç½®æˆæœ¬",onClick:Z=>s(y)},P[8]||(P[8]=[t("i",{class:"fas fa-cog"},null,-1)]),8,oo),t("button",{class:"btn-sm btn-secondary",title:"å½•å…¥è´¦å•",onClick:Z=>e(y)},P[9]||(P[9]=[t("i",{class:"fas fa-file-invoice-dollar"},null,-1)]),8,lo),t("button",{class:"btn-sm btn-secondary",disabled:v.value===y.id,title:"æ¨å¯¼å‚æ•°",onClick:Z=>w(y)},[t("i",{class:T(["fas fa-robot",{"fa-spin":v.value===y.id}])},null,2)],8,ro),t("button",{class:"btn-sm btn-primary",title:"éªŒè¯æˆæœ¬",onClick:Z=>i(y)},P[10]||(P[10]=[t("i",{class:"fas fa-check-circle"},null,-1)]),8,io)])])])}),128))])]),S.value.length===0?(l(),r("div",no,P[12]||(P[12]=[t("i",{class:"fas fa-inbox mb-3 text-4xl text-gray-300 dark:text-gray-600"},null,-1),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"æš‚æ— è´¦æˆ·æ•°æ®",-1)]))):V("",!0)]))]),o.value?(l(),J(ks,{key:0,account:g.value,onClose:P[1]||(P[1]=y=>o.value=!1),onSaved:f},null,8,["account"])):V("",!0),$.value?(l(),J(Os,{key:1,account:g.value,onClose:P[2]||(P[2]=y=>$.value=!1),onSaved:p},null,8,["account"])):V("",!0),m.value?(l(),J(La,{key:2,account:g.value,onClose:P[3]||(P[3]=y=>m.value=!1)},null,8,["account"])):V("",!0)]))}},go=Q(uo,[["__scopeId","data-v-6e67f7b6"]]),co={class:"quota-allocation-analysis"},xo={class:"card p-6"},po={key:0,class:"flex h-64 items-center justify-center"},yo={key:1},mo={key:0,class:"mb-6 rounded-lg border-l-4 border-red-500 bg-red-50 p-4 dark:bg-red-900/20"},vo={class:"flex items-start"},fo={class:"flex-1"},bo={class:"mt-1 text-sm text-red-700 dark:text-red-400"},ko={class:"mt-3 space-y-2"},ho={class:"flex items-center justify-between"},_o={class:"flex-1"},$o={class:"font-medium text-gray-900 dark:text-gray-100"},wo={class:"ml-2 text-xs text-gray-500"},Co={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},Po={class:"font-semibold text-red-600 dark:text-red-400"},Fo={class:"ml-4 text-right"},Ao={class:"text-lg font-bold text-red-600 dark:text-red-400"},So={class:"text-xs text-gray-500 dark:text-gray-400"},Uo={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},To={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Vo={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Do={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Ro={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Io={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},qo={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Lo={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Mo={class:"rounded-lg bg-gradient-to-br from-orange-50 to-yellow-50 p-4 dark:from-orange-900/20 dark:to-yellow-900/20"},Bo={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Ko={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},jo={class:"mb-4 flex flex-wrap items-center gap-3"},zo={class:"overflow-x-auto"},No={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Eo={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Oo={class:"px-4 py-3"},Qo={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Yo={class:"text-xs text-gray-500 dark:text-gray-400"},Go={class:"px-4 py-3"},Ho={class:"px-4 py-3 text-sm text-gray-900 dark:text-gray-100"},Wo={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Xo={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Zo={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Jo={class:"px-4 py-3 text-right"},tl={class:"flex items-center justify-end gap-2"},el={class:"h-2 w-20 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700"},sl={class:"text-sm text-gray-900 dark:text-gray-100"},al={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},ol={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},ll={class:"px-4 py-3 text-right"},rl={class:"flex items-center justify-end gap-2"},il={class:"h-2 w-20 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700"},nl={class:"text-sm text-gray-900 dark:text-gray-100"},dl={key:1,class:"py-12 text-center"},ul={class:"mt-4 text-center text-xs text-gray-500 dark:text-gray-400"},gl={key:2,class:"py-12 text-center"},cl={key:0,class:"mt-2 text-sm text-red-500"},xl={__name:"QuotaAllocationAnalysis",setup(A){const b=_(!1),n=_(null),h=_(""),g=_("all"),o=_("dailyRemaining"),$=_(""),m=_(""),v=H(()=>{var s;if(!((s=n.value)!=null&&s.keyDetails))return[];let x=[...n.value.keyDetails];if(g.value!=="all"&&(x=x.filter(e=>e.status===g.value)),h.value){const e=h.value.toLowerCase();x=x.filter(i=>i.name.toLowerCase().includes(e)||i.owner.toLowerCase().includes(e)||i.id.toLowerCase().includes(e))}return x.sort((e,i)=>{switch(o.value){case"dailyRemaining":return i.dailyRemaining-e.dailyRemaining;case"dailyUtilization":return parseFloat(i.dailyUtilization)-parseFloat(e.dailyUtilization);case"totalRemaining":return i.totalRemaining-e.totalRemaining;case"name":return e.name.localeCompare(i.name);default:return 0}}),x}),S=async()=>{b.value=!0,m.value="";try{const x=await D.get("/admin/quota-allocation-stats");x.success?(n.value=x.data,$.value=new Date(x.timestamp).toLocaleString("zh-CN")):(m.value=x.error||"åŠ è½½å¤±è´¥",n.value=null)}catch(x){console.error("Failed to load quota allocation stats:",x),m.value=x.message||"ç½‘ç»œè¯·æ±‚å¤±è´¥",n.value=null}finally{b.value=!1}};return z(()=>{S()}),(x,s)=>(l(),r("div",co,[t("div",xo,[t("div",{class:"mb-6 flex items-center justify-between"},[s[4]||(s[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"é¢åº¦é…ç½®ç›‘æ§"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," ç›‘æ§å„API Keyçš„é¢åº¦é…ç½®æƒ…å†µ,é¿å…è¶…é¢åˆ†é… ")],-1)),t("button",{class:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600",onClick:S},s[3]||(s[3]=[t("i",{class:"fas fa-sync-alt mr-2"},null,-1),I(" åˆ·æ–°æ•°æ® ",-1)]))]),b.value?(l(),r("div",po,s[5]||(s[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):n.value?(l(),r("div",yo,[n.value.overAllocatedAccountsCount>0?(l(),r("div",mo,[t("div",vo,[s[8]||(s[8]=t("i",{class:"fas fa-exclamation-triangle mr-3 mt-1 text-red-600 dark:text-red-400"},null,-1)),t("div",fo,[s[6]||(s[6]=t("h4",{class:"font-semibold text-red-800 dark:text-red-300"},"âš ï¸ æ£€æµ‹åˆ°è¶…é¢åˆ†é…é£é™©",-1)),t("p",bo," å‘ç° "+a(n.value.overAllocatedAccountsCount)+" ä¸ªè´¦æˆ·çš„API Keyæ€»é¢åº¦è¶…è¿‡äº†è´¦æˆ·æœ¬èº«çš„æ¯æ—¥é™é¢ï¼Œå¯èƒ½å¯¼è‡´éƒ¨åˆ†API Keyæ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚ ",1),t("div",ko,[(l(!0),r(L,null,B(n.value.accountQuotaComparison.filter(e=>e.isOverAllocated),e=>(l(),r("div",{key:e.accountId,class:"rounded-md bg-white p-3 dark:bg-gray-800"},[t("div",ho,[t("div",_o,[t("div",$o,[I(a(e.accountName)+" ",1),t("span",wo,"("+a(e.platform)+")",1)]),t("div",Co,[I(" è´¦æˆ·é¢åº¦: $"+a(e.accountDailyQuota.toFixed(2))+" | API Keyæ€»åˆ†é…: $"+a(e.totalAllocated.toFixed(2))+" | è¶…é¢: ",1),t("span",Po," $"+a(e.overAllocated.toFixed(2)),1)])]),t("div",Fo,[t("div",Ao,a(e.allocationRate)+"% ",1),t("div",So,a(e.relatedKeysCount)+" ä¸ªKey ",1)])])]))),128))]),s[7]||(s[7]=t("p",{class:"mt-3 text-xs text-red-600 dark:text-red-400"}," ğŸ’¡ å»ºè®®ï¼šè°ƒæ•´API Keyçš„é¢åº¦é…ç½®ï¼Œæˆ–å¢åŠ è´¦æˆ·çš„æ¯æ—¥é™é¢ ",-1))])])])):V("",!0),t("div",Uo,[t("div",To,[s[9]||(s[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ´»è·ƒAPI Keys",-1)),t("div",Vo,a(n.value.activeKeys)+" / "+a(n.value.totalKeys),1)]),t("div",Do,[s[10]||(s[10]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ—¥é¢åº¦é…ç½®æ€»è®¡",-1)),t("div",Ro," $"+a(n.value.totalDailyQuotaAllocated.toFixed(2)),1),t("div",Io," å·²ç”¨: $"+a(n.value.totalDailyUsed.toFixed(2))+" ("+a(n.value.dailyUtilizationRate)+"%) ",1)]),t("div",qo,[s[11]||(s[11]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ—¥å‰©ä½™é¢åº¦",-1)),t("div",Lo," $"+a(n.value.totalDailyRemaining.toFixed(2)),1),t("div",{class:T(["mt-1 text-xs",n.value.dailyUtilizationRate>80?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"])},[t("i",{class:T(n.value.dailyUtilizationRate>80?"fas fa-exclamation-triangle":"fas fa-check-circle")},null,2),I(" "+a(n.value.dailyUtilizationRate>80?"ä½¿ç”¨ç‡åé«˜":"ä½¿ç”¨æ­£å¸¸"),1)],2)]),t("div",Mo,[s[12]||(s[12]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æœ¬æœˆæ€»ä½¿ç”¨",-1)),t("div",Bo," $"+a((n.value.totalMonthlyUsed||0).toFixed(2)),1),t("div",Ko," æ´»è·ƒKey: "+a(n.value.activeKeys)+"ä¸ª ",1)])]),t("div",jo,[F(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>h.value=e),class:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",placeholder:"æœç´¢ API Key åç§°æˆ–æ‰€æœ‰è€…...",type:"text"},null,512),[[R,h.value]]),F(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>g.value=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800"},s[13]||(s[13]=[t("option",{value:"all"},"å…¨éƒ¨çŠ¶æ€",-1),t("option",{value:"active"},"æ´»è·ƒ",-1),t("option",{value:"inactive"},"æœªæ¿€æ´»",-1)]),512),[[q,g.value]]),F(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>o.value=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800"},s[14]||(s[14]=[t("option",{value:"dailyRemaining"},"æŒ‰æ—¥å‰©ä½™é¢åº¦",-1),t("option",{value:"dailyUtilization"},"æŒ‰æ—¥ä½¿ç”¨ç‡",-1),t("option",{value:"totalRemaining"},"æŒ‰æ€»å‰©ä½™é¢åº¦",-1),t("option",{value:"name"},"æŒ‰åç§°",-1)]),512),[[q,o.value]])]),t("div",zo,[t("table",No,[s[15]||(s[15]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," API Key "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," çŠ¶æ€ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ‰€æœ‰è€… "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ—¥é¢åº¦ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ—¥å·²ç”¨ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ—¥å‰©ä½™ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ—¥ä½¿ç”¨ç‡ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»é¢åº¦ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»å·²ç”¨ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»ä½¿ç”¨ç‡ ")])],-1)),t("tbody",Eo,[(l(!0),r(L,null,B(v.value,e=>(l(),r("tr",{key:e.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Oo,[t("div",Qo,a(e.name),1),t("div",Yo,a(e.id.substring(0,8))+"... ",1)]),t("td",Go,[t("span",{class:T(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",e.status==="active"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"])},a(e.status==="active"?"æ´»è·ƒ":"æœªæ¿€æ´»"),3)]),t("td",Ho,a(e.owner),1),t("td",Wo," $"+a(e.dailyLimit.toFixed(2)),1),t("td",Xo," $"+a(e.dailyUsed.toFixed(2)),1),t("td",Zo," $"+a(e.dailyRemaining.toFixed(2)),1),t("td",Jo,[t("div",tl,[t("div",el,[t("div",{class:T(["h-full transition-all",parseFloat(e.dailyUtilization)>80?"bg-red-500":parseFloat(e.dailyUtilization)>50?"bg-yellow-500":"bg-green-500"]),style:G({width:Math.min(100,parseFloat(e.dailyUtilization))+"%"})},null,6)]),t("span",sl,a(e.dailyUtilization)+"% ",1)])]),t("td",al," $"+a(e.totalLimit.toFixed(2)),1),t("td",ol," $"+a(e.totalAccumulated.toFixed(2)),1),t("td",ll,[t("div",rl,[t("div",il,[t("div",{class:T(["h-full transition-all",parseFloat(e.totalUtilization)>80?"bg-red-500":parseFloat(e.totalUtilization)>50?"bg-yellow-500":"bg-green-500"]),style:G({width:Math.min(100,parseFloat(e.totalUtilization))+"%"})},null,6)]),t("span",nl,a(e.totalUtilization)+"% ",1)])])]))),128))])])]),v.value.length===0?(l(),r("div",dl,s[16]||(s[16]=[t("i",{class:"fas fa-search mb-3 text-4xl text-gray-400"},null,-1),t("p",{class:"text-gray-600 dark:text-gray-400"},"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„API Key",-1)]))):V("",!0),t("div",ul," æœ€åæ›´æ–°: "+a($.value),1)])):(l(),r("div",gl,[s[17]||(s[17]=t("i",{class:"fas fa-exclamation-triangle mb-3 text-4xl text-yellow-500"},null,-1)),s[18]||(s[18]=t("p",{class:"text-gray-600 dark:text-gray-400"},"åŠ è½½æ•°æ®å¤±è´¥,è¯·ç¨åé‡è¯•",-1)),m.value?(l(),r("p",cl,a(m.value),1)):V("",!0),t("button",{class:"mt-4 rounded-lg bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",onClick:S}," é‡è¯• ")]))])]))}},pl=Q(xl,[["__scopeId","data-v-11cb04ae"]]),yl={class:"account-quota-analysis"},ml={class:"card p-6"},vl={key:0,class:"flex h-64 items-center justify-center"},fl={key:1},bl={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},kl={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},hl={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},_l={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},$l={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},wl={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Cl={class:"rounded-lg bg-gradient-to-br from-yellow-50 to-orange-50 p-4 dark:from-yellow-900/20 dark:to-orange-900/20"},Pl={class:"mt-1 text-2xl font-bold text-yellow-600 dark:text-yellow-400"},Fl={class:"rounded-lg bg-gradient-to-br from-red-50 to-pink-50 p-4 dark:from-red-900/20 dark:to-pink-900/20"},Al={class:"mt-1 text-2xl font-bold text-red-600 dark:text-red-400"},Sl={class:"mb-4 flex flex-wrap items-center gap-3"},Ul={class:"overflow-x-auto"},Tl={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Vl={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Dl={class:"px-4 py-3"},Rl={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Il={class:"text-xs text-gray-500 dark:text-gray-400"},ql={class:"px-4 py-3"},Ll={class:"px-4 py-3"},Ml={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Bl={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Kl={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},jl={class:"px-4 py-3 text-right"},zl={class:"flex items-center justify-end gap-2"},Nl={class:"h-2 w-20 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700"},El={class:"text-sm text-gray-900 dark:text-gray-100"},Ol={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Ql={key:0,class:"py-12 text-center"},Yl={class:"mt-4 text-center text-xs text-gray-500 dark:text-gray-400"},Gl={key:2,class:"py-12 text-center"},Hl={key:0,class:"mt-2 text-sm text-red-500"},Wl={__name:"AccountDailyQuotaAnalysis",setup(A){const b=_(!1),n=_(null),h=_(""),g=_("all"),o=_("all"),$=_(""),m=_(""),v=H(()=>{var f;if(!((f=n.value)!=null&&f.accounts))return[];let w=[...n.value.accounts];if(g.value!=="all"&&(w=w.filter(p=>p.status===g.value)),o.value!=="all"&&(w=w.filter(p=>p.platform===o.value)),h.value){const p=h.value.toLowerCase();w=w.filter(d=>d.name.toLowerCase().includes(p)||d.id.toLowerCase().includes(p))}return w}),S=w=>({"claude-console":"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",claude:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-400",gemini:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",openai:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"})[w]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400",x=w=>({"claude-console":"Console",claude:"Claude",gemini:"Gemini",openai:"OpenAI"})[w]||w,s=w=>({over_limit:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",near_limit:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",normal:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"})[w]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400",e=w=>({over_limit:"è¶…é™",near_limit:"æ¥è¿‘é™é¢",normal:"æ­£å¸¸"})[w]||w,i=async()=>{b.value=!0,m.value="";try{const w=await D.get("/admin/account-daily-quota-stats");w.success?(n.value=w.data,$.value=new Date(w.timestamp).toLocaleString("zh-CN")):(m.value=w.error||"åŠ è½½å¤±è´¥",n.value=null)}catch(w){console.error("Failed to load account daily quota stats:",w),m.value=w.message||"ç½‘ç»œè¯·æ±‚å¤±è´¥",n.value=null}finally{b.value=!1}};return z(()=>{i()}),(w,f)=>(l(),r("div",yl,[t("div",ml,[t("div",{class:"mb-6 flex items-center justify-between"},[f[4]||(f[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"è´¦æˆ·æ¯æ—¥é¢åº¦ç›‘æ§"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," ç›‘æ§å„è´¦æˆ·çš„æ¯æ—¥é¢åº¦é…ç½®å’Œä½¿ç”¨æƒ…å†µï¼Œé¿å…è¶…é¢ä½¿ç”¨ ")],-1)),t("button",{class:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600",onClick:i},f[3]||(f[3]=[t("i",{class:"fas fa-sync-alt mr-2"},null,-1),I(" åˆ·æ–°æ•°æ® ",-1)]))]),b.value?(l(),r("div",vl,f[5]||(f[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):n.value?(l(),r("div",fl,[t("div",bl,[t("div",kl,[f[6]||(f[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"é…ç½®é¢åº¦çš„è´¦æˆ·",-1)),t("div",hl,a(n.value.accountsWithQuota)+" / "+a(n.value.totalAccounts),1)]),t("div",_l,[f[7]||(f[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»æ¯æ—¥é¢åº¦",-1)),t("div",$l," $"+a(n.value.totalDailyQuota.toFixed(2)),1),t("div",wl," å·²ç”¨: $"+a(n.value.totalDailyUsage.toFixed(2))+" ("+a(n.value.overallUtilizationRate)+"%) ",1)]),t("div",Cl,[f[8]||(f[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ¥è¿‘é™é¢è´¦æˆ·",-1)),t("div",Pl,a(n.value.accountsNearLimit),1),f[9]||(f[9]=t("div",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"ä½¿ç”¨ç‡ â‰¥ 80%",-1))]),t("div",Fl,[f[10]||(f[10]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"è¶…é™è´¦æˆ·",-1)),t("div",Al,a(n.value.accountsOverLimit),1),f[11]||(f[11]=t("div",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},"ä½¿ç”¨ç‡ â‰¥ 100%",-1))])]),t("div",Sl,[F(t("input",{"onUpdate:modelValue":f[0]||(f[0]=p=>h.value=p),class:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",placeholder:"æœç´¢è´¦æˆ·åç§°...",type:"text"},null,512),[[R,h.value]]),F(t("select",{"onUpdate:modelValue":f[1]||(f[1]=p=>g.value=p),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800"},f[12]||(f[12]=[t("option",{value:"all"},"å…¨éƒ¨çŠ¶æ€",-1),t("option",{value:"over_limit"},"è¶…é™",-1),t("option",{value:"near_limit"},"æ¥è¿‘é™é¢",-1),t("option",{value:"normal"},"æ­£å¸¸",-1)]),512),[[q,g.value]]),F(t("select",{"onUpdate:modelValue":f[2]||(f[2]=p=>o.value=p),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800"},f[13]||(f[13]=[E('<option value="all" data-v-766a0242>å…¨éƒ¨å¹³å°</option><option value="claude-console" data-v-766a0242>Claude Console</option><option value="claude" data-v-766a0242>Claude</option><option value="gemini" data-v-766a0242>Gemini</option><option value="openai" data-v-766a0242>OpenAI</option>',5)]),512),[[q,o.value]])]),t("div",Ul,[t("table",Tl,[f[14]||(f[14]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è´¦æˆ·åç§° "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å¹³å° "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," çŠ¶æ€ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ¯æ—¥é¢åº¦ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å·²ä½¿ç”¨ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å‰©ä½™ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ä½¿ç”¨ç‡ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," é‡ç½®æ—¶é—´ ")])],-1)),t("tbody",Vl,[(l(!0),r(L,null,B(v.value,p=>(l(),r("tr",{key:p.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Dl,[t("div",Rl,a(p.name),1),t("div",Il,a(p.id.substring(0,8))+"... ",1)]),t("td",ql,[t("span",{class:T(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",S(p.platform)])},a(x(p.platform)),3)]),t("td",Ll,[t("span",{class:T(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",s(p.status)])},a(e(p.status)),3)]),t("td",Ml," $"+a(p.dailyQuota.toFixed(2)),1),t("td",Bl," $"+a(p.dailyUsage.toFixed(2)),1),t("td",Kl," $"+a(p.dailyRemaining.toFixed(2)),1),t("td",jl,[t("div",zl,[t("div",Nl,[t("div",{class:T(["h-full transition-all",parseFloat(p.utilizationRate)>=100?"bg-red-500":parseFloat(p.utilizationRate)>=80?"bg-yellow-500":"bg-green-500"]),style:G({width:Math.min(100,parseFloat(p.utilizationRate))+"%"})},null,6)]),t("span",El,a(p.utilizationRate)+"% ",1)])]),t("td",Ol,a(p.quotaResetTime),1)]))),128))])])]),v.value.length===0?(l(),r("div",Ql,f[15]||(f[15]=[t("i",{class:"fas fa-search mb-3 text-4xl text-gray-400"},null,-1),t("p",{class:"text-gray-600 dark:text-gray-400"},"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è´¦æˆ·",-1)]))):V("",!0),t("div",Yl," æœ€åæ›´æ–°: "+a($.value),1)])):(l(),r("div",Gl,[f[16]||(f[16]=t("i",{class:"fas fa-exclamation-triangle mb-3 text-4xl text-yellow-500"},null,-1)),f[17]||(f[17]=t("p",{class:"text-gray-600 dark:text-gray-400"},"åŠ è½½æ•°æ®å¤±è´¥,è¯·ç¨åé‡è¯•",-1)),m.value?(l(),r("p",Hl,a(m.value),1)):V("",!0),t("button",{class:"mt-4 rounded-lg bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",onClick:i}," é‡è¯• ")]))])]))}},Xl=Q(Wl,[["__scopeId","data-v-766a0242"]]),Zl={class:"analytics-container"},Jl={class:"mb-6"},tr={class:"border-b border-gray-200 dark:border-gray-700"},er={"aria-label":"Tabs",class:"-mb-px flex space-x-8"},sr=["onClick"],ar={class:"tab-content"},or={class:"space-y-6"},lr={class:"space-y-6"},rr={class:"space-y-6"},ir={key:0,class:"space-y-6"},nr={key:1,class:"space-y-6"},dr={key:2,class:"space-y-6"},ur={__name:"AnalyticsView",setup(A){const b=_("cost-efficiency"),n=[{id:"cost-efficiency",name:"è´¦æˆ·æ€§ä»·æ¯”å¯¹æ¯”",icon:"fas fa-chart-line"},{id:"api-key-breakdown",name:"API Key è°ƒç”¨æ˜ç»†",icon:"fas fa-key"},{id:"cost-trends",name:"æˆæœ¬è¶‹åŠ¿åˆ†æ",icon:"fas fa-chart-area"},{id:"cost-tracking",name:"æˆæœ¬é…ç½®ä¸éªŒè¯",icon:"fas fa-cog"},{id:"quota-allocation",name:"é¢åº¦é…ç½®ç›‘æ§",icon:"fas fa-balance-scale"},{id:"account-daily-quota",name:"è´¦æˆ·æ¯æ—¥é¢åº¦",icon:"fas fa-wallet"}];return(h,g)=>(l(),r("div",Zl,[g[0]||(g[0]=t("div",{class:"mb-6"},[t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"ç»Ÿè®¡åˆ†æ"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," æ·±åº¦åˆ†æè´¦æˆ·æ€§ä»·æ¯”ã€API Key ä½¿ç”¨æƒ…å†µå’Œæˆæœ¬è¶‹åŠ¿ ")],-1)),t("div",Jl,[t("div",tr,[t("nav",er,[(l(),r(L,null,B(n,o=>t("button",{key:o.id,class:T([b.value===o.id?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300","group inline-flex items-center border-b-2 px-1 py-4 text-sm font-medium transition-colors"]),onClick:$=>b.value=o.id},[t("i",{class:T([o.icon,"mr-2"])},null,2),I(" "+a(o.name),1)],10,sr)),64))])])]),t("div",ar,[F(t("div",or,[Y(Rt)],512),[[tt,b.value==="cost-efficiency"]]),F(t("div",lr,[Y(Ue)],512),[[tt,b.value==="api-key-breakdown"]]),F(t("div",rr,[Y(Ye)],512),[[tt,b.value==="cost-trends"]]),b.value==="cost-tracking"?(l(),r("div",ir,[Y(go)])):V("",!0),b.value==="quota-allocation"?(l(),r("div",nr,[Y(pl)])):V("",!0),b.value==="account-daily-quota"?(l(),r("div",dr,[Y(Xl)])):V("",!0)])]))}},mr=Q(ur,[["__scopeId","data-v-b45e47a8"]]);export{mr as default};
