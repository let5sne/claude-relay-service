import{E as Xt}from"./element-plus-CqiD73Lu.js";import{aP as Jt,r as D,c as lt,aX as Vt,o as ct,q as te,D as nt,V as ee,x as g,z as t,P as c,u as s,L as P,O as S,Q as ut,ac as mt,C as K,R as se,K as ae,al as oe,y as x,B as ne}from"./vue-vendor-Bsazo-x0.js";import{c as Y,s as Rt,_ as le,a as re}from"./index-CUAqR_V_.js";import{C as St}from"./chart-yFHxLHpB.js";import"./vendor-Dr8jvgFu.js";const ie=Jt("dashboard",()=>{const kt=D(!1),rt=D({totalApiKeys:0,activeApiKeys:0,totalAccounts:0,normalAccounts:0,abnormalAccounts:0,pausedAccounts:0,activeAccounts:0,rateLimitedAccounts:0,accountsByPlatform:{claude:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},"claude-console":{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},gemini:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},azure_openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},bedrock:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0}},todayRequests:0,totalRequests:0,todayTokens:0,todayInputTokens:0,todayOutputTokens:0,totalTokens:0,totalInputTokens:0,totalOutputTokens:0,totalCacheCreateTokens:0,totalCacheReadTokens:0,todayCacheCreateTokens:0,todayCacheReadTokens:0,systemRPM:0,systemTPM:0,realtimeRPM:0,realtimeTPM:0,metricsWindow:5,isHistoricalMetrics:!1,systemStatus:"正常",uptime:0,systemTimezone:8}),ht=D({todayCosts:{totalCost:0,formatted:{totalCost:"$0.000000"}},totalCosts:{totalCost:0,formatted:{totalCost:"$0.000000"}}}),it=D([]),n=D([]),yt=D([]),G=D({data:[],topApiKeys:[],totalApiKeys:0}),X=D(!1),L=D(null),J=D([]),ft=D({total:0,nextOffset:0,hasMore:!1}),tt=D([]),I=D({range:"30d",platform:"all",sortBy:"costPerMillion",order:"asc",interval:"day"}),l=D({type:"preset",preset:"7days",customStart:"",customEnd:"",customRange:null,presetOptions:[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}]}),F=D("day"),W=D("requests"),et=D([new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)]),N=lt(()=>{const r=rt.value.uptime,d=Math.floor(r/86400),f=Math.floor(r%86400/3600),m=Math.floor(r%3600/60);return d>0?`${d}天 ${f}小时`:f>0?`${f}小时 ${m}分钟`:`${m}分钟`});function R(r,d=!0){const f=r.getFullYear(),m=r.getMonth(),i=r.getDate();return d?new Date(Date.UTC(f,m,i-1,16,0,0,0)):new Date(Date.UTC(f,m,i,15,59,59,999))}async function At(r=null){kt.value=!0;try{let d={today:"today",all:"all"};r&&(d={today:{today:"today",all:"today"},"7days":{today:"7days",all:"7days"},monthly:{today:"monthly",all:"monthly"},all:{today:"today",all:"all"}}[r]||d);const[f,m,i]=await Promise.all([Y.get("/admin/dashboard"),Y.get(`/admin/usage-costs?period=${d.today}`),Y.get(`/admin/usage-costs?period=${d.all}`)]);if(f.success){const a=f.data.overview||{},u=f.data.recentActivity||{},p=f.data.systemAverages||{},k=f.data.realtimeMetrics||{},_=f.data.systemHealth||{};rt.value={totalApiKeys:a.totalApiKeys||0,activeApiKeys:a.activeApiKeys||0,totalAccounts:a.totalAccounts||a.totalClaudeAccounts||0,normalAccounts:a.normalAccounts||0,abnormalAccounts:a.abnormalAccounts||0,pausedAccounts:a.pausedAccounts||0,activeAccounts:a.activeAccounts||a.activeClaudeAccounts||0,rateLimitedAccounts:a.rateLimitedAccounts||a.rateLimitedClaudeAccounts||0,accountsByPlatform:a.accountsByPlatform||{claude:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},"claude-console":{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},gemini:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},azure_openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},bedrock:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0}},todayRequests:u.requestsToday||0,totalRequests:a.totalRequestsUsed||0,todayTokens:u.tokensToday||0,todayInputTokens:u.inputTokensToday||0,todayOutputTokens:u.outputTokensToday||0,totalTokens:a.totalTokensUsed||0,totalInputTokens:a.totalInputTokensUsed||0,totalOutputTokens:a.totalOutputTokensUsed||0,totalCacheCreateTokens:a.totalCacheCreateTokensUsed||0,totalCacheReadTokens:a.totalCacheReadTokensUsed||0,todayCacheCreateTokens:u.cacheCreateTokensToday||0,todayCacheReadTokens:u.cacheReadTokensToday||0,systemRPM:p.rpm||0,systemTPM:p.tpm||0,realtimeRPM:k.rpm||0,realtimeTPM:k.tpm||0,metricsWindow:k.windowMinutes||5,isHistoricalMetrics:k.isHistorical||!1,systemStatus:_.redisConnected?"正常":"异常",uptime:_.uptime||0,systemTimezone:f.data.systemTimezone||8}}m.success&&i.success&&(ht.value={todayCosts:m.data.totalCosts||{totalCost:0,formatted:{totalCost:"$0.000000"}},totalCosts:i.data.totalCosts||{totalCost:0,formatted:{totalCost:"$0.000000"}}})}catch(d){console.error("加载仪表板数据失败:",d)}finally{kt.value=!1}}async function _t(r=7,d="day"){try{let f="/admin/usage-trend?";if(d==="hour")if(f+="granularity=hour",l.value.customRange&&l.value.customRange.length===2){const i=a=>{const[p,k]=a.split(" "),[_,v,E]=p.split("-").map(Number),[z,V,Z]=k.split(":").map(Number);return new Date(Date.UTC(_,v-1,E,z-8,V,Z)).toISOString()};f+=`&startDate=${encodeURIComponent(i(l.value.customRange[0]))}`,f+=`&endDate=${encodeURIComponent(i(l.value.customRange[1]))}`}else{const i=new Date;let a,u;if(l.value.type==="preset")switch(l.value.preset){case"last24h":{u=new Date(i),a=new Date(i.getTime()-24*60*60*1e3);break}case"yesterday":{const p=new Date;p.setDate(p.getDate()-1),a=R(p,!0),u=R(p,!1);break}case"dayBefore":{const p=new Date;p.setDate(p.getDate()-2),a=R(p,!0),u=R(p,!1);break}default:a=new Date(i.getTime()-24*60*60*1e3),u=i}else a=new Date(i.getTime()-r*24*60*60*1e3),u=i;f+=`&startDate=${encodeURIComponent(a.toISOString())}`,f+=`&endDate=${encodeURIComponent(u.toISOString())}`}else f+=`granularity=day&days=${r}`;const m=await Y.get(f);m.success&&(n.value=m.data)}catch(f){console.error("加载使用趋势失败:",f)}}async function pt(r="daily"){try{let d=`/admin/model-stats?period=${r}`;if(l.value.type==="custom"||F.value==="hour"){if(l.value.customRange&&l.value.customRange.length===2){const m=i=>{const[u,p]=i.split(" "),[k,_,v]=u.split("-").map(Number),[E,z,V]=p.split(":").map(Number);return new Date(Date.UTC(k,_-1,v,E-8,z,V)).toISOString()};d+=`&startDate=${encodeURIComponent(m(l.value.customRange[0]))}`,d+=`&endDate=${encodeURIComponent(m(l.value.customRange[1]))}`}else if(F.value==="hour"&&l.value.type==="preset"){const m=new Date;let i,a;switch(l.value.preset){case"last24h":{a=new Date(m),i=new Date(m.getTime()-24*60*60*1e3);break}case"yesterday":{const u=new Date;u.setDate(u.getDate()-1),i=R(u,!0),a=R(u,!1);break}case"dayBefore":{const u=new Date;u.setDate(u.getDate()-2),i=R(u,!0),a=R(u,!1);break}default:i=new Date(m.getTime()-24*60*60*1e3),a=m}d+=`&startDate=${encodeURIComponent(i.toISOString())}`,d+=`&endDate=${encodeURIComponent(a.toISOString())}`}}else if(l.value.type==="preset"&&F.value==="day"){const m=new Date;let i,a;const u=l.value.presetOptions.find(p=>p.value===l.value.preset);if(u){if(l.value.preset==="today")i=R(m,!0),a=R(m,!1);else{const p=new Date;p.setDate(p.getDate()-(u.days-1)),i=R(p,!0),a=R(m,!1)}d+=`&startDate=${encodeURIComponent(i.toISOString())}`,d+=`&endDate=${encodeURIComponent(a.toISOString())}`}}const f=await Y.get(d);f.success&&(yt.value=f.data)}catch(d){console.error("加载模型统计失败:",d)}}async function Ct(r="requests"){try{let d="/admin/api-keys-usage-trend?",f=7;if(F.value==="hour")if(d+="granularity=hour",l.value.customRange&&l.value.customRange.length===2){const i=a=>{const[p,k]=a.split(" "),[_,v,E]=p.split("-").map(Number),[z,V,Z]=k.split(":").map(Number);return new Date(Date.UTC(_,v-1,E,z-8,V,Z)).toISOString()};d+=`&startDate=${encodeURIComponent(i(l.value.customRange[0]))}`,d+=`&endDate=${encodeURIComponent(i(l.value.customRange[1]))}`}else{const i=new Date;let a,u;if(l.value.type==="preset")switch(l.value.preset){case"last24h":{u=new Date(i),a=new Date(i.getTime()-24*60*60*1e3);break}case"yesterday":{const p=new Date;p.setDate(p.getDate()-1),a=R(p,!0),u=R(p,!1);break}case"dayBefore":{const p=new Date;p.setDate(p.getDate()-2),a=R(p,!0),u=R(p,!1);break}default:a=new Date(i.getTime()-24*60*60*1e3),u=i}else a=new Date(i.getTime()-24*60*60*1e3),u=i;d+=`&startDate=${encodeURIComponent(a.toISOString())}`,d+=`&endDate=${encodeURIComponent(u.toISOString())}`}else f=l.value.type==="preset"?l.value.preset==="today"?1:l.value.preset==="7days"?7:30:Tt(l.value.customStart,l.value.customEnd),d+=`granularity=day&days=${f}`;d+=`&metric=${r}`;const m=await Y.get(d);m.success&&(G.value={data:m.data||[],topApiKeys:m.topApiKeys||[],totalApiKeys:m.totalApiKeys||0})}catch(d){console.error("加载API Keys趋势失败:",d)}}function st(r){l.value.type="preset",l.value.preset=r;const d=l.value.presetOptions.find(f=>f.value===r);if(d){const f=new Date;let m,i;if(F.value==="hour")switch(r){case"last24h":{i=new Date(f),m=new Date(f.getTime()-24*60*60*1e3);break}case"yesterday":{const a=new Date;a.setDate(a.getDate()-1),m=R(a,!0),i=R(a,!1);break}case"dayBefore":{const a=new Date;a.setDate(a.getDate()-2),m=R(a,!0),i=R(a,!1);break}}else m=new Date(f),i=new Date(f),r==="today"?(m.setHours(0,0,0,0),i.setHours(23,59,59,999)):(m.setDate(f.getDate()-(d.days-1)),m.setHours(0,0,0,0),i.setHours(23,59,59,999));if(l.value.customStart=m.toISOString().split("T")[0],l.value.customEnd=i.toISOString().split("T")[0],F.value==="hour"&&(r==="yesterday"||r==="dayBefore")){const a=new Date;r==="yesterday"?a.setDate(a.getDate()-1):a.setDate(a.getDate()-2);const u=a.getFullYear(),p=String(a.getMonth()+1).padStart(2,"0"),k=String(a.getDate()).padStart(2,"0");l.value.customRange=[`${u}-${p}-${k} 00:00:00`,`${u}-${p}-${k} 23:59:59`]}else{const a=u=>{const _=new Date(u.getTime()+288e5),v=_.getUTCFullYear(),E=String(_.getUTCMonth()+1).padStart(2,"0"),z=String(_.getUTCDate()).padStart(2,"0"),V=String(_.getUTCHours()).padStart(2,"0"),Z=String(_.getUTCMinutes()).padStart(2,"0"),$=String(_.getUTCSeconds()).padStart(2,"0");return`${v}-${E}-${z} ${V}:${Z}:${$}`};l.value.customRange=[a(m),a(i)]}}dt()}function Dt(r){if(r&&r.length===2){l.value.type="custom",l.value.preset="",l.value.customRange=r,l.value.customStart=r[0].split(" ")[0],l.value.customEnd=r[1].split(" ")[0];const d=i=>{const[a,u]=i.split(" "),[p,k,_]=a.split("-").map(Number),[v,E,z]=u.split(":").map(Number);return new Date(p,k-1,_,v,E,z)},f=d(r[0]),m=d(r[1]);if(F.value==="hour"){if((m-f)/36e5>24){Rt("小时粒度下日期范围不能超过24小时","warning");return}}else if(Math.ceil((m-f)/864e5)+1>31){Rt("日期范围不能超过 31 天","warning");return}dt()}else r===null&&st(F.value==="hour"?"last24h":"7days")}function Mt(r){if(F.value=r,r==="hour"){if(l.value.presetOptions=[{value:"last24h",label:"近24小时",hours:24},{value:"yesterday",label:"昨天",hours:24},{value:"dayBefore",label:"前天",hours:24}],l.value.type==="custom"&&l.value.customRange&&l.value.customRange.length===2){const d=new Date(l.value.customRange[0]);if((new Date(l.value.customRange[1])-d)/(1e3*60*60)>24){Rt("小时粒度下日期范围不能超过24小时，已切换到近24小时","warning"),st("last24h");return}}if(["today","7days","30days"].includes(l.value.preset)){st("last24h");return}}else if(l.value.presetOptions=[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}],["last24h","yesterday","dayBefore"].includes(l.value.preset)){st("7days");return}dt()}async function dt(){let r,d="monthly";if(l.value.type==="preset"){const f=l.value.presetOptions.find(m=>m.value===l.value.preset);F.value==="hour"?(r=1,d="daily"):(r=f?f.days:7,l.value.preset==="today"?d="daily":d="monthly")}else{if(F.value==="hour"){const f=new Date(l.value.customRange[0]),m=new Date(l.value.customRange[1]),i=Math.ceil((m-f)/(1e3*60*60));r=Math.ceil(i/24)||1}else r=Tt(l.value.customStart,l.value.customEnd);d="daily"}await Promise.all([_t(r,F.value),pt(d),Ct(W.value)])}function Tt(r,d){if(!r||!d)return 7;const f=new Date(r),m=new Date(d),i=Math.abs(m-f);return Math.ceil(i/(1e3*60*60*24))||7}function Bt(r){return r>new Date}async function j(){var r,d,f,m,i;if(!X.value){X.value=!0;try{const a=I.value,u={};a.range&&(u.range=a.range),a.platform&&a.platform!=="all"&&(u.platform=a.platform),a.groupId&&(u.groupId=a.groupId);const[p,k,_]=await Promise.all([Y.get("/admin/dashboard/cost-efficiency/summary",{params:u}),Y.get("/admin/dashboard/cost-efficiency/accounts",{params:{...u,sortBy:a.sortBy,order:a.order,limit:a.limit||12}}),Y.get("/admin/dashboard/cost-efficiency/trends",{params:{...u,interval:a.interval||"day"}})]);L.value=p.success?p.data:null,k.success?(J.value=((r=k.data)==null?void 0:r.items)||[],ft.value={total:((d=k.data)==null?void 0:d.total)||0,nextOffset:((f=k.data)==null?void 0:f.nextOffset)||0,hasMore:((m=k.data)==null?void 0:m.hasMore)||!1}):(J.value=[],ft.value={total:0,nextOffset:0,hasMore:!1}),tt.value=_.success?((i=_.data)==null?void 0:i.data)||[]:[]}catch(a){console.error("❌ 加载性价比数据失败:",a),Rt("加载性价比数据失败","error")}finally{X.value=!1}}}function gt(r){I.value.range!==r&&(I.value.range=r,j())}function xt(r){I.value.platform!==r&&(I.value.platform=r,j())}function bt(r){I.value.sortBy===r?I.value.order=I.value.order==="asc"?"desc":"asc":(I.value.sortBy=r,I.value.order=r==="cost"?"desc":"asc"),j()}function at(r){I.value.interval!==r&&(I.value.interval=r,j())}return{loading:kt,dashboardData:rt,costsData:ht,modelStats:it,trendData:n,dashboardModelStats:yt,apiKeysTrendData:G,efficiencyLoading:X,efficiencySummary:L,efficiencyAccounts:J,efficiencyAccountsMeta:ft,efficiencyTrends:tt,costEfficiencyFilters:I,dateFilter:l,trendGranularity:F,apiKeysTrendMetric:W,defaultTime:et,formattedUptime:N,loadDashboardData:At,loadUsageTrend:_t,loadModelStats:pt,loadApiKeysTrend:Ct,loadCostEfficiencyData:j,setDateFilterPreset:st,onCustomDateRangeChange:Dt,setTrendGranularity:Mt,refreshChartsData:dt,disabledDate:Bt,setCostEfficiencyRange:gt,setCostEfficiencyPlatform:xt,toggleCostEfficiencySort:bt,setCostEfficiencyInterval:at}}),de={class:"mb-4 grid grid-cols-1 gap-3 sm:mb-6 sm:grid-cols-2 sm:gap-4 md:mb-8 md:gap-6 lg:grid-cols-4"},ce={class:"stat-card"},ue={class:"flex items-center justify-between"},me={class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},ye={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},fe={class:"stat-card"},pe={class:"flex items-center justify-between"},ge={class:"flex-1"},xe={class:"flex flex-wrap items-baseline gap-x-2"},be={class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},ve={key:0,class:"flex items-center gap-2"},ke=["title"],he={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},_e=["title"],Ce={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},De=["title"],Te={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},we=["title"],Pe={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},$e=["title"],Re={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Se=["title"],Ae={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Me=["title"],Be={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Ie={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ue={key:0,class:"text-red-600"},Fe={key:1,class:"text-gray-600 dark:text-gray-400"},Oe={key:2,class:"text-yellow-600"},Ke={class:"stat-card"},Le={class:"flex items-center justify-between"},Ee={class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},ze={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},qe={class:"stat-card"},Ne={class:"flex items-center justify-between"},He={class:"text-2xl font-bold text-green-600 sm:text-3xl"},je={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ve={class:"mb-4 grid grid-cols-1 gap-3 sm:mb-6 sm:grid-cols-2 sm:gap-4 md:mb-8 md:gap-6 lg:grid-cols-4"},Ye={class:"stat-card"},Ge={class:"flex items-center justify-between"},We={class:"mr-8 flex-1"},Ze={class:"mb-2 flex flex-wrap items-baseline gap-2"},Qe={class:"text-xl font-bold text-blue-600 sm:text-2xl md:text-3xl"},Xe={class:"text-sm font-medium text-green-600"},Je={class:"text-xs text-gray-500 dark:text-gray-400"},ts={class:"flex flex-wrap items-center justify-between gap-x-4"},es={class:"font-medium"},ss={class:"font-medium"},as={key:0,class:"text-purple-600"},os={class:"font-medium"},ns={key:1,class:"text-purple-600"},ls={class:"font-medium"},rs={class:"stat-card"},is={class:"flex items-center justify-between"},ds={class:"mr-8 flex-1"},cs={class:"mb-2 flex flex-wrap items-baseline gap-2"},us={class:"text-xl font-bold text-emerald-600 sm:text-2xl md:text-3xl"},ms={class:"text-sm font-medium text-green-600"},ys={class:"text-xs text-gray-500 dark:text-gray-400"},fs={class:"flex flex-wrap items-center justify-between gap-x-4"},ps={class:"font-medium"},gs={class:"font-medium"},xs={key:0,class:"text-purple-600"},bs={class:"font-medium"},vs={key:1,class:"text-purple-600"},ks={class:"font-medium"},hs={class:"stat-card"},_s={class:"flex items-center justify-between"},Cs={class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"},Ds={class:"text-xs text-gray-400"},Ts={class:"text-2xl font-bold text-orange-600 sm:text-3xl"},ws={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ps={key:0,class:"text-yellow-600"},$s={class:"stat-card"},Rs={class:"flex items-center justify-between"},Ss={class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"},As={class:"text-xs text-gray-400"},Ms={class:"text-2xl font-bold text-rose-600 sm:text-3xl"},Bs={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Is={key:0,class:"text-yellow-600"},Us={class:"mb-8"},Fs={class:"mb-4 flex flex-col gap-4 sm:mb-6"},Os={class:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-end"},Ks={class:"flex flex-shrink-0 gap-1 overflow-x-auto rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},Ls=["onClick"],Es={class:"flex gap-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},zs={class:"flex items-center gap-2"},qs={key:0,class:"text-xs text-orange-600"},Ns={class:"flex items-center gap-2"},Hs={class:"flex items-center rounded-lg bg-gray-100 px-3 py-1 dark:bg-gray-700"},js={class:"relative inline-flex cursor-pointer items-center"},Vs={class:"ml-2.5 flex select-none items-center gap-1 text-sm font-medium text-gray-600 dark:text-gray-300"},Ys=["disabled"],Gs={class:"hidden sm:inline"},Ws={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},Zs={class:"card p-4 sm:p-6"},Qs={class:"relative",style:{height:"250px"}},Xs={class:"card p-4 sm:p-6"},Js={key:0,class:"py-8 text-center"},ta={key:1,class:"max-h-[250px] overflow-auto sm:max-h-[300px]"},ea={class:"min-w-full"},sa={class:"divide-y divide-gray-200 dark:divide-gray-600"},aa={class:"px-2 py-2 text-xs text-gray-900 dark:text-gray-100 sm:px-4 sm:text-sm"},oa=["title"],na={class:"hidden px-2 py-2 text-right text-xs text-gray-600 dark:text-gray-400 sm:table-cell sm:px-4 sm:text-sm"},la={class:"px-2 py-2 text-right text-xs text-gray-600 dark:text-gray-400 sm:px-4 sm:text-sm"},ra={class:"px-2 py-2 text-right text-xs font-medium text-green-600 sm:px-4 sm:text-sm"},ia={class:"hidden px-2 py-2 text-right text-xs font-medium sm:table-cell sm:px-4 sm:text-sm"},da={class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},ca={class:"mb-4 sm:mb-6 md:mb-8"},ua={class:"card p-4 sm:p-6"},ma={class:"sm:h-[300px]",style:{height:"250px"}},ya={class:"mb-4 sm:mb-6 md:mb-8"},fa={class:"card p-4 sm:p-6"},pa={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ga={class:"flex gap-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},xa={class:"mb-4 text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},ba={key:0},va={key:1},ka={class:"sm:h-[350px]",style:{height:"300px"}},ha={class:"mb-10"},_a={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Ca={class:"flex flex-wrap items-center gap-2"},Da={class:"flex gap-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},Ta=["onClick"],wa=["value"],Pa=["value"],$a=["disabled"],Ra={key:0,class:"flex h-40 items-center justify-center rounded-lg border border-dashed border-gray-300 bg-white text-sm text-gray-500 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300"},Sa={key:1},Aa={class:"grid gap-4 xl:grid-cols-[280px_minmax(0,1fr)]"},Ma={class:"grid gap-3 sm:grid-cols-2 xl:grid-cols-1"},Ba={class:"text-xs font-semibold text-gray-500 dark:text-gray-400"},Ia={class:"mt-2 text-2xl font-bold text-gray-900 dark:text-gray-100"},Ua={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Fa={class:"card p-4 sm:p-6"},Oa={class:"mb-4 flex items-center justify-between"},Ka={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},La={key:0,class:"h-72 sm:h-80"},Ea={key:1,class:"flex h-36 items-center justify-center rounded-lg bg-gray-50 text-xs text-gray-500 dark:bg-gray-800 dark:text-gray-400"},za={class:"card mt-6 p-4 sm:p-6"},qa={class:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Na={class:"flex flex-wrap items-center gap-2"},Ha={class:"overflow-x-auto"},ja={class:"min-w-full divide-y divide-gray-200 text-xs text-gray-600 dark:divide-gray-700 dark:text-gray-300 sm:text-sm"},Va={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ya={key:0},Ga={class:"px-3 py-3"},Wa={class:"flex items-center gap-2"},Za={class:"font-medium text-gray-900 dark:text-gray-100"},Qa={class:"text-xs text-gray-500 dark:text-gray-400"},Xa={class:"px-3 py-3 text-right"},Ja={class:"px-3 py-3 text-right"},to={class:"px-3 py-3 text-right"},eo={class:"px-3 py-3 text-right"},so={class:"px-3 py-3 text-right"},ao={class:"px-3 py-3 text-right"},oo={class:"px-3 py-3 text-right"},no={__name:"DashboardView",setup(kt){const rt=ie(),ht=re(),{isDarkMode:it}=Vt(ht),{dashboardData:n,costsData:yt,dashboardModelStats:G,trendData:X,apiKeysTrendData:L,efficiencyLoading:J,efficiencySummary:ft,efficiencyAccounts:tt,efficiencyAccountsMeta:I,costEfficiencyFilters:l,formattedUptime:F,dateFilter:W,trendGranularity:et,apiKeysTrendMetric:N,defaultTime:R}=Vt(rt),{loadDashboardData:At,loadApiKeysTrend:_t,loadCostEfficiencyData:pt,setDateFilterPreset:Ct,onCustomDateRangeChange:st,setTrendGranularity:Dt,refreshChartsData:Mt,disabledDate:dt,setCostEfficiencyRange:Tt,setCostEfficiencyPlatform:Bt,toggleCostEfficiencySort:j}=rt,gt=D(null),xt=D(null),bt=D(null);let at=null,r=null,d=null;const f=D(null);let m=null;const i=D(!1),a=D(30),u=D(null),p=D(0),k=D(null),_=D(!1),v=lt(()=>({text:it.value?"#e5e7eb":"#374151",grid:it.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)",legend:it.value?"#e5e7eb":"#374151"})),E={claude:"#4F46E5","claude-console":"#7C3AED",gemini:"#0EA5E9",bedrock:"#F97316",openai:"#16A34A",azure_openai:"#2563EB","openai-responses":"#14B8A6",ccr:"#D97706"},z={claude:"Claude","claude-console":"Console",gemini:"Gemini",bedrock:"Bedrock",openai:"OpenAI",azure_openai:"Azure OpenAI","openai-responses":"Responses",ccr:"CCR"},V=[{value:"today",label:"今日"},{value:"7days",label:"7天"},{value:"30d",label:"30天"},{value:"total",label:"全部"}],Z=[{value:"all",label:"全部平台"},{value:"claude",label:"Claude"},{value:"claude-console",label:"Console"},{value:"gemini",label:"Gemini"},{value:"bedrock",label:"Bedrock"},{value:"openai",label:"OpenAI"},{value:"azure_openai",label:"Azure OpenAI"}];function $(y){return y>=1e6?(y/1e6).toFixed(2)+"M":y>=1e3?(y/1e3).toFixed(2)+"K":y.toString()}function Et(y,e=2){if(y==null)return"--";const C=Number(y);return Number.isFinite(C)?`$${C.toFixed(e)}`:"--"}function It(y){if(y==null)return"--";const e=Number(y);return Number.isFinite(e)?`${Math.round(e)}ms`:"--"}function wt(y){return E[y]||"#64748B"}const Yt=lt(()=>{var y;return((y=ft.value)==null?void 0:y.totals)||null}),zt=lt(()=>(tt.value||[]).length>0),Gt=lt(()=>l.value.range||"30d"),Wt=lt(()=>l.value.platform||"all"),Zt=lt(()=>{var e,C;const y=Yt.value;return y?[{key:"tokensPerDollar",label:"Tokens / $",value:y.tokensPerDollar!==null&&y.tokensPerDollar!==void 0?y.tokensPerDollar.toFixed(2):"--",description:"平均每美元可用Token量"},{key:"costPerMillion",label:"$ / 百万 Tokens",value:y.costPerMillion!==null&&y.costPerMillion!==void 0?y.costPerMillion.toFixed(2):"--",description:"产出一百万Token的平均成本"},{key:"successRate",label:"成功率",value:y.successRate!==null&&y.successRate!==void 0?`${(y.successRate*100).toFixed(1)}%`:"--",description:`请求总数 ${((C=(e=y.totalRequests)==null?void 0:e.toLocaleString)==null?void 0:C.call(e))||y.totalRequests||0}`},{key:"latency",label:"平均延迟",value:It(y.avgLatencyMs),description:`P95 ${It(y.p95LatencyMs)}`}]:[{key:"tokensPerDollar",label:"Tokens / $",value:"--",description:"平均每美元可用Token量"},{key:"costPerMillion",label:"$ / 百万 Tokens",value:"--",description:"产出一百万Token的平均成本"},{key:"successRate",label:"成功率",value:"--",description:"请求成功占比"},{key:"latency",label:"平均延迟",value:"--",description:"平均响应耗时 (P95)"}]});function qt(y,e){if(!e||e.length===0)return 0;const C=e.reduce((o,A)=>o+A.allTokens,0);return C===0?0:(y/C*100).toFixed(1)}function Ut(){if(!gt.value)return;at&&at.destroy();const y=G.value||[],e={labels:y.map(C=>C.model),datasets:[{data:y.map(C=>C.allTokens),backgroundColor:["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#84CC16"],borderWidth:0}]};at=new St(gt.value,{type:"doughnut",data:e,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15,usePointStyle:!0,font:{size:12},color:v.value.legend}},tooltip:{callbacks:{label:function(C){const o=C.label||"",A=$(C.parsed),q=qt(C.parsed,y);return`${o}: ${A} (${q}%)`}}}}}})}function Ft(){var M;if(!xt.value)return;r&&r.destroy();const y=X.value||[],e=y.map(b=>b.inputTokens||0),C=y.map(b=>b.outputTokens||0),o=y.map(b=>b.cacheCreateTokens||0),A=y.map(b=>b.cacheReadTokens||0),q=y.map(b=>b.requests||0),B=y.map(b=>b.cost||0),Q=(M=y[0])!=null&&M.date?"date":"hour",O={labels:y.map(b=>{if(b.label)return b.label;if(Q==="hour"){const h=new Date(b.hour),U=String(h.getMonth()+1).padStart(2,"0"),ot=String(h.getDate()).padStart(2,"0"),$t=String(h.getHours()).padStart(2,"0");return`${U}/${ot} ${$t}:00`}const w=b.date;if(w&&w.includes("-")){const h=w.split("-");if(h.length>=3)return`${h[1]}/${h[2]}`}return b.date}),datasets:[{label:"输入Token",data:e,borderColor:"rgb(102, 126, 234)",backgroundColor:"rgba(102, 126, 234, 0.1)",tension:.3},{label:"输出Token",data:C,borderColor:"rgb(240, 147, 251)",backgroundColor:"rgba(240, 147, 251, 0.1)",tension:.3},{label:"缓存创建Token",data:o,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.3},{label:"缓存读取Token",data:A,borderColor:"rgb(147, 51, 234)",backgroundColor:"rgba(147, 51, 234, 0.1)",tension:.3},{label:"费用 (USD)",data:B,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",tension:.3,yAxisID:"y2"},{label:"请求数",data:q,borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.3,yAxisID:"y1"}]};r=new St(xt.value,{type:"line",data:O,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:"Token使用趋势",font:{size:16,weight:"bold"},color:v.value.text},legend:{position:"top",labels:{color:v.value.legend}},tooltip:{mode:"index",intersect:!1,itemSort:function(b,w){const h=b.dataset.label||"",U=w.dataset.label||"";return h==="费用 (USD)"||U==="费用 (USD)"?h==="费用 (USD)"?-1:1:h==="请求数"||U==="请求数"?h==="请求数"?1:-1:w.parsed.y-b.parsed.y},callbacks:{label:function(b){const w=b.dataset.label||"";let h=b.parsed.y;return w==="费用 (USD)"?h<.01?w+": $"+h.toFixed(6):w+": $"+h.toFixed(4):w==="请求数"?w+": "+h.toLocaleString()+" 次":h>=1e6?w+": "+(h/1e6).toFixed(2)+"M tokens":h>=1e3?w+": "+(h/1e3).toFixed(2)+"K tokens":w+": "+h.toLocaleString()+" tokens"}}}},scales:{x:{type:"category",display:!0,title:{display:!0,text:et==="hour"?"时间":"日期",color:v.value.text},ticks:{color:v.value.text},grid:{color:v.value.grid}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Token数量",color:v.value.text},ticks:{callback:function(b){return $(b)},color:v.value.text},grid:{color:v.value.grid}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"请求数",color:v.value.text},grid:{drawOnChartArea:!1},ticks:{callback:function(b){return b.toLocaleString()},color:v.value.text}},y2:{type:"linear",display:!1,position:"right"}}}})}function Pt(){var B,Q;if(!bt.value)return;d&&d.destroy();const y=L.value.data||[],e=N.value,C=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#84CC16"],o=((B=L.value.topApiKeys)==null?void 0:B.map((T,O)=>{var w,h;const M=L.value.data.map(U=>!U.apiKeys||!U.apiKeys[T]?0:e==="tokens"?U.apiKeys[T].tokens:U.apiKeys[T].requests||0);return{label:((h=(w=L.value.data.find(U=>U.apiKeys&&U.apiKeys[T]))==null?void 0:w.apiKeys[T])==null?void 0:h.name)||`API Key ${T}`,data:M,borderColor:C[O%C.length],backgroundColor:C[O%C.length]+"20",tension:.4,fill:!1}}))||[],A=(Q=y[0])!=null&&Q.date?"date":"hour",q={labels:y.map(T=>{if(T.label)return T.label;if(A==="hour"){const M=new Date(T.hour),b=String(M.getMonth()+1).padStart(2,"0"),w=String(M.getDate()).padStart(2,"0"),h=String(M.getHours()).padStart(2,"0");return`${b}/${w} ${h}:00`}const O=T.date;if(O&&O.includes("-")){const M=O.split("-");if(M.length>=3)return`${M[1]}/${M[2]}`}return T.date}),datasets:o};d=new St(bt.value,{type:"line",data:q,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,font:{size:12},color:v.value.legend}},tooltip:{mode:"index",intersect:!1,itemSort:function(T,O){return O.parsed.y-T.parsed.y},callbacks:{label:function(T){var $t;const O=T.dataset.label||"",M=T.parsed.y,b=T.dataIndex,w=L.value.data[b],U=T.chart.data.datasets.map((H,vt)=>({value:H.data[b]||0,index:vt})).sort((H,vt)=>vt.value-H.value).findIndex(H=>H.index===T.datasetIndex)+1;let ot="";if(U===1?ot="🥇 ":U===2?ot="🥈 ":U===3&&(ot="🥉 "),N.value==="tokens"){let H="";M>=1e6?H=(M/1e6).toFixed(2)+"M":M>=1e3?H=(M/1e3).toFixed(2)+"K":H=M.toLocaleString();const vt=L.value.topApiKeys[T.datasetIndex],Lt=($t=w==null?void 0:w.apiKeys)==null?void 0:$t[vt],Qt=(Lt==null?void 0:Lt.formattedCost)||"$0.00";return`${ot}${O}: ${H} tokens (${Qt})`}else return`${ot}${O}: ${M.toLocaleString()} 次`}}}},scales:{x:{type:"category",display:!0,title:{display:!0,text:et==="hour"?"时间":"日期",color:v.value.text},ticks:{color:v.value.text},grid:{color:v.value.grid}},y:{beginAtZero:!0,title:{display:!0,text:N.value==="tokens"?"Token 数量":"请求次数",color:v.value.text},ticks:{callback:function(T){return $(T)},color:v.value.text},grid:{color:v.value.grid}}}}})}function Ot(){if(!f.value)return;m&&m.destroy();const y=tt.value||[];if(y.length===0)return;const e=y.filter(o=>o&&o.metrics).map(o=>{const A=o.metrics,q=o.account||{},B=Number(A.totalRequests||0),Q=Math.max(4,Math.min(18,Math.sqrt(B+1)));return{x:A.costPerMillion!==null&&A.costPerMillion!==void 0?Number(A.costPerMillion):0,y:A.successRate!==null&&A.successRate!==void 0?Number(A.successRate)*100:0,r:Q,account:q,metrics:A,platform:q.platform||"unknown"}});if(e.length===0)return;const C={label:"账户性价比",data:e,backgroundColor:e.map(o=>`${wt(o.platform)}33`),borderColor:e.map(o=>wt(o.platform)),borderWidth:1,hoverBackgroundColor:e.map(o=>wt(o.platform)),hoverBorderWidth:1};m=new St(f.value,{type:"bubble",data:{datasets:[C]},options:{responsive:!0,maintainAspectRatio:!1,parsing:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(o){const A=o.raw||{},q=A.account||{},B=A.metrics||{},Q=B.tokensPerDollar!==null&&B.tokensPerDollar!==void 0?B.tokensPerDollar.toFixed(2):"--",T=B.costPerMillion!==null&&B.costPerMillion!==void 0?B.costPerMillion.toFixed(2):"--",O=B.successRate!==null&&B.successRate!==void 0?`${(B.successRate*100).toFixed(1)}%`:"--",M=Et(B.totalCost,4),b=$(B.totalTokens||0),w=(B.totalRequests||0).toLocaleString();return[`${q.name||q.id||"未知账户"}`,`Tokens/$: ${Q}`,`$ / 百万 Tokens: ${T}`,`成功率: ${O}`,`费用: ${M}`,`Tokens: ${b}`,`请求数: ${w}`]}}}},scales:{x:{title:{display:!0,text:"$ / 百万 Tokens",color:v.value.text},ticks:{color:v.value.text},grid:{color:v.value.grid}},y:{title:{display:!0,text:"成功率 (%)",color:v.value.text},ticks:{callback:o=>`${o}%`,color:v.value.text},beginAtZero:!0,suggestedMax:100,grid:{color:v.value.grid}}}}})}async function Nt(){await _t(N.value),await nt(),Pt()}ct(G,()=>{nt(()=>Ut())}),ct(X,()=>{nt(()=>Ft())}),ct(L,()=>{nt(()=>Pt())}),ct(tt,()=>{nt(()=>Ot())});async function Kt(){if(!_.value){_.value=!0;try{await Promise.all([At(),Mt(),pt()])}finally{_.value=!1}}}function Ht(){i.value&&(p.value=a.value,k.value&&clearInterval(k.value),u.value&&clearTimeout(u.value),k.value=setInterval(()=>{p.value--,p.value<=0&&clearInterval(k.value)},1e3),u.value=setTimeout(async()=>{await Kt(),i.value&&Ht()},a.value*1e3))}function jt(){k.value&&(clearInterval(k.value),k.value=null),u.value&&(clearTimeout(u.value),u.value=null),p.value=0}return ct(i,y=>{y?Ht():jt()}),ct(it,()=>{nt(()=>{Ut(),Ft(),Pt(),Ot()})}),te(async()=>{await Kt(),await nt(),Ut(),Ft(),Pt(),Ot()}),ee(()=>{jt(),at&&at.destroy(),r&&r.destroy(),d&&d.destroy(),m&&m.destroy()}),(y,e)=>{const C=Xt;return x(),g("div",null,[t("div",de,[t("div",ce,[t("div",ue,[t("div",null,[e[12]||(e[12]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 总API Keys ",-1)),t("p",me,c(s(n).totalApiKeys),1),t("p",ye," 活跃: "+c(s(n).activeApiKeys||0),1)]),e[13]||(e[13]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-blue-500 to-blue-600"},[t("i",{class:"fas fa-key"})],-1))])]),t("div",fe,[t("div",pe,[t("div",ge,[e[21]||(e[21]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 服务账户 ",-1)),t("div",xe,[t("p",be,c(s(n).totalAccounts),1),s(n).accountsByPlatform?(x(),g("div",ve,[s(n).accountsByPlatform.claude&&s(n).accountsByPlatform.claude.total>0?(x(),g("div",{key:0,class:"inline-flex items-center gap-0.5",title:`Claude: ${s(n).accountsByPlatform.claude.total} 个 (正常: ${s(n).accountsByPlatform.claude.normal})`},[e[14]||(e[14]=t("i",{class:"fas fa-brain text-xs text-indigo-600"},null,-1)),t("span",he,c(s(n).accountsByPlatform.claude.total),1)],8,ke)):P("",!0),s(n).accountsByPlatform["claude-console"]&&s(n).accountsByPlatform["claude-console"].total>0?(x(),g("div",{key:1,class:"inline-flex items-center gap-0.5",title:`Console: ${s(n).accountsByPlatform["claude-console"].total} 个 (正常: ${s(n).accountsByPlatform["claude-console"].normal})`},[e[15]||(e[15]=t("i",{class:"fas fa-terminal text-xs text-purple-600"},null,-1)),t("span",Ce,c(s(n).accountsByPlatform["claude-console"].total),1)],8,_e)):P("",!0),s(n).accountsByPlatform.gemini&&s(n).accountsByPlatform.gemini.total>0?(x(),g("div",{key:2,class:"inline-flex items-center gap-0.5",title:`Gemini: ${s(n).accountsByPlatform.gemini.total} 个 (正常: ${s(n).accountsByPlatform.gemini.normal})`},[e[16]||(e[16]=t("i",{class:"fas fa-robot text-xs text-yellow-600"},null,-1)),t("span",Te,c(s(n).accountsByPlatform.gemini.total),1)],8,De)):P("",!0),s(n).accountsByPlatform.bedrock&&s(n).accountsByPlatform.bedrock.total>0?(x(),g("div",{key:3,class:"inline-flex items-center gap-0.5",title:`Bedrock: ${s(n).accountsByPlatform.bedrock.total} 个 (正常: ${s(n).accountsByPlatform.bedrock.normal})`},[e[17]||(e[17]=t("i",{class:"fab fa-aws text-xs text-orange-600"},null,-1)),t("span",Pe,c(s(n).accountsByPlatform.bedrock.total),1)],8,we)):P("",!0),s(n).accountsByPlatform.openai&&s(n).accountsByPlatform.openai.total>0?(x(),g("div",{key:4,class:"inline-flex items-center gap-0.5",title:`OpenAI: ${s(n).accountsByPlatform.openai.total} 个 (正常: ${s(n).accountsByPlatform.openai.normal})`},[e[18]||(e[18]=t("i",{class:"fas fa-openai text-xs text-gray-100"},null,-1)),t("span",Re,c(s(n).accountsByPlatform.openai.total),1)],8,$e)):P("",!0),s(n).accountsByPlatform.azure_openai&&s(n).accountsByPlatform.azure_openai.total>0?(x(),g("div",{key:5,class:"inline-flex items-center gap-0.5",title:`Azure OpenAI: ${s(n).accountsByPlatform.azure_openai.total} 个 (正常: ${s(n).accountsByPlatform.azure_openai.normal})`},[e[19]||(e[19]=t("i",{class:"fab fa-microsoft text-xs text-blue-600"},null,-1)),t("span",Ae,c(s(n).accountsByPlatform.azure_openai.total),1)],8,Se)):P("",!0),s(n).accountsByPlatform["openai-responses"]&&s(n).accountsByPlatform["openai-responses"].total>0?(x(),g("div",{key:6,class:"inline-flex items-center gap-0.5",title:`OpenAI Responses: ${s(n).accountsByPlatform["openai-responses"].total} 个 (正常: ${s(n).accountsByPlatform["openai-responses"].normal})`},[e[20]||(e[20]=t("i",{class:"fas fa-server text-xs text-cyan-600"},null,-1)),t("span",Be,c(s(n).accountsByPlatform["openai-responses"].total),1)],8,Me)):P("",!0)])):P("",!0)]),t("p",Ie,[S(" 正常: "+c(s(n).normalAccounts||0)+" ",1),s(n).abnormalAccounts>0?(x(),g("span",Ue," | 异常: "+c(s(n).abnormalAccounts),1)):P("",!0),s(n).pausedAccounts>0?(x(),g("span",Fe," | 停止调度: "+c(s(n).pausedAccounts),1)):P("",!0),s(n).rateLimitedAccounts>0?(x(),g("span",Oe," | 限流: "+c(s(n).rateLimitedAccounts),1)):P("",!0)])]),e[22]||(e[22]=t("div",{class:"stat-icon ml-2 flex-shrink-0 bg-gradient-to-br from-green-500 to-green-600"},[t("i",{class:"fas fa-user-circle"})],-1))])]),t("div",Ke,[t("div",Le,[t("div",null,[e[23]||(e[23]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 今日请求 ",-1)),t("p",Ee,c(s(n).todayRequests),1),t("p",ze," 总请求: "+c($(s(n).totalRequests||0)),1)]),e[24]||(e[24]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-purple-500 to-purple-600"},[t("i",{class:"fas fa-chart-line"})],-1))])]),t("div",qe,[t("div",Ne,[t("div",null,[e[25]||(e[25]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 系统状态 ",-1)),t("p",He,c(s(n).systemStatus),1),t("p",je," 运行时间: "+c(s(F)),1)]),e[26]||(e[26]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-yellow-500 to-orange-500"},[t("i",{class:"fas fa-heartbeat"})],-1))])])]),t("div",Ve,[t("div",Ye,[t("div",Ge,[t("div",We,[e[31]||(e[31]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 今日Token ",-1)),t("div",Ze,[t("p",Qe,c($((s(n).todayInputTokens||0)+(s(n).todayOutputTokens||0)+(s(n).todayCacheCreateTokens||0)+(s(n).todayCacheReadTokens||0))),1),t("span",Xe,"/ "+c(s(yt).todayCosts.formatted.totalCost),1)]),t("div",Je,[t("div",ts,[t("span",null,[e[27]||(e[27]=S("输入: ",-1)),t("span",es,c($(s(n).todayInputTokens||0)),1)]),t("span",null,[e[28]||(e[28]=S("输出: ",-1)),t("span",ss,c($(s(n).todayOutputTokens||0)),1)]),(s(n).todayCacheCreateTokens||0)>0?(x(),g("span",as,[e[29]||(e[29]=S("缓存创建: ",-1)),t("span",os,c($(s(n).todayCacheCreateTokens||0)),1)])):P("",!0),(s(n).todayCacheReadTokens||0)>0?(x(),g("span",ns,[e[30]||(e[30]=S("缓存读取: ",-1)),t("span",ls,c($(s(n).todayCacheReadTokens||0)),1)])):P("",!0)])])]),e[32]||(e[32]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-indigo-500 to-indigo-600"},[t("i",{class:"fas fa-coins"})],-1))])]),t("div",rs,[t("div",is,[t("div",ds,[e[37]||(e[37]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 总Token消耗 ",-1)),t("div",cs,[t("p",us,c($((s(n).totalInputTokens||0)+(s(n).totalOutputTokens||0)+(s(n).totalCacheCreateTokens||0)+(s(n).totalCacheReadTokens||0))),1),t("span",ms,"/ "+c(s(yt).totalCosts.formatted.totalCost),1)]),t("div",ys,[t("div",fs,[t("span",null,[e[33]||(e[33]=S("输入: ",-1)),t("span",ps,c($(s(n).totalInputTokens||0)),1)]),t("span",null,[e[34]||(e[34]=S("输出: ",-1)),t("span",gs,c($(s(n).totalOutputTokens||0)),1)]),(s(n).totalCacheCreateTokens||0)>0?(x(),g("span",xs,[e[35]||(e[35]=S("缓存创建: ",-1)),t("span",bs,c($(s(n).totalCacheCreateTokens||0)),1)])):P("",!0),(s(n).totalCacheReadTokens||0)>0?(x(),g("span",vs,[e[36]||(e[36]=S("缓存读取: ",-1)),t("span",ks,c($(s(n).totalCacheReadTokens||0)),1)])):P("",!0)])])]),e[38]||(e[38]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-emerald-500 to-emerald-600"},[t("i",{class:"fas fa-database"})],-1))])]),t("div",hs,[t("div",_s,[t("div",null,[t("p",Cs,[e[39]||(e[39]=S(" 实时RPM ",-1)),t("span",Ds,"("+c(s(n).metricsWindow)+"分钟)",1)]),t("p",Ts,c(s(n).realtimeRPM||0),1),t("p",ws,[e[41]||(e[41]=S(" 每分钟请求数 ",-1)),s(n).isHistoricalMetrics?(x(),g("span",Ps,e[40]||(e[40]=[t("i",{class:"fas fa-exclamation-circle"},null,-1),S(" 历史数据 ",-1)]))):P("",!0)])]),e[42]||(e[42]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-orange-500 to-orange-600"},[t("i",{class:"fas fa-tachometer-alt"})],-1))])]),t("div",$s,[t("div",Rs,[t("div",null,[t("p",Ss,[e[43]||(e[43]=S(" 实时TPM ",-1)),t("span",As,"("+c(s(n).metricsWindow)+"分钟)",1)]),t("p",Ms,c($(s(n).realtimeTPM||0)),1),t("p",Bs,[e[45]||(e[45]=S(" 每分钟Token数 ",-1)),s(n).isHistoricalMetrics?(x(),g("span",Is,e[44]||(e[44]=[t("i",{class:"fas fa-exclamation-circle"},null,-1),S(" 历史数据 ",-1)]))):P("",!0)])]),e[46]||(e[46]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-rose-500 to-rose-600"},[t("i",{class:"fas fa-rocket"})],-1))])])]),t("div",Us,[t("div",Fs,[e[53]||(e[53]=t("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 模型使用分布与Token使用趋势 ",-1)),t("div",Os,[t("div",Ks,[(x(!0),g(ut,null,mt(s(W).presetOptions,o=>(x(),g("button",{key:o.value,class:K(["rounded-md px-3 py-1 text-sm font-medium transition-colors",s(W).preset===o.value&&s(W).type==="preset"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:A=>s(Ct)(o.value)},c(o.label),11,Ls))),128))]),t("div",Es,[t("button",{class:K(["rounded-md px-3 py-1 text-sm font-medium transition-colors",s(et)==="day"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[0]||(e[0]=o=>s(Dt)("day"))},e[47]||(e[47]=[t("i",{class:"fas fa-calendar-day mr-1"},null,-1),S("按天 ",-1)]),2),t("button",{class:K(["rounded-md px-3 py-1 text-sm font-medium transition-colors",s(et)==="hour"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[1]||(e[1]=o=>s(Dt)("hour"))},e[48]||(e[48]=[t("i",{class:"fas fa-clock mr-1"},null,-1),S("按小时 ",-1)]),2)]),t("div",zs,[se(C,{modelValue:s(W).customRange,"onUpdate:modelValue":e[2]||(e[2]=o=>s(W).customRange=o),class:"custom-date-picker w-full lg:w-auto","default-time":s(R),"disabled-date":s(dt),"end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","range-separator":"至",size:"default","start-placeholder":"开始日期",style:{"max-width":"400px"},type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss",onChange:s(st)},null,8,["modelValue","default-time","disabled-date","onChange"]),s(et)==="hour"?(x(),g("span",qs,e[49]||(e[49]=[t("i",{class:"fas fa-info-circle"},null,-1),S(" 最多24小时 ",-1)]))):P("",!0)]),t("div",Ns,[t("div",Hs,[t("label",js,[ae(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.value=o),class:"peer sr-only",type:"checkbox"},null,512),[[oe,i.value]]),e[52]||(e[52]=t("div",{class:"peer relative h-5 w-9 rounded-full bg-gray-300 transition-all duration-200 after:absolute after:left-[2px] after:top-0.5 after:h-4 after:w-4 after:rounded-full after:bg-white after:shadow-sm after:transition-transform after:duration-200 after:content-[''] peer-checked:bg-blue-500 peer-checked:after:translate-x-4 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:bg-gray-600 dark:after:bg-gray-300 dark:peer-focus:ring-blue-600"},null,-1)),t("span",Vs,[e[50]||(e[50]=t("i",{class:"fas fa-redo-alt text-xs text-gray-500 dark:text-gray-400"},null,-1)),e[51]||(e[51]=t("span",null,"自动刷新",-1)),i.value?(x(),g("span",{key:0,class:K(["ml-1 font-mono text-xs text-blue-600 transition-opacity",p.value>0?"opacity-100":"opacity-0"])},c(p.value)+"s ",3)):P("",!0)])])]),t("button",{class:"flex items-center gap-1 rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-blue-600 shadow-sm transition-colors hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 sm:gap-2",disabled:_.value,title:"立即刷新数据",onClick:e[4]||(e[4]=o=>Kt())},[t("i",{class:K(["fas fa-sync-alt text-xs",{"animate-spin":_.value}])},null,2),t("span",Gs,c(_.value?"刷新中":"刷新"),1)],8,Ys)])])]),t("div",Ws,[t("div",Zs,[e[54]||(e[54]=t("h4",{class:"mb-4 text-base font-semibold text-gray-800 dark:text-gray-200 sm:text-lg"}," Token使用分布 ",-1)),t("div",Qs,[t("canvas",{ref_key:"modelUsageChart",ref:gt},null,512)])]),t("div",Xs,[e[57]||(e[57]=t("h4",{class:"mb-4 text-base font-semibold text-gray-800 dark:text-gray-200 sm:text-lg"}," 详细统计数据 ",-1)),s(G).length===0?(x(),g("div",Js,e[55]||(e[55]=[t("p",{class:"text-sm text-gray-500 sm:text-base"},"暂无模型使用数据",-1)]))):(x(),g("div",ta,[t("table",ea,[e[56]||(e[56]=t("thead",{class:"sticky top-0 bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 sm:px-4"}," 模型 "),t("th",{class:"hidden px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:table-cell sm:px-4"}," 请求数 "),t("th",{class:"px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:px-4"}," 总Token "),t("th",{class:"px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:px-4"}," 费用 "),t("th",{class:"hidden px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:table-cell sm:px-4"}," 占比 ")])],-1)),t("tbody",sa,[(x(!0),g(ut,null,mt(s(G),o=>(x(),g("tr",{key:o.model,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[t("td",aa,[t("span",{class:"block max-w-[100px] truncate sm:max-w-none",title:o.model},c(o.model),9,oa)]),t("td",na,c($(o.requests)),1),t("td",la,c($(o.allTokens)),1),t("td",ra,c(o.formatted?o.formatted.total:"$0.000000"),1),t("td",ia,[t("span",da,c(qt(o.allTokens,s(G)))+"% ",1)])]))),128))])])]))])])]),t("div",ca,[t("div",ua,[t("div",ma,[t("canvas",{ref_key:"usageTrendChart",ref:xt},null,512)])])]),t("div",ya,[t("div",fa,[t("div",pa,[e[60]||(e[60]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-gray-100 sm:text-lg"}," API Keys 使用趋势 ",-1)),t("div",ga,[t("button",{class:K(["rounded-md px-2 py-1 text-xs font-medium transition-colors sm:px-3 sm:text-sm",s(N)==="requests"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[5]||(e[5]=o=>(N.value="requests",Nt()))},e[58]||(e[58]=[t("i",{class:"fas fa-exchange-alt mr-1"},null,-1),t("span",{class:"hidden sm:inline"},"请求次数",-1),t("span",{class:"sm:hidden"},"请求",-1)]),2),t("button",{class:K(["rounded-md px-2 py-1 text-xs font-medium transition-colors sm:px-3 sm:text-sm",s(N)==="tokens"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[6]||(e[6]=o=>(N.value="tokens",Nt()))},e[59]||(e[59]=[t("i",{class:"fas fa-coins mr-1"},null,-1),t("span",{class:"hidden sm:inline"},"Token 数量",-1),t("span",{class:"sm:hidden"},"Token",-1)]),2)])]),t("div",xa,[s(L).totalApiKeys>10?(x(),g("span",ba," 共 "+c(s(L).totalApiKeys)+" 个 API Key，显示使用量前 10 个 ",1)):(x(),g("span",va," 共 "+c(s(L).totalApiKeys)+" 个 API Key ",1))]),t("div",ka,[t("canvas",{ref_key:"apiKeysUsageTrendChart",ref:bt},null,512)])])]),t("div",ha,[t("div",_a,[e[61]||(e[61]=t("div",null,[t("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 账户性价比分析 "),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"按成本与成功率综合评估各账户表现")],-1)),t("div",Ca,[t("div",Da,[(x(),g(ut,null,mt(V,o=>t("button",{key:o.value,class:K(["rounded-md px-3 py-1 text-sm font-medium transition-colors",Gt.value===o.value?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:A=>s(Tt)(o.value)},c(o.label),11,Ta)),64))]),t("select",{class:"rounded-md border border-gray-300 bg-white px-3 py-1 text-sm text-gray-700 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",value:Wt.value,onChange:e[7]||(e[7]=o=>s(Bt)(o.target.value))},[(x(),g(ut,null,mt(Z,o=>t("option",{key:o.value,value:o.value},c(o.label),9,Pa)),64))],40,wa),t("button",{class:"inline-flex items-center rounded-md border border-gray-200 bg-white px-3 py-1 text-sm text-gray-600 transition-colors hover:text-blue-600 disabled:cursor-not-allowed disabled:opacity-60 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:text-blue-400",disabled:s(J),onClick:e[8]||(e[8]=o=>s(pt)())},[t("i",{class:K(["fas fa-sync-alt",{"animate-spin":s(J)}])},null,2)],8,$a)])]),s(J)?(x(),g("div",Ra,e[62]||(e[62]=[t("i",{class:"fas fa-circle-notch mr-2 animate-spin"},null,-1),S(" 正在加载性价比数据... ",-1)]))):(x(),g("div",Sa,[t("div",Aa,[t("div",Ma,[(x(!0),g(ut,null,mt(Zt.value,o=>(x(),g("div",{key:o.key,class:"card p-4"},[t("p",Ba,c(o.label),1),t("p",Ia,c(o.value),1),t("p",Ua,c(o.description),1)]))),128))]),t("div",Fa,[t("div",Oa,[e[63]||(e[63]=t("h4",{class:"text-base font-semibold text-gray-900 dark:text-gray-100"}," 成本 vs 成功率 ",-1)),s(I).total?(x(),g("span",Ka," 共 "+c(s(I).total)+" 个账户 ",1)):P("",!0)]),zt.value?(x(),g("div",La,[t("canvas",{ref_key:"costEfficiencyChart",ref:f},null,512)])):(x(),g("div",Ea," 暂无符合筛选条件的数据 ")),e[64]||(e[64]=t("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 泡泡大小表示请求量，颜色代表平台。 ",-1))])]),t("div",za,[t("div",qa,[e[68]||(e[68]=t("h4",{class:"text-base font-semibold text-gray-900 dark:text-gray-100"},"账户性价比排行",-1)),t("div",Na,[t("button",{class:K(["rounded-md px-3 py-1 text-xs font-medium transition-colors sm:text-sm",s(l).sortBy==="tokensPerDollar"?"bg-blue-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300"]),onClick:e[9]||(e[9]=o=>s(j)("tokensPerDollar"))},[e[65]||(e[65]=S(" Tokens / $ ",-1)),s(l).sortBy==="tokensPerDollar"?(x(),g("i",{key:0,class:K(["fas ml-1",s(l).order==="asc"?"fa-arrow-up":"fa-arrow-down"])},null,2)):P("",!0)],2),t("button",{class:K(["rounded-md px-3 py-1 text-xs font-medium transition-colors sm:text-sm",s(l).sortBy==="costPerMillion"?"bg-blue-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300"]),onClick:e[10]||(e[10]=o=>s(j)("costPerMillion"))},[e[66]||(e[66]=S(" $ / 百万 Tokens ",-1)),s(l).sortBy==="costPerMillion"?(x(),g("i",{key:0,class:K(["fas ml-1",s(l).order==="asc"?"fa-arrow-up":"fa-arrow-down"])},null,2)):P("",!0)],2),t("button",{class:K(["rounded-md px-3 py-1 text-xs font-medium transition-colors sm:text-sm",s(l).sortBy==="successRate"?"bg-blue-600 text-white shadow-sm":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300"]),onClick:e[11]||(e[11]=o=>s(j)("successRate"))},[e[67]||(e[67]=S(" 成功率 ",-1)),s(l).sortBy==="successRate"?(x(),g("i",{key:0,class:K(["fas ml-1",s(l).order==="asc"?"fa-arrow-up":"fa-arrow-down"])},null,2)):P("",!0)],2)])]),t("div",Ha,[t("table",ja,[e[70]||(e[70]=t("thead",{class:"bg-gray-50 text-xs uppercase tracking-wider text-gray-500 dark:bg-gray-800/60 dark:text-gray-400"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left"},"账户"),t("th",{class:"px-3 py-2 text-right"},"费用"),t("th",{class:"px-3 py-2 text-right"},"Tokens"),t("th",{class:"px-3 py-2 text-right"},"Tokens / $"),t("th",{class:"px-3 py-2 text-right"},"$ / 百万 Tokens"),t("th",{class:"px-3 py-2 text-right"},"成功率"),t("th",{class:"px-3 py-2 text-right"},"平均延迟"),t("th",{class:"px-3 py-2 text-right"},"请求数")])],-1)),t("tbody",Va,[zt.value?P("",!0):(x(),g("tr",Ya,e[69]||(e[69]=[t("td",{class:"px-3 py-4 text-center text-gray-500 dark:text-gray-400",colspan:"8"}," 暂无数据 ",-1)]))),(x(!0),g(ut,null,mt(s(tt),o=>(x(),g("tr",{key:o.account.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/70"},[t("td",Ga,[t("div",Wa,[t("span",{class:"inline-flex h-2 w-2 flex-shrink-0 rounded-full",style:ne({backgroundColor:wt(o.account.platform)})},null,4),t("div",null,[t("p",Za,c(o.account.name||o.account.id),1),t("p",Qa,c(z[o.account.platform]||o.account.platform||"未知平台"),1)])])]),t("td",Xa,c(Et(o.metrics.totalCost,4)),1),t("td",Ja,c($(o.metrics.totalTokens||0)),1),t("td",to,c(o.metrics.tokensPerDollar!==null&&o.metrics.tokensPerDollar!==void 0?o.metrics.tokensPerDollar.toFixed(2):"--"),1),t("td",eo,c(o.metrics.costPerMillion!==null&&o.metrics.costPerMillion!==void 0?o.metrics.costPerMillion.toFixed(2):"--"),1),t("td",so,c(o.metrics.successRate!==null&&o.metrics.successRate!==void 0?(o.metrics.successRate*100).toFixed(1)+"%":"--"),1),t("td",ao,c(It(o.metrics.avgLatencyMs)),1),t("td",oo,c((o.metrics.totalRequests||0).toLocaleString()),1)]))),128))])])])])]))])])}}},mo=le(no,[["__scopeId","data-v-9e8191a2"]]);export{mo as default};
