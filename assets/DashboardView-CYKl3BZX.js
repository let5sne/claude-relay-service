import{E as Ht}from"./element-plus-Bo59mSjk.js";import{aP as Vt,r as D,c as Et,aX as zt,o as ft,q as jt,D as X,V as Gt,x as b,z as t,P as p,u as a,L as A,O as P,Q as Ot,ac as Ft,C as J,R as Yt,K as Wt,al as Zt,y as h}from"./vue-vendor-R8HMg95E.js";import{c as j,s as It,_ as Qt,a as Xt}from"./index-C5GaZAcL.js";import{C as Ut}from"./chart-D0-mP5KW.js";import"./vendor-CrxIEVZC.js";const Jt=Vt("dashboard",()=>{const Tt=D(!1),it=D({totalApiKeys:0,activeApiKeys:0,totalAccounts:0,normalAccounts:0,abnormalAccounts:0,pausedAccounts:0,activeAccounts:0,rateLimitedAccounts:0,accountsByPlatform:{claude:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},"claude-console":{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},gemini:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},azure_openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},bedrock:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0}},todayRequests:0,totalRequests:0,todayTokens:0,todayInputTokens:0,todayOutputTokens:0,totalTokens:0,totalInputTokens:0,totalOutputTokens:0,totalCacheCreateTokens:0,totalCacheReadTokens:0,todayCacheCreateTokens:0,todayCacheReadTokens:0,systemRPM:0,systemTPM:0,realtimeRPM:0,realtimeTPM:0,metricsWindow:5,isHistoricalMetrics:!1,systemStatus:"正常",uptime:0,systemTimezone:8}),Ct=D({todayCosts:{totalCost:0,formatted:{totalCost:"$0.000000"}},totalCosts:{totalCost:0,formatted:{totalCost:"$0.000000"}}}),dt=D([]),l=D([]),gt=D([]),W=D({data:[],topApiKeys:[],totalApiKeys:0}),xt=D({data:[],topAccounts:[],totalAccounts:0,group:"claude",groupLabel:"Claude账户"}),O=D(!1),L=D(null),vt=D([]),_t=D({total:0,nextOffset:0,hasMore:!1}),tt=D([]),R=D({range:"30d",platform:"all",sortBy:"costPerMillion",order:"asc",interval:"day"}),r=D({type:"preset",preset:"7days",customStart:"",customEnd:"",customRange:null,presetOptions:[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}]}),U=D("day"),wt=D("requests"),ct=D("claude"),Bt=D([new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)]),Mt=Et(()=>{const i=it.value.uptime,d=Math.floor(i/86400),c=Math.floor(i%86400/3600),n=Math.floor(i%3600/60);return d>0?`${d}天 ${c}小时`:c>0?`${c}小时 ${n}分钟`:`${n}分钟`});function w(i,d=!0){const c=i.getFullYear(),n=i.getMonth(),o=i.getDate();return d?new Date(Date.UTC(c,n,o-1,16,0,0,0)):new Date(Date.UTC(c,n,o,15,59,59,999))}async function St(i=null){Tt.value=!0;try{let d={today:"today",all:"all"};i&&(d={today:{today:"today",all:"today"},"7days":{today:"7days",all:"7days"},monthly:{today:"monthly",all:"monthly"},all:{today:"today",all:"all"}}[i]||d);const[c,n,o]=await Promise.all([j.get("/admin/dashboard"),j.get(`/admin/usage-costs?period=${d.today}`),j.get(`/admin/usage-costs?period=${d.all}`)]);if(c.success){const s=c.data.overview||{},u=c.data.recentActivity||{},m=c.data.systemAverages||{},T=c.data.realtimeMetrics||{},C=c.data.systemHealth||{};it.value={totalApiKeys:s.totalApiKeys||0,activeApiKeys:s.activeApiKeys||0,totalAccounts:s.totalAccounts||s.totalClaudeAccounts||0,normalAccounts:s.normalAccounts||0,abnormalAccounts:s.abnormalAccounts||0,pausedAccounts:s.pausedAccounts||0,activeAccounts:s.activeAccounts||s.activeClaudeAccounts||0,rateLimitedAccounts:s.rateLimitedAccounts||s.rateLimitedClaudeAccounts||0,accountsByPlatform:s.accountsByPlatform||{claude:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},"claude-console":{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},gemini:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},azure_openai:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0},bedrock:{total:0,normal:0,abnormal:0,paused:0,rateLimited:0}},todayRequests:u.requestsToday||0,totalRequests:s.totalRequestsUsed||0,todayTokens:u.tokensToday||0,todayInputTokens:u.inputTokensToday||0,todayOutputTokens:u.outputTokensToday||0,totalTokens:s.totalTokensUsed||0,totalInputTokens:s.totalInputTokensUsed||0,totalOutputTokens:s.totalOutputTokensUsed||0,totalCacheCreateTokens:s.totalCacheCreateTokensUsed||0,totalCacheReadTokens:s.totalCacheReadTokensUsed||0,todayCacheCreateTokens:u.cacheCreateTokensToday||0,todayCacheReadTokens:u.cacheReadTokensToday||0,systemRPM:m.rpm||0,systemTPM:m.tpm||0,realtimeRPM:T.rpm||0,realtimeTPM:T.tpm||0,metricsWindow:T.windowMinutes||5,isHistoricalMetrics:T.isHistorical||!1,systemStatus:C.redisConnected?"正常":"异常",uptime:C.uptime||0,systemTimezone:c.data.systemTimezone||8}}n.success&&o.success&&(Ct.value={todayCosts:n.data.totalCosts||{totalCost:0,formatted:{totalCost:"$0.000000"}},totalCosts:o.data.totalCosts||{totalCost:0,formatted:{totalCost:"$0.000000"}}})}catch(d){console.error("加载仪表板数据失败:",d)}finally{Tt.value=!1}}async function $t(i=7,d="day"){try{let c="/admin/usage-trend?";if(d==="hour")if(c+="granularity=hour",r.value.customRange&&r.value.customRange.length===2){const o=s=>{const[m,T]=s.split(" "),[C,F,B]=m.split("-").map(Number),[z,E,q]=T.split(":").map(Number);return new Date(Date.UTC(C,F-1,B,z-8,E,q)).toISOString()};c+=`&startDate=${encodeURIComponent(o(r.value.customRange[0]))}`,c+=`&endDate=${encodeURIComponent(o(r.value.customRange[1]))}`}else{const o=new Date;let s,u;if(r.value.type==="preset")switch(r.value.preset){case"last24h":{u=new Date(o),s=new Date(o.getTime()-24*60*60*1e3);break}case"yesterday":{const m=new Date;m.setDate(m.getDate()-1),s=w(m,!0),u=w(m,!1);break}case"dayBefore":{const m=new Date;m.setDate(m.getDate()-2),s=w(m,!0),u=w(m,!1);break}default:s=new Date(o.getTime()-24*60*60*1e3),u=o}else s=new Date(o.getTime()-i*24*60*60*1e3),u=o;c+=`&startDate=${encodeURIComponent(s.toISOString())}`,c+=`&endDate=${encodeURIComponent(u.toISOString())}`}else c+=`granularity=day&days=${i}`;const n=await j.get(c);n.success&&(l.value=n.data)}catch(c){console.error("加载使用趋势失败:",c)}}async function At(i="daily"){try{let d=`/admin/model-stats?period=${i}`;if(r.value.type==="custom"||U.value==="hour"){if(r.value.customRange&&r.value.customRange.length===2){const n=o=>{const[u,m]=o.split(" "),[T,C,F]=u.split("-").map(Number),[B,z,E]=m.split(":").map(Number);return new Date(Date.UTC(T,C-1,F,B-8,z,E)).toISOString()};d+=`&startDate=${encodeURIComponent(n(r.value.customRange[0]))}`,d+=`&endDate=${encodeURIComponent(n(r.value.customRange[1]))}`}else if(U.value==="hour"&&r.value.type==="preset"){const n=new Date;let o,s;switch(r.value.preset){case"last24h":{s=new Date(n),o=new Date(n.getTime()-24*60*60*1e3);break}case"yesterday":{const u=new Date;u.setDate(u.getDate()-1),o=w(u,!0),s=w(u,!1);break}case"dayBefore":{const u=new Date;u.setDate(u.getDate()-2),o=w(u,!0),s=w(u,!1);break}default:o=new Date(n.getTime()-24*60*60*1e3),s=n}d+=`&startDate=${encodeURIComponent(o.toISOString())}`,d+=`&endDate=${encodeURIComponent(s.toISOString())}`}}else if(r.value.type==="preset"&&U.value==="day"){const n=new Date;let o,s;const u=r.value.presetOptions.find(m=>m.value===r.value.preset);if(u){if(r.value.preset==="today")o=w(n,!0),s=w(n,!1);else{const m=new Date;m.setDate(m.getDate()-(u.days-1)),o=w(m,!0),s=w(n,!1)}d+=`&startDate=${encodeURIComponent(o.toISOString())}`,d+=`&endDate=${encodeURIComponent(s.toISOString())}`}}const c=await j.get(d);c.success&&(gt.value=c.data)}catch(d){console.error("加载模型统计失败:",d)}}async function Rt(i="requests"){try{let d="/admin/api-keys-usage-trend?",c=7;if(U.value==="hour")if(d+="granularity=hour",r.value.customRange&&r.value.customRange.length===2){const o=s=>{const[m,T]=s.split(" "),[C,F,B]=m.split("-").map(Number),[z,E,q]=T.split(":").map(Number);return new Date(Date.UTC(C,F-1,B,z-8,E,q)).toISOString()};d+=`&startDate=${encodeURIComponent(o(r.value.customRange[0]))}`,d+=`&endDate=${encodeURIComponent(o(r.value.customRange[1]))}`}else{const o=new Date;let s,u;if(r.value.type==="preset")switch(r.value.preset){case"last24h":{u=new Date(o),s=new Date(o.getTime()-24*60*60*1e3);break}case"yesterday":{const m=new Date;m.setDate(m.getDate()-1),s=w(m,!0),u=w(m,!1);break}case"dayBefore":{const m=new Date;m.setDate(m.getDate()-2),s=w(m,!0),u=w(m,!1);break}default:s=new Date(o.getTime()-24*60*60*1e3),u=o}else s=new Date(o.getTime()-24*60*60*1e3),u=o;d+=`&startDate=${encodeURIComponent(s.toISOString())}`,d+=`&endDate=${encodeURIComponent(u.toISOString())}`}else c=r.value.type==="preset"?r.value.preset==="today"?1:r.value.preset==="7days"?7:30:Y(r.value.customStart,r.value.customEnd),d+=`granularity=day&days=${c}`;d+=`&metric=${i}`;const n=await j.get(d);n.success&&(W.value={data:n.data||[],topApiKeys:n.topApiKeys||[],totalApiKeys:n.totalApiKeys||0})}catch(d){console.error("加载API Keys趋势失败:",d)}}async function et(i=ct.value){try{let d="/admin/account-usage-trend?",c=7;if(U.value==="hour")if(d+="granularity=hour",r.value.customRange&&r.value.customRange.length===2){const o=s=>{const[m,T]=s.split(" "),[C,F,B]=m.split("-").map(Number),[z,E,q]=T.split(":").map(Number);return new Date(Date.UTC(C,F-1,B,z-8,E,q)).toISOString()};d+=`&startDate=${encodeURIComponent(o(r.value.customRange[0]))}`,d+=`&endDate=${encodeURIComponent(o(r.value.customRange[1]))}`}else{const o=new Date;let s,u;if(r.value.type==="preset")switch(r.value.preset){case"last24h":{u=new Date(o),s=new Date(o.getTime()-24*60*60*1e3);break}case"yesterday":{const m=new Date;m.setDate(m.getDate()-1),s=w(m,!0),u=w(m,!1);break}case"dayBefore":{const m=new Date;m.setDate(m.getDate()-2),s=w(m,!0),u=w(m,!1);break}default:s=new Date(o.getTime()-24*60*60*1e3),u=o}else s=new Date(o.getTime()-24*60*60*1e3),u=o;d+=`&startDate=${encodeURIComponent(s.toISOString())}`,d+=`&endDate=${encodeURIComponent(u.toISOString())}`}else c=r.value.type==="preset"?r.value.preset==="today"?1:r.value.preset==="7days"?7:30:Y(r.value.customStart,r.value.customEnd),d+=`granularity=day&days=${c}`;d+=`&group=${i}`;const n=await j.get(d);n.success&&(xt.value={data:n.data||[],topAccounts:n.topAccounts||[],totalAccounts:n.totalAccounts||0,group:n.group||i,groupLabel:n.groupLabel||""})}catch(d){console.error("加载账号使用趋势失败:",d)}}function G(i){r.value.type="preset",r.value.preset=i;const d=r.value.presetOptions.find(c=>c.value===i);if(d){const c=new Date;let n,o;if(U.value==="hour")switch(i){case"last24h":{o=new Date(c),n=new Date(c.getTime()-24*60*60*1e3);break}case"yesterday":{const s=new Date;s.setDate(s.getDate()-1),n=w(s,!0),o=w(s,!1);break}case"dayBefore":{const s=new Date;s.setDate(s.getDate()-2),n=w(s,!0),o=w(s,!1);break}}else n=new Date(c),o=new Date(c),i==="today"?(n.setHours(0,0,0,0),o.setHours(23,59,59,999)):(n.setDate(c.getDate()-(d.days-1)),n.setHours(0,0,0,0),o.setHours(23,59,59,999));if(r.value.customStart=n.toISOString().split("T")[0],r.value.customEnd=o.toISOString().split("T")[0],U.value==="hour"&&(i==="yesterday"||i==="dayBefore")){const s=new Date;i==="yesterday"?s.setDate(s.getDate()-1):s.setDate(s.getDate()-2);const u=s.getFullYear(),m=String(s.getMonth()+1).padStart(2,"0"),T=String(s.getDate()).padStart(2,"0");r.value.customRange=[`${u}-${m}-${T} 00:00:00`,`${u}-${m}-${T} 23:59:59`]}else{const s=u=>{const C=new Date(u.getTime()+288e5),F=C.getUTCFullYear(),B=String(C.getUTCMonth()+1).padStart(2,"0"),z=String(C.getUTCDate()).padStart(2,"0"),E=String(C.getUTCHours()).padStart(2,"0"),q=String(C.getUTCMinutes()).padStart(2,"0"),ot=String(C.getUTCSeconds()).padStart(2,"0");return`${F}-${B}-${z} ${E}:${q}:${ot}`};r.value.customRange=[s(n),s(o)]}}V()}function bt(i){if(i&&i.length===2){r.value.type="custom",r.value.preset="",r.value.customRange=i,r.value.customStart=i[0].split(" ")[0],r.value.customEnd=i[1].split(" ")[0];const d=o=>{const[s,u]=o.split(" "),[m,T,C]=s.split("-").map(Number),[F,B,z]=u.split(":").map(Number);return new Date(m,T-1,C,F,B,z)},c=d(i[0]),n=d(i[1]);if(U.value==="hour"){if((n-c)/36e5>24){It("小时粒度下日期范围不能超过24小时","warning");return}}else if(Math.ceil((n-c)/864e5)+1>31){It("日期范围不能超过 31 天","warning");return}V()}else i===null&&G(U.value==="hour"?"last24h":"7days")}function ht(i){if(U.value=i,i==="hour"){if(r.value.presetOptions=[{value:"last24h",label:"近24小时",hours:24},{value:"yesterday",label:"昨天",hours:24},{value:"dayBefore",label:"前天",hours:24}],r.value.type==="custom"&&r.value.customRange&&r.value.customRange.length===2){const d=new Date(r.value.customRange[0]);if((new Date(r.value.customRange[1])-d)/(1e3*60*60)>24){It("小时粒度下日期范围不能超过24小时，已切换到近24小时","warning"),G("last24h");return}}if(["today","7days","30days"].includes(r.value.preset)){G("last24h");return}}else if(r.value.presetOptions=[{value:"today",label:"今日",days:1},{value:"7days",label:"7天",days:7},{value:"30days",label:"30天",days:30}],["last24h","yesterday","dayBefore"].includes(r.value.preset)){G("7days");return}V()}async function V(){let i,d="monthly";if(r.value.type==="preset"){const c=r.value.presetOptions.find(n=>n.value===r.value.preset);U.value==="hour"?(i=1,d="daily"):(i=c?c.days:7,r.value.preset==="today"?d="daily":d="monthly")}else{if(U.value==="hour"){const c=new Date(r.value.customRange[0]),n=new Date(r.value.customRange[1]),o=Math.ceil((n-c)/(1e3*60*60));i=Math.ceil(o/24)||1}else i=Y(r.value.customStart,r.value.customEnd);d="daily"}await Promise.all([$t(i,U.value),At(d),Rt(wt.value),et(ct.value)])}function at(i){return ct.value=i,et(i)}function Y(i,d){if(!i||!d)return 7;const c=new Date(i),n=new Date(d),o=Math.abs(n-c);return Math.ceil(o/(1e3*60*60*24))||7}function st(i){return i>new Date}async function ut(){var i,d,c,n,o;if(!O.value){O.value=!0;try{const s=R.value,u={};s.range&&(u.range=s.range),s.platform&&s.platform!=="all"&&(u.platform=s.platform),s.groupId&&(u.groupId=s.groupId);const[m,T,C]=await Promise.all([j.get("/admin/dashboard/cost-efficiency/summary",{params:u}),j.get("/admin/dashboard/cost-efficiency/accounts",{params:{...u,sortBy:s.sortBy,order:s.order,limit:s.limit||12}}),j.get("/admin/dashboard/cost-efficiency/trends",{params:{...u,interval:s.interval||"day"}})]);L.value=m.success?m.data:null,T.success?(vt.value=((i=T.data)==null?void 0:i.items)||[],_t.value={total:((d=T.data)==null?void 0:d.total)||0,nextOffset:((c=T.data)==null?void 0:c.nextOffset)||0,hasMore:((n=T.data)==null?void 0:n.hasMore)||!1}):(vt.value=[],_t.value={total:0,nextOffset:0,hasMore:!1}),tt.value=C.success?((o=C.data)==null?void 0:o.data)||[]:[]}catch(s){console.error("❌ 加载性价比数据失败:",s),It("加载性价比数据失败","error")}finally{O.value=!1}}}function kt(i){R.value.range!==i&&(R.value.range=i,ut())}function Z(i){R.value.platform!==i&&(R.value.platform=i,ut())}function Pt(i){R.value.sortBy===i?R.value.order=R.value.order==="asc"?"desc":"asc":(R.value.sortBy=i,R.value.order=i==="cost"?"desc":"asc"),ut()}function Q(i){R.value.interval!==i&&(R.value.interval=i,ut())}return{loading:Tt,dashboardData:it,costsData:Ct,modelStats:dt,trendData:l,dashboardModelStats:gt,apiKeysTrendData:W,accountUsageTrendData:xt,dateFilter:r,trendGranularity:U,apiKeysTrendMetric:wt,accountUsageGroup:ct,defaultTime:Bt,formattedUptime:Mt,loadDashboardData:St,loadUsageTrend:$t,loadModelStats:At,loadApiKeysTrend:Rt,loadAccountUsageTrend:et,setDateFilterPreset:G,onCustomDateRangeChange:bt,setTrendGranularity:ht,refreshChartsData:V,setAccountUsageGroup:at,disabledDate:st,setCostEfficiencyRange:kt,setCostEfficiencyPlatform:Z,toggleCostEfficiencySort:Pt,setCostEfficiencyInterval:Q}}),te={class:"mb-4 grid grid-cols-1 gap-3 sm:mb-6 sm:grid-cols-2 sm:gap-4 md:mb-8 md:gap-6 lg:grid-cols-4"},ee={class:"stat-card"},ae={class:"flex items-center justify-between"},se={class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},oe={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},ne={class:"stat-card"},le={class:"flex items-center justify-between"},re={class:"flex-1"},ie={class:"flex flex-wrap items-baseline gap-x-2"},de={class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},ce={key:0,class:"flex items-center gap-2"},ue=["title"],me={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},ye=["title"],pe={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},fe=["title"],ge={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},xe=["title"],ve={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},be=["title"],he={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},ke=["title"],De={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},Te=["title"],Ce={class:"text-xs font-medium text-gray-700 dark:text-gray-300"},_e={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},we={key:0,class:"text-red-600"},Se={key:1,class:"text-gray-600 dark:text-gray-400"},$e={key:2,class:"text-yellow-600"},Ae={class:"stat-card"},Re={class:"flex items-center justify-between"},Pe={class:"text-2xl font-bold text-gray-900 dark:text-gray-100 sm:text-3xl"},Ie={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Ue={class:"stat-card"},Be={class:"flex items-center justify-between"},Me={class:"text-2xl font-bold text-green-600 sm:text-3xl"},Ke={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Oe={class:"mb-4 grid grid-cols-1 gap-3 sm:mb-6 sm:grid-cols-2 sm:gap-4 md:mb-8 md:gap-6 lg:grid-cols-4"},Fe={class:"stat-card"},Le={class:"flex items-center justify-between"},ze={class:"mr-8 flex-1"},Ee={class:"mb-2 flex flex-wrap items-baseline gap-2"},Ne={class:"text-xl font-bold text-blue-600 sm:text-2xl md:text-3xl"},qe={class:"text-sm font-medium text-green-600"},He={class:"text-xs text-gray-500 dark:text-gray-400"},Ve={class:"flex flex-wrap items-center justify-between gap-x-4"},je={class:"font-medium"},Ge={class:"font-medium"},Ye={key:0,class:"text-purple-600"},We={class:"font-medium"},Ze={key:1,class:"text-purple-600"},Qe={class:"font-medium"},Xe={class:"stat-card"},Je={class:"flex items-center justify-between"},ta={class:"mr-8 flex-1"},ea={class:"mb-2 flex flex-wrap items-baseline gap-2"},aa={class:"text-xl font-bold text-emerald-600 sm:text-2xl md:text-3xl"},sa={class:"text-sm font-medium text-green-600"},oa={class:"text-xs text-gray-500 dark:text-gray-400"},na={class:"flex flex-wrap items-center justify-between gap-x-4"},la={class:"font-medium"},ra={class:"font-medium"},ia={key:0,class:"text-purple-600"},da={class:"font-medium"},ca={key:1,class:"text-purple-600"},ua={class:"font-medium"},ma={class:"stat-card"},ya={class:"flex items-center justify-between"},pa={class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"},fa={class:"text-xs text-gray-400"},ga={class:"text-2xl font-bold text-orange-600 sm:text-3xl"},xa={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},va={key:0,class:"text-yellow-600"},ba={class:"stat-card"},ha={class:"flex items-center justify-between"},ka={class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"},Da={class:"text-xs text-gray-400"},Ta={class:"text-2xl font-bold text-rose-600 sm:text-3xl"},Ca={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},_a={key:0,class:"text-yellow-600"},wa={class:"mb-8"},Sa={class:"mb-4 flex flex-col gap-4 sm:mb-6"},$a={class:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-end"},Aa={class:"flex flex-shrink-0 gap-1 overflow-x-auto rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},Ra=["onClick"],Pa={class:"flex gap-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},Ia={class:"flex items-center gap-2"},Ua={key:0,class:"text-xs text-orange-600"},Ba={class:"flex items-center gap-2"},Ma={class:"flex items-center rounded-lg bg-gray-100 px-3 py-1 dark:bg-gray-700"},Ka={class:"relative inline-flex cursor-pointer items-center"},Oa={class:"ml-2.5 flex select-none items-center gap-1 text-sm font-medium text-gray-600 dark:text-gray-300"},Fa=["disabled"],La={class:"hidden sm:inline"},za={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},Ea={class:"card p-4 sm:p-6"},Na={class:"relative",style:{height:"250px"}},qa={class:"card p-4 sm:p-6"},Ha={key:0,class:"py-8 text-center"},Va={key:1,class:"max-h-[250px] overflow-auto sm:max-h-[300px]"},ja={class:"min-w-full"},Ga={class:"divide-y divide-gray-200 dark:divide-gray-600"},Ya={class:"px-2 py-2 text-xs text-gray-900 dark:text-gray-100 sm:px-4 sm:text-sm"},Wa=["title"],Za={class:"hidden px-2 py-2 text-right text-xs text-gray-600 dark:text-gray-400 sm:table-cell sm:px-4 sm:text-sm"},Qa={class:"px-2 py-2 text-right text-xs text-gray-600 dark:text-gray-400 sm:px-4 sm:text-sm"},Xa={class:"px-2 py-2 text-right text-xs font-medium text-green-600 sm:px-4 sm:text-sm"},Ja={class:"hidden px-2 py-2 text-right text-xs font-medium sm:table-cell sm:px-4 sm:text-sm"},ts={class:"inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},es={class:"mb-4 sm:mb-6 md:mb-8"},as={class:"card p-4 sm:p-6"},ss={class:"sm:h-[300px]",style:{height:"250px"}},os={class:"mb-4 sm:mb-6 md:mb-8"},ns={class:"card p-4 sm:p-6"},ls={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},rs={class:"flex gap-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},is={class:"mb-4 text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},ds={key:0},cs={key:1},us={class:"sm:h-[350px]",style:{height:"300px"}},ms={class:"mb-4 sm:mb-6 md:mb-8"},ys={class:"card p-4 sm:p-6"},ps={class:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},fs={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-3"},gs={class:"text-xs text-gray-500 dark:text-gray-400 sm:text-sm"},xs={class:"flex flex-wrap items-center gap-2"},vs={class:"flex gap-1 rounded-lg bg-gray-100 p-1 dark:bg-gray-700"},bs=["onClick"],hs={class:"mb-4 flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-400 sm:text-sm"},ks={key:0},Ds={key:0,class:"py-12 text-center text-sm text-gray-500 dark:text-gray-400"},Ts={key:1,class:"sm:h-[350px]",style:{height:"300px"}},Cs={__name:"DashboardView",setup(Tt){const it=Jt(),Ct=Xt(),{isDarkMode:dt}=zt(Ct),{dashboardData:l,costsData:gt,dashboardModelStats:W,trendData:xt,apiKeysTrendData:O,accountUsageTrendData:L,accountUsageGroup:vt,formattedUptime:_t,dateFilter:tt,trendGranularity:R,apiKeysTrendMetric:r,defaultTime:U}=zt(it),{loadDashboardData:wt,loadApiKeysTrend:ct,loadCostEfficiencyData:Bt,setDateFilterPreset:Mt,onCustomDateRangeChange:w,setTrendGranularity:St,refreshChartsData:$t,setAccountUsageGroup:At,disabledDate:Rt}=it,et=D(null),G=D(null),bt=D(null),ht=D(null);let V=null,at=null,Y=null,st=null;const ut=[{value:"claude",label:"Claude"},{value:"openai",label:"OpenAI"},{value:"gemini",label:"Gemini"}],kt=D(!1),Z=D(!1),Pt=D(30),Q=D(null),i=D(0),d=D(null),c=D(!1),n=Et(()=>({text:dt.value?"#e5e7eb":"#374151",grid:dt.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)",legend:dt.value?"#e5e7eb":"#374151"}));function o(g){return g>=1e6?(g/1e6).toFixed(2)+"M":g>=1e3?(g/1e3).toFixed(2)+"K":g.toString()}function s(g){return Number.isFinite(g)?g>=1?`$${g.toFixed(2)}`:g>=.01?`$${g.toFixed(3)}`:`$${g.toFixed(6)}`:"$0.000000"}function u(g,e){if(!e||e.length===0)return 0;const S=e.reduce((x,H)=>x+H.allTokens,0);return S===0?0:(g/S*100).toFixed(1)}function m(){if(!et.value)return;V&&V.destroy();const g=W.value||[],e={labels:g.map(S=>S.model),datasets:[{data:g.map(S=>S.allTokens),backgroundColor:["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#84CC16"],borderWidth:0}]};V=new Ut(et.value,{type:"doughnut",data:e,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:15,usePointStyle:!0,font:{size:12},color:n.value.legend}},tooltip:{callbacks:{label:function(S){const x=S.label||"",H=o(S.parsed),nt=u(S.parsed,g);return`${x}: ${H} (${nt}%)`}}}}}})}function T(){var f;if(!G.value)return;at&&at.destroy();const g=xt.value||[],e=g.map(y=>y.inputTokens||0),S=g.map(y=>y.outputTokens||0),x=g.map(y=>y.cacheCreateTokens||0),H=g.map(y=>y.cacheReadTokens||0),nt=g.map(y=>y.requests||0),mt=g.map(y=>y.cost||0),lt=(f=g[0])!=null&&f.date?"date":"hour",M={labels:g.map(y=>{if(y.label)return y.label;if(lt==="hour"){const v=new Date(y.hour),$=String(v.getMonth()+1).padStart(2,"0"),N=String(v.getDate()).padStart(2,"0"),K=String(v.getHours()).padStart(2,"0");return`${$}/${N} ${K}:00`}const k=y.date;if(k&&k.includes("-")){const v=k.split("-");if(v.length>=3)return`${v[1]}/${v[2]}`}return y.date}),datasets:[{label:"输入Token",data:e,borderColor:"rgb(102, 126, 234)",backgroundColor:"rgba(102, 126, 234, 0.1)",tension:.3},{label:"输出Token",data:S,borderColor:"rgb(240, 147, 251)",backgroundColor:"rgba(240, 147, 251, 0.1)",tension:.3},{label:"缓存创建Token",data:x,borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.3},{label:"缓存读取Token",data:H,borderColor:"rgb(147, 51, 234)",backgroundColor:"rgba(147, 51, 234, 0.1)",tension:.3},{label:"费用 (USD)",data:mt,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",tension:.3,yAxisID:"y2"},{label:"请求数",data:nt,borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.3,yAxisID:"y1"}]};at=new Ut(G.value,{type:"line",data:M,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:"Token使用趋势",font:{size:16,weight:"bold"},color:n.value.text},legend:{position:"top",labels:{color:n.value.legend}},tooltip:{mode:"index",intersect:!1,itemSort:function(y,k){const v=y.dataset.label||"",$=k.dataset.label||"";return v==="费用 (USD)"||$==="费用 (USD)"?v==="费用 (USD)"?-1:1:v==="请求数"||$==="请求数"?v==="请求数"?1:-1:k.parsed.y-y.parsed.y},callbacks:{label:function(y){const k=y.dataset.label||"";let v=y.parsed.y;return k==="费用 (USD)"?v<.01?k+": $"+v.toFixed(6):k+": $"+v.toFixed(4):k==="请求数"?k+": "+v.toLocaleString()+" 次":v>=1e6?k+": "+(v/1e6).toFixed(2)+"M tokens":v>=1e3?k+": "+(v/1e3).toFixed(2)+"K tokens":k+": "+v.toLocaleString()+" tokens"}}}},scales:{x:{type:"category",display:!0,title:{display:!0,text:R==="hour"?"时间":"日期",color:n.value.text},ticks:{color:n.value.text},grid:{color:n.value.grid}},y:{type:"linear",display:!0,position:"left",title:{display:!0,text:"Token数量",color:n.value.text},ticks:{callback:function(y){return o(y)},color:n.value.text},grid:{color:n.value.grid}},y1:{type:"linear",display:!0,position:"right",title:{display:!0,text:"请求数",color:n.value.text},grid:{drawOnChartArea:!1},ticks:{callback:function(y){return y.toLocaleString()},color:n.value.text}},y2:{type:"linear",display:!1,position:"right"}}}})}function C(){var mt,lt;if(!bt.value)return;Y&&Y.destroy();const g=O.value.data||[],e=r.value,S=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316","#6366F1","#84CC16"],x=((mt=O.value.topApiKeys)==null?void 0:mt.map((_,M)=>{var k,v;const f=O.value.data.map($=>!$.apiKeys||!$.apiKeys[_]?0:e==="tokens"?$.apiKeys[_].tokens:$.apiKeys[_].requests||0);return{label:((v=(k=O.value.data.find($=>$.apiKeys&&$.apiKeys[_]))==null?void 0:k.apiKeys[_])==null?void 0:v.name)||`API Key ${_}`,data:f,borderColor:S[M%S.length],backgroundColor:S[M%S.length]+"20",tension:.4,fill:!1}}))||[],H=(lt=g[0])!=null&&lt.date?"date":"hour",nt={labels:g.map(_=>{if(_.label)return _.label;if(H==="hour"){const f=new Date(_.hour),y=String(f.getMonth()+1).padStart(2,"0"),k=String(f.getDate()).padStart(2,"0"),v=String(f.getHours()).padStart(2,"0");return`${y}/${k} ${v}:00`}const M=_.date;if(M&&M.includes("-")){const f=M.split("-");if(f.length>=3)return`${f[1]}/${f[2]}`}return _.date}),datasets:x};Y=new Ut(bt.value,{type:"line",data:nt,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,font:{size:12},color:n.value.legend}},tooltip:{mode:"index",intersect:!1,itemSort:function(_,M){return M.parsed.y-_.parsed.y},callbacks:{label:function(_){var K;const M=_.dataset.label||"",f=_.parsed.y,y=_.dataIndex,k=O.value.data[y],$=_.chart.data.datasets.map((I,yt)=>({value:I.data[y]||0,index:yt})).sort((I,yt)=>yt.value-I.value).findIndex(I=>I.index===_.datasetIndex)+1;let N="";if($===1?N="🥇 ":$===2?N="🥈 ":$===3&&(N="🥉 "),r.value==="tokens"){let I="";f>=1e6?I=(f/1e6).toFixed(2)+"M":f>=1e3?I=(f/1e3).toFixed(2)+"K":I=f.toLocaleString();const yt=O.value.topApiKeys[_.datasetIndex],rt=(K=k==null?void 0:k.apiKeys)==null?void 0:K[yt],pt=(rt==null?void 0:rt.formattedCost)||"$0.00";return`${N}${M}: ${I} tokens (${pt})`}else return`${N}${M}: ${f.toLocaleString()} 次`}}}},scales:{x:{type:"category",display:!0,title:{display:!0,text:R==="hour"?"时间":"日期",color:n.value.text},ticks:{color:n.value.text},grid:{color:n.value.grid}},y:{beginAtZero:!0,title:{display:!0,text:r.value==="tokens"?"Token 数量":"请求次数",color:n.value.text},ticks:{callback:function(_){return o(_)},color:n.value.text},grid:{color:n.value.grid}}}}})}async function F(){await ct(r.value),await X(),C()}function B(){var lt,_,M;if(!ht.value)return;st&&st.destroy();const g=((lt=L.value)==null?void 0:lt.data)||[],e=((_=L.value)==null?void 0:_.topAccounts)||[],S=["#2563EB","#059669","#D97706","#DC2626","#7C3AED","#F472B6","#0EA5E9","#F97316","#6366F1","#22C55E"],x=e.map((f,y)=>{var $,N;const k=g.map(K=>!K.accounts||!K.accounts[f]?0:K.accounts[f].cost||0);return{label:((N=($=g.find(K=>K.accounts&&K.accounts[f]))==null?void 0:$.accounts[f])==null?void 0:N.name)||`账号 ${String(f).slice(0,6)}`,data:k,borderColor:S[y%S.length],backgroundColor:S[y%S.length]+"20",tension:.4,fill:!1}}),H=(M=g[0])!=null&&M.date?"date":"hour",nt={labels:g.map(f=>{if(f.label)return f.label;if(H==="hour"){const y=new Date(f.hour),k=String(y.getMonth()+1).padStart(2,"0"),v=String(y.getDate()).padStart(2,"0"),$=String(y.getHours()).padStart(2,"0");return`${k}/${v} ${$}:00`}if(f.date&&f.date.includes("-")){const y=f.date.split("-");if(y.length>=3)return`${y[1]}/${y[2]}`}return f.date}),datasets:x},mt=e;st=new Ut(ht.value,{type:"line",data:nt,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,font:{size:12},color:n.value.legend}},tooltip:{mode:"index",intersect:!1,itemSort:(f,y)=>y.parsed.y-f.parsed.y,callbacks:{label:function(f){var Lt;const y=f.dataset.label||"",k=f.parsed.y||0,v=f.dataIndex,$=f.datasetIndex,N=mt[$],K=L.value.data[v],I=(Lt=K==null?void 0:K.accounts)==null?void 0:Lt[N],rt=f.chart.data.datasets.map((Dt,Kt)=>({value:Dt.data[v]||0,index:Kt})).sort((Dt,Kt)=>Kt.value-Dt.value).findIndex(Dt=>Dt.index===$)+1;let pt="";rt===1?pt="🥇 ":rt===2?pt="🥈 ":rt===3&&(pt="🥉 ");const Nt=(I==null?void 0:I.formattedCost)||s(k),qt=(I==null?void 0:I.requests)||0;return`${pt}${y}: ${Nt} / ${qt.toLocaleString()} 次`}}}},scales:{x:{type:"category",display:!0,title:{display:!0,text:R.value==="hour"?"时间":"日期",color:n.value.text},ticks:{color:n.value.text},grid:{color:n.value.grid}},y:{beginAtZero:!0,title:{display:!0,text:"消耗金额 (USD)",color:n.value.text},ticks:{callback:f=>s(Number(f)),color:n.value.text},grid:{color:n.value.grid}}}}})}async function z(g){if(!(vt.value===g||kt.value)){kt.value=!0;try{await At(g),await X(),B()}finally{kt.value=!1}}}ft(W,()=>{X(()=>m())}),ft(xt,()=>{X(()=>T())}),ft(O,()=>{X(()=>C())}),ft(L,()=>{X(()=>B())});async function E(){if(!c.value){c.value=!0;try{await Promise.all([wt(),$t(),Bt()])}finally{c.value=!1}}}function q(){Z.value&&(i.value=Pt.value,d.value&&clearInterval(d.value),Q.value&&clearTimeout(Q.value),d.value=setInterval(()=>{i.value--,i.value<=0&&clearInterval(d.value)},1e3),Q.value=setTimeout(async()=>{await E(),Z.value&&q()},Pt.value*1e3))}function ot(){d.value&&(clearInterval(d.value),d.value=null),Q.value&&(clearTimeout(Q.value),Q.value=null),i.value=0}return ft(Z,g=>{g?q():ot()}),ft(dt,()=>{X(()=>{m(),T(),C(),B()})}),jt(async()=>{await E(),await X(),m(),T(),C(),B()}),Gt(()=>{ot(),V&&V.destroy(),at&&at.destroy(),Y&&Y.destroy(),st&&st.destroy()}),(g,e)=>{const S=Ht;return h(),b("div",null,[t("div",te,[t("div",ee,[t("div",ae,[t("div",null,[e[7]||(e[7]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 总API Keys ",-1)),t("p",se,p(a(l).totalApiKeys),1),t("p",oe," 活跃: "+p(a(l).activeApiKeys||0),1)]),e[8]||(e[8]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-blue-500 to-blue-600"},[t("i",{class:"fas fa-key"})],-1))])]),t("div",ne,[t("div",le,[t("div",re,[e[16]||(e[16]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 服务账户 ",-1)),t("div",ie,[t("p",de,p(a(l).totalAccounts),1),a(l).accountsByPlatform?(h(),b("div",ce,[a(l).accountsByPlatform.claude&&a(l).accountsByPlatform.claude.total>0?(h(),b("div",{key:0,class:"inline-flex items-center gap-0.5",title:`Claude: ${a(l).accountsByPlatform.claude.total} 个 (正常: ${a(l).accountsByPlatform.claude.normal})`},[e[9]||(e[9]=t("i",{class:"fas fa-brain text-xs text-indigo-600"},null,-1)),t("span",me,p(a(l).accountsByPlatform.claude.total),1)],8,ue)):A("",!0),a(l).accountsByPlatform["claude-console"]&&a(l).accountsByPlatform["claude-console"].total>0?(h(),b("div",{key:1,class:"inline-flex items-center gap-0.5",title:`Console: ${a(l).accountsByPlatform["claude-console"].total} 个 (正常: ${a(l).accountsByPlatform["claude-console"].normal})`},[e[10]||(e[10]=t("i",{class:"fas fa-terminal text-xs text-purple-600"},null,-1)),t("span",pe,p(a(l).accountsByPlatform["claude-console"].total),1)],8,ye)):A("",!0),a(l).accountsByPlatform.gemini&&a(l).accountsByPlatform.gemini.total>0?(h(),b("div",{key:2,class:"inline-flex items-center gap-0.5",title:`Gemini: ${a(l).accountsByPlatform.gemini.total} 个 (正常: ${a(l).accountsByPlatform.gemini.normal})`},[e[11]||(e[11]=t("i",{class:"fas fa-robot text-xs text-yellow-600"},null,-1)),t("span",ge,p(a(l).accountsByPlatform.gemini.total),1)],8,fe)):A("",!0),a(l).accountsByPlatform.bedrock&&a(l).accountsByPlatform.bedrock.total>0?(h(),b("div",{key:3,class:"inline-flex items-center gap-0.5",title:`Bedrock: ${a(l).accountsByPlatform.bedrock.total} 个 (正常: ${a(l).accountsByPlatform.bedrock.normal})`},[e[12]||(e[12]=t("i",{class:"fab fa-aws text-xs text-orange-600"},null,-1)),t("span",ve,p(a(l).accountsByPlatform.bedrock.total),1)],8,xe)):A("",!0),a(l).accountsByPlatform.openai&&a(l).accountsByPlatform.openai.total>0?(h(),b("div",{key:4,class:"inline-flex items-center gap-0.5",title:`OpenAI: ${a(l).accountsByPlatform.openai.total} 个 (正常: ${a(l).accountsByPlatform.openai.normal})`},[e[13]||(e[13]=t("i",{class:"fas fa-openai text-xs text-gray-100"},null,-1)),t("span",he,p(a(l).accountsByPlatform.openai.total),1)],8,be)):A("",!0),a(l).accountsByPlatform.azure_openai&&a(l).accountsByPlatform.azure_openai.total>0?(h(),b("div",{key:5,class:"inline-flex items-center gap-0.5",title:`Azure OpenAI: ${a(l).accountsByPlatform.azure_openai.total} 个 (正常: ${a(l).accountsByPlatform.azure_openai.normal})`},[e[14]||(e[14]=t("i",{class:"fab fa-microsoft text-xs text-blue-600"},null,-1)),t("span",De,p(a(l).accountsByPlatform.azure_openai.total),1)],8,ke)):A("",!0),a(l).accountsByPlatform["openai-responses"]&&a(l).accountsByPlatform["openai-responses"].total>0?(h(),b("div",{key:6,class:"inline-flex items-center gap-0.5",title:`OpenAI Responses: ${a(l).accountsByPlatform["openai-responses"].total} 个 (正常: ${a(l).accountsByPlatform["openai-responses"].normal})`},[e[15]||(e[15]=t("i",{class:"fas fa-server text-xs text-cyan-600"},null,-1)),t("span",Ce,p(a(l).accountsByPlatform["openai-responses"].total),1)],8,Te)):A("",!0)])):A("",!0)]),t("p",_e,[P(" 正常: "+p(a(l).normalAccounts||0)+" ",1),a(l).abnormalAccounts>0?(h(),b("span",we," | 异常: "+p(a(l).abnormalAccounts),1)):A("",!0),a(l).pausedAccounts>0?(h(),b("span",Se," | 停止调度: "+p(a(l).pausedAccounts),1)):A("",!0),a(l).rateLimitedAccounts>0?(h(),b("span",$e," | 限流: "+p(a(l).rateLimitedAccounts),1)):A("",!0)])]),e[17]||(e[17]=t("div",{class:"stat-icon ml-2 flex-shrink-0 bg-gradient-to-br from-green-500 to-green-600"},[t("i",{class:"fas fa-user-circle"})],-1))])]),t("div",Ae,[t("div",Re,[t("div",null,[e[18]||(e[18]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 今日请求 ",-1)),t("p",Pe,p(a(l).todayRequests),1),t("p",Ie," 总请求: "+p(o(a(l).totalRequests||0)),1)]),e[19]||(e[19]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-purple-500 to-purple-600"},[t("i",{class:"fas fa-chart-line"})],-1))])]),t("div",Ue,[t("div",Be,[t("div",null,[e[20]||(e[20]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 系统状态 ",-1)),t("p",Me,p(a(l).systemStatus),1),t("p",Ke," 运行时间: "+p(a(_t)),1)]),e[21]||(e[21]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-yellow-500 to-orange-500"},[t("i",{class:"fas fa-heartbeat"})],-1))])])]),t("div",Oe,[t("div",Fe,[t("div",Le,[t("div",ze,[e[26]||(e[26]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 今日Token ",-1)),t("div",Ee,[t("p",Ne,p(o((a(l).todayInputTokens||0)+(a(l).todayOutputTokens||0)+(a(l).todayCacheCreateTokens||0)+(a(l).todayCacheReadTokens||0))),1),t("span",qe,"/ "+p(a(gt).todayCosts.formatted.totalCost),1)]),t("div",He,[t("div",Ve,[t("span",null,[e[22]||(e[22]=P("输入: ",-1)),t("span",je,p(o(a(l).todayInputTokens||0)),1)]),t("span",null,[e[23]||(e[23]=P("输出: ",-1)),t("span",Ge,p(o(a(l).todayOutputTokens||0)),1)]),(a(l).todayCacheCreateTokens||0)>0?(h(),b("span",Ye,[e[24]||(e[24]=P("缓存创建: ",-1)),t("span",We,p(o(a(l).todayCacheCreateTokens||0)),1)])):A("",!0),(a(l).todayCacheReadTokens||0)>0?(h(),b("span",Ze,[e[25]||(e[25]=P("缓存读取: ",-1)),t("span",Qe,p(o(a(l).todayCacheReadTokens||0)),1)])):A("",!0)])])]),e[27]||(e[27]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-indigo-500 to-indigo-600"},[t("i",{class:"fas fa-coins"})],-1))])]),t("div",Xe,[t("div",Je,[t("div",ta,[e[32]||(e[32]=t("p",{class:"mb-1 text-xs font-semibold text-gray-600 dark:text-gray-400 sm:text-sm"}," 总Token消耗 ",-1)),t("div",ea,[t("p",aa,p(o((a(l).totalInputTokens||0)+(a(l).totalOutputTokens||0)+(a(l).totalCacheCreateTokens||0)+(a(l).totalCacheReadTokens||0))),1),t("span",sa,"/ "+p(a(gt).totalCosts.formatted.totalCost),1)]),t("div",oa,[t("div",na,[t("span",null,[e[28]||(e[28]=P("输入: ",-1)),t("span",la,p(o(a(l).totalInputTokens||0)),1)]),t("span",null,[e[29]||(e[29]=P("输出: ",-1)),t("span",ra,p(o(a(l).totalOutputTokens||0)),1)]),(a(l).totalCacheCreateTokens||0)>0?(h(),b("span",ia,[e[30]||(e[30]=P("缓存创建: ",-1)),t("span",da,p(o(a(l).totalCacheCreateTokens||0)),1)])):A("",!0),(a(l).totalCacheReadTokens||0)>0?(h(),b("span",ca,[e[31]||(e[31]=P("缓存读取: ",-1)),t("span",ua,p(o(a(l).totalCacheReadTokens||0)),1)])):A("",!0)])])]),e[33]||(e[33]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-emerald-500 to-emerald-600"},[t("i",{class:"fas fa-database"})],-1))])]),t("div",ma,[t("div",ya,[t("div",null,[t("p",pa,[e[34]||(e[34]=P(" 实时RPM ",-1)),t("span",fa,"("+p(a(l).metricsWindow)+"分钟)",1)]),t("p",ga,p(a(l).realtimeRPM||0),1),t("p",xa,[e[36]||(e[36]=P(" 每分钟请求数 ",-1)),a(l).isHistoricalMetrics?(h(),b("span",va,e[35]||(e[35]=[t("i",{class:"fas fa-exclamation-circle"},null,-1),P(" 历史数据 ",-1)]))):A("",!0)])]),e[37]||(e[37]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-orange-500 to-orange-600"},[t("i",{class:"fas fa-tachometer-alt"})],-1))])]),t("div",ba,[t("div",ha,[t("div",null,[t("p",ka,[e[38]||(e[38]=P(" 实时TPM ",-1)),t("span",Da,"("+p(a(l).metricsWindow)+"分钟)",1)]),t("p",Ta,p(o(a(l).realtimeTPM||0)),1),t("p",Ca,[e[40]||(e[40]=P(" 每分钟Token数 ",-1)),a(l).isHistoricalMetrics?(h(),b("span",_a,e[39]||(e[39]=[t("i",{class:"fas fa-exclamation-circle"},null,-1),P(" 历史数据 ",-1)]))):A("",!0)])]),e[41]||(e[41]=t("div",{class:"stat-icon flex-shrink-0 bg-gradient-to-br from-rose-500 to-rose-600"},[t("i",{class:"fas fa-rocket"})],-1))])])]),t("div",wa,[t("div",Sa,[e[48]||(e[48]=t("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 模型使用分布与Token使用趋势 ",-1)),t("div",$a,[t("div",Aa,[(h(!0),b(Ot,null,Ft(a(tt).presetOptions,x=>(h(),b("button",{key:x.value,class:J(["rounded-md px-3 py-1 text-sm font-medium transition-colors",a(tt).preset===x.value&&a(tt).type==="preset"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:H=>a(Mt)(x.value)},p(x.label),11,Ra))),128))]),t("div",Pa,[t("button",{class:J(["rounded-md px-3 py-1 text-sm font-medium transition-colors",a(R)==="day"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[0]||(e[0]=x=>a(St)("day"))},e[42]||(e[42]=[t("i",{class:"fas fa-calendar-day mr-1"},null,-1),P("按天 ",-1)]),2),t("button",{class:J(["rounded-md px-3 py-1 text-sm font-medium transition-colors",a(R)==="hour"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[1]||(e[1]=x=>a(St)("hour"))},e[43]||(e[43]=[t("i",{class:"fas fa-clock mr-1"},null,-1),P("按小时 ",-1)]),2)]),t("div",Ia,[Yt(S,{modelValue:a(tt).customRange,"onUpdate:modelValue":e[2]||(e[2]=x=>a(tt).customRange=x),class:"custom-date-picker w-full lg:w-auto","default-time":a(U),"disabled-date":a(Rt),"end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","range-separator":"至",size:"default","start-placeholder":"开始日期",style:{"max-width":"400px"},type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss",onChange:a(w)},null,8,["modelValue","default-time","disabled-date","onChange"]),a(R)==="hour"?(h(),b("span",Ua,e[44]||(e[44]=[t("i",{class:"fas fa-info-circle"},null,-1),P(" 最多24小时 ",-1)]))):A("",!0)]),t("div",Ba,[t("div",Ma,[t("label",Ka,[Wt(t("input",{"onUpdate:modelValue":e[3]||(e[3]=x=>Z.value=x),class:"peer sr-only",type:"checkbox"},null,512),[[Zt,Z.value]]),e[47]||(e[47]=t("div",{class:"peer relative h-5 w-9 rounded-full bg-gray-300 transition-all duration-200 after:absolute after:left-[2px] after:top-0.5 after:h-4 after:w-4 after:rounded-full after:bg-white after:shadow-sm after:transition-transform after:duration-200 after:content-[''] peer-checked:bg-blue-500 peer-checked:after:translate-x-4 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:bg-gray-600 dark:after:bg-gray-300 dark:peer-focus:ring-blue-600"},null,-1)),t("span",Oa,[e[45]||(e[45]=t("i",{class:"fas fa-redo-alt text-xs text-gray-500 dark:text-gray-400"},null,-1)),e[46]||(e[46]=t("span",null,"自动刷新",-1)),Z.value?(h(),b("span",{key:0,class:J(["ml-1 font-mono text-xs text-blue-600 transition-opacity",i.value>0?"opacity-100":"opacity-0"])},p(i.value)+"s ",3)):A("",!0)])])]),t("button",{class:"flex items-center gap-1 rounded-md border border-gray-300 bg-white px-3 py-1 text-sm font-medium text-blue-600 shadow-sm transition-colors hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 sm:gap-2",disabled:c.value,title:"立即刷新数据",onClick:e[4]||(e[4]=x=>E())},[t("i",{class:J(["fas fa-sync-alt text-xs",{"animate-spin":c.value}])},null,2),t("span",La,p(c.value?"刷新中":"刷新"),1)],8,Fa)])])]),t("div",za,[t("div",Ea,[e[49]||(e[49]=t("h4",{class:"mb-4 text-base font-semibold text-gray-800 dark:text-gray-200 sm:text-lg"}," Token使用分布 ",-1)),t("div",Na,[t("canvas",{ref_key:"modelUsageChart",ref:et},null,512)])]),t("div",qa,[e[52]||(e[52]=t("h4",{class:"mb-4 text-base font-semibold text-gray-800 dark:text-gray-200 sm:text-lg"}," 详细统计数据 ",-1)),a(W).length===0?(h(),b("div",Ha,e[50]||(e[50]=[t("p",{class:"text-sm text-gray-500 sm:text-base"},"暂无模型使用数据",-1)]))):(h(),b("div",Va,[t("table",ja,[e[51]||(e[51]=t("thead",{class:"sticky top-0 bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-2 py-2 text-left text-xs font-medium text-gray-700 dark:text-gray-300 sm:px-4"}," 模型 "),t("th",{class:"hidden px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:table-cell sm:px-4"}," 请求数 "),t("th",{class:"px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:px-4"}," 总Token "),t("th",{class:"px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:px-4"}," 费用 "),t("th",{class:"hidden px-2 py-2 text-right text-xs font-medium text-gray-700 dark:text-gray-300 sm:table-cell sm:px-4"}," 占比 ")])],-1)),t("tbody",Ga,[(h(!0),b(Ot,null,Ft(a(W),x=>(h(),b("tr",{key:x.model,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[t("td",Ya,[t("span",{class:"block max-w-[100px] truncate sm:max-w-none",title:x.model},p(x.model),9,Wa)]),t("td",Za,p(o(x.requests)),1),t("td",Qa,p(o(x.allTokens)),1),t("td",Xa,p(x.formatted?x.formatted.total:"$0.000000"),1),t("td",Ja,[t("span",ts,p(u(x.allTokens,a(W)))+"% ",1)])]))),128))])])]))])])]),t("div",es,[t("div",as,[t("div",ss,[t("canvas",{ref_key:"usageTrendChart",ref:G},null,512)])])]),t("div",os,[t("div",ns,[t("div",ls,[e[55]||(e[55]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-gray-100 sm:text-lg"}," API Keys 使用趋势 ",-1)),t("div",rs,[t("button",{class:J(["rounded-md px-2 py-1 text-xs font-medium transition-colors sm:px-3 sm:text-sm",a(r)==="requests"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[5]||(e[5]=x=>(r.value="requests",F()))},e[53]||(e[53]=[t("i",{class:"fas fa-exchange-alt mr-1"},null,-1),t("span",{class:"hidden sm:inline"},"请求次数",-1),t("span",{class:"sm:hidden"},"请求",-1)]),2),t("button",{class:J(["rounded-md px-2 py-1 text-xs font-medium transition-colors sm:px-3 sm:text-sm",a(r)==="tokens"?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:e[6]||(e[6]=x=>(r.value="tokens",F()))},e[54]||(e[54]=[t("i",{class:"fas fa-coins mr-1"},null,-1),t("span",{class:"hidden sm:inline"},"Token 数量",-1),t("span",{class:"sm:hidden"},"Token",-1)]),2)])]),t("div",is,[a(O).totalApiKeys>10?(h(),b("span",ds," 共 "+p(a(O).totalApiKeys)+" 个 API Key，显示使用量前 10 个 ",1)):(h(),b("span",cs," 共 "+p(a(O).totalApiKeys)+" 个 API Key ",1))]),t("div",us,[t("canvas",{ref_key:"apiKeysUsageTrendChart",ref:bt},null,512)])])]),t("div",ms,[t("div",ys,[t("div",ps,[t("div",fs,[e[56]||(e[56]=t("h3",{class:"text-base font-semibold text-gray-900 dark:text-gray-100 sm:text-lg"}," 账号使用趋势 ",-1)),t("span",gs," 当前分组："+p(a(L).groupLabel||"未选择"),1)]),t("div",xs,[t("div",vs,[(h(),b(Ot,null,Ft(ut,x=>t("button",{key:x.value,class:J(["rounded-md px-2 py-1 text-xs font-medium transition-colors sm:px-3 sm:text-sm",a(vt)===x.value?"bg-white text-blue-600 shadow-sm dark:bg-gray-800":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"]),onClick:H=>z(x.value)},p(x.label),11,bs)),64))])])]),t("div",hs,[t("span",null,"共 "+p(a(L).totalAccounts||0)+" 个账号",1),a(L).topAccounts&&a(L).topAccounts.length?(h(),b("span",ks," 显示消耗排名前 "+p(a(L).topAccounts.length)+" 个账号 ",1)):A("",!0)]),!a(L).data||a(L).data.length===0?(h(),b("div",Ds," 暂无账号使用数据 ")):(h(),b("div",Ts,[t("canvas",{ref_key:"accountUsageTrendChart",ref:ht},null,512)]))])])])}}},Rs=Qt(Cs,[["__scopeId","data-v-2eda8693"]]);export{Rs as default};
