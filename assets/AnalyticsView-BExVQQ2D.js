import{r as C,q as Y,x as u,y as d,z as t,K as w,aV as L,aT as O,P as n,Q as B,ac as R,C as D,c as W,L as U,O as q,aX as st,o as at,V as ot,_ as et,Y as G,aq as V,B as Z,D as lt,I as J,S as tt,R as Q}from"./vue-vendor-Bsazo-x0.js";import{c as F,s as N,a as rt,_ as H}from"./index-d-zYfmhZ.js";import{C as nt}from"./chart-D0-mP5KW.js";import{R as it}from"./vendor-CrxIEVZC.js";import"./element-plus-DcHmMMW3.js";const dt={class:"cost-efficiency-analysis"},ct={class:"card p-6"},ut={class:"mb-6 flex items-center justify-between"},gt={class:"flex gap-3"},pt={key:0,class:"flex h-64 items-center justify-center"},xt={key:1},yt={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},mt={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},vt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},ft={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},bt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},kt={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},ht={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},$t={class:"overflow-x-auto"},_t={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ct={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},wt={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},Pt={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},St={class:"rounded-full bg-blue-100 px-2 py-1 text-xs dark:bg-blue-900/30"},Tt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},At={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Ft={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Vt={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Ut={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Dt={key:2,class:"flex flex-col items-center justify-center py-12"},It={__name:"CostEfficiencyAnalysis",setup(P){const v=C(!1),f=C({range:"30d",platform:"all"}),$=C({}),c=C([]),a=m=>m>=1e6?(m/1e6).toFixed(2)+"M":m>=1e3?(m/1e3).toFixed(2)+"K":(m==null?void 0:m.toString())||"0",b=async()=>{var m,p;v.value=!0;try{const T={...f.value};console.log("ğŸ” Loading cost efficiency data with params:",T);const[x,s]=await Promise.all([F.get("/admin/dashboard/cost-efficiency/summary",{params:T}),F.get("/admin/dashboard/cost-efficiency/accounts",{params:{...T,limit:50}})]);console.log("ğŸ“Š Summary response:",x),console.log("ğŸ“‹ Accounts response:",s),x!=null&&x.success?($.value=x.data||{},console.log("âœ… Summary data loaded:",$.value)):(console.warn("âš ï¸ Summary response missing success flag:",x),$.value={}),s!=null&&s.success?(c.value=((m=s.data)==null?void 0:m.items)||[],console.log("âœ… Accounts data loaded:",c.value.length,"items")):(console.warn("âš ï¸ Accounts response missing success flag:",s),c.value=[]),((p=x==null?void 0:x.data)==null?void 0:p.available)===!1&&N("æ•°æ®åº“æœªå¯ç”¨,æ— æ³•åŠ è½½ç»Ÿè®¡æ•°æ®","warning")}catch(T){console.error("âŒ Failed to load cost efficiency data:",T),N("åŠ è½½æ€§ä»·æ¯”æ•°æ®å¤±è´¥: "+(T.message||"æœªçŸ¥é”™è¯¯"),"error"),$.value={},c.value=[]}finally{v.value=!1}};return Y(()=>{b()}),(m,p)=>{var T,x,s;return d(),u("div",dt,[t("div",ct,[t("div",ut,[p[4]||(p[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"è´¦æˆ·æ€§ä»·æ¯”å¯¹æ¯”"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," å¯¹æ¯”ä¸åŒè´¦æˆ·çš„æˆæœ¬æ•ˆç‡å’Œä½¿ç”¨æƒ…å†µ ")],-1)),t("div",gt,[w(t("select",{"onUpdate:modelValue":p[0]||(p[0]=e=>f.value.range=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:b},p[2]||(p[2]=[t("option",{value:"today"},"ä»Šæ—¥",-1),t("option",{value:"7days"},"7å¤©",-1),t("option",{value:"30d"},"30å¤©",-1),t("option",{value:"total"},"å…¨éƒ¨",-1)]),544),[[L,f.value.range]]),w(t("select",{"onUpdate:modelValue":p[1]||(p[1]=e=>f.value.platform=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:b},p[3]||(p[3]=[O('<option value="all">å…¨éƒ¨å¹³å°</option><option value="claude">Claude</option><option value="claude-console">Console</option><option value="gemini">Gemini</option><option value="openai">OpenAI</option>',5)]),544),[[L,f.value.platform]])])]),v.value?(d(),u("div",pt,p[5]||(p[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):c.value.length>0||$.value.totals?(d(),u("div",xt,[t("div",yt,[t("div",mt,[p[6]||(p[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»è´¦æˆ·æ•°",-1)),t("div",vt,n(((T=$.value.totals)==null?void 0:T.accountCount)||0),1)]),t("div",ft,[p[7]||(p[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¹³å‡æˆæœ¬/ç™¾ä¸‡Token",-1)),t("div",bt," $"+n((((x=$.value.totals)==null?void 0:x.costPerMillion)||0).toFixed(2)),1)]),t("div",kt,[p[8]||(p[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¹³å‡æˆåŠŸç‡",-1)),t("div",ht,n(((((s=$.value.totals)==null?void 0:s.successRate)||0)*100).toFixed(1))+"% ",1)])]),t("div",$t,[t("table",_t,[p[9]||(p[9]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è´¦æˆ· "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å¹³å° "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¯·æ±‚æ•° "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»æˆæœ¬ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æˆæœ¬/ç™¾ä¸‡Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æˆåŠŸç‡ ")])],-1)),t("tbody",Ct,[(d(!0),u(B,null,R(c.value,e=>(d(),u("tr",{key:e.accountId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",wt,n(e.accountName),1),t("td",Pt,[t("span",St,n(e.platform),1)]),t("td",Tt,n(a(e.totalRequests)),1),t("td",At,n(a(e.totalTokens)),1),t("td",Ft," $"+n((e.totalCost||0).toFixed(6)),1),t("td",Vt," $"+n((e.costPerMillion||0).toFixed(2)),1),t("td",Ut,[t("span",{class:D(["rounded-full px-2 py-1 text-xs",e.successRate>=.95?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":e.successRate>=.8?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"])},n(((e.successRate||0)*100).toFixed(1))+"% ",3)])]))),128))])])])])):(d(),u("div",Dt,p[10]||(p[10]=[O('<div class="mb-4 text-6xl">ğŸ“Š</div><h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100">æš‚æ— æ•°æ®</h3><p class="mb-4 text-center text-sm text-gray-600 dark:text-gray-400"> å½“å‰æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°è´¦æˆ·ä½¿ç”¨æ•°æ® </p><div class="text-xs text-gray-500 dark:text-gray-500"><p>å¯èƒ½çš„åŸå› :</p><ul class="mt-2 list-inside list-disc space-y-1"><li>æ•°æ®åº“æœªå¯ç”¨æˆ–æœªé…ç½®</li><li>é€‰æ‹©çš„æ—¶é—´èŒƒå›´å†…æ²¡æœ‰ä½¿ç”¨è®°å½•</li><li>æ‰€æœ‰è´¦æˆ·éƒ½è¢«ç­›é€‰æ¡ä»¶æ’é™¤</li></ul></div>',4)])))])])}}},Mt={class:"api-key-breakdown-analysis"},qt={class:"card p-6"},Bt={class:"mb-6 flex items-center justify-between"},Lt={class:"flex gap-3"},Rt=["value"],jt={key:0,class:"flex h-64 items-center justify-center"},Et={key:1,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Nt={key:2},Kt={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},Ot={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Yt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},zt={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Gt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Ht={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Qt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Wt={class:"overflow-x-auto"},Xt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Zt={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Jt=["onClick"],te={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},ee={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},se={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},ae={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},oe={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},le={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},re={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},ne={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},ie={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},de={class:"bg-gray-50 px-4 py-4 dark:bg-gray-800/50",colspan:"9"},ce={key:0,class:"flex justify-center py-4"},ue={key:1,class:"space-y-2"},ge={class:"mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},pe={class:"max-h-96 overflow-y-auto"},xe={class:"min-w-full text-xs"},ye={class:"divide-y divide-gray-200 dark:divide-gray-600"},me={class:"px-3 py-2 text-gray-700 dark:text-gray-300"},ve={class:"px-3 py-2 text-gray-700 dark:text-gray-300"},fe={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},be={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},ke={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},he={class:"px-3 py-2 text-right text-gray-600 dark:text-gray-400"},$e={class:"px-3 py-2 text-right font-medium text-gray-900 dark:text-gray-100"},_e={class:"px-3 py-2 text-right font-medium text-gray-900 dark:text-gray-100"},Ce={class:"px-3 py-2 text-center"},we={key:0,class:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",title:"æ­¤è¯·æ±‚çš„ token æ•°æ®éœ€è¦äººå·¥æ ¸å¯¹"},Pe={key:1,class:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",title:"æ­¤è®°å½•å·²æ‰‹åŠ¨æ›´æ–°"},Se={key:2,class:"rounded bg-green-100 px-2 py-1 text-xs text-green-800 dark:bg-green-900/30 dark:text-green-300"},Te={key:2,class:"py-4 text-center text-sm text-gray-500"},Ae={key:3,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Fe={__name:"ApiKeyBreakdownAnalysis",setup(P){const v=C(!1),f=C([]),$=C(""),c=C({range:"30d"}),a=C([]),b=C(new Set),m=C({}),p=C({}),T=W(()=>a.value.reduce((o,g)=>o+(g.requests||0),0)),x=W(()=>a.value.reduce((o,g)=>o+(g.totalCost||0),0)),s=o=>o>=1e6?(o/1e6).toFixed(2)+"M":o>=1e3?(o/1e3).toFixed(2)+"K":(o==null?void 0:o.toString())||"0",e=o=>{if(!o)return"-";const g=new Date(o);return Number.isNaN(g.getTime())?o:`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")} ${String(g.getHours()).padStart(2,"0")}:${String(g.getMinutes()).padStart(2,"0")}`},r=o=>{if(!o)return"-";const g=new Date(o);if(Number.isNaN(g.getTime()))return o;const h=String(g.getMonth()+1).padStart(2,"0"),M=String(g.getDate()).padStart(2,"0"),y=String(g.getHours()).padStart(2,"0"),k=String(g.getMinutes()).padStart(2,"0"),i=String(g.getSeconds()).padStart(2,"0");return`${h}-${M} ${y}:${k}:${i}`},A=async()=>{try{console.log("ğŸ” Loading accounts for API key breakdown");const o=await F.get("/admin/accounts/usage-stats",{params:{range:"total"}});console.log("ğŸ“‹ Accounts response:",o),o!=null&&o.success?(f.value=o.data||[],console.log("âœ… Accounts loaded:",f.value.length,"accounts")):(console.warn("âš ï¸ Accounts response missing success flag:",o),f.value=[])}catch(o){console.error("âŒ Failed to load accounts:",o),N("åŠ è½½è´¦æˆ·åˆ—è¡¨å¤±è´¥: "+(o.message||"æœªçŸ¥é”™è¯¯"),"error"),f.value=[]}},I=async()=>{if(!$.value){a.value=[];return}v.value=!0;try{console.log("ğŸ” Loading API key breakdown for account:",$.value);const o=await F.get(`/admin/accounts/${$.value}/usage-breakdown`,{params:{...c.value,limit:100}});console.log("ğŸ”‘ Breakdown response:",o),o!=null&&o.success?(a.value=o.items||[],console.log("âœ… Breakdown loaded:",a.value.length,"API keys"),b.value.clear(),p.value={}):(console.warn("âš ï¸ Breakdown response missing success flag:",o),a.value=[])}catch(o){console.error("âŒ Failed to load API key breakdown:",o),N("åŠ è½½ API Key æ˜ç»†å¤±è´¥: "+(o.message||"æœªçŸ¥é”™è¯¯"),"error"),a.value=[]}finally{v.value=!1}},_=async o=>{b.value.has(o)?(b.value.delete(o),b.value=new Set(b.value)):(b.value.add(o),b.value=new Set(b.value),await l(o))},l=async o=>{m.value[o]=!0;try{const g=await F.get(`/admin/api-keys/${o}/usage-details`,{params:{range:c.value.range,limit:50}});g.success&&(p.value[o]=g.items||[])}catch{N("åŠ è½½è¯·æ±‚è¯¦æƒ…å¤±è´¥","error"),p.value[o]=[]}finally{m.value[o]=!1}};return Y(()=>{A()}),(o,g)=>(d(),u("div",Mt,[t("div",qt,[t("div",Bt,[g[4]||(g[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"API Key è°ƒç”¨æ˜ç»†"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," æŸ¥çœ‹æ¯ä¸ª API Key çš„è¯¦ç»†è°ƒç”¨ç»Ÿè®¡ ")],-1)),t("div",Lt,[w(t("select",{"onUpdate:modelValue":g[0]||(g[0]=h=>$.value=h),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:I},[g[2]||(g[2]=t("option",{value:""},"é€‰æ‹©è´¦æˆ·",-1)),(d(!0),u(B,null,R(f.value,h=>(d(),u("option",{key:h.id,value:h.id},n(h.name)+" ("+n(h.platform)+") ",9,Rt))),128))],544),[[L,$.value]]),w(t("select",{"onUpdate:modelValue":g[1]||(g[1]=h=>c.value.range=h),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:I},g[3]||(g[3]=[t("option",{value:"today"},"ä»Šæ—¥",-1),t("option",{value:"7days"},"7å¤©",-1),t("option",{value:"30d"},"30å¤©",-1),t("option",{value:"total"},"å…¨éƒ¨",-1)]),544),[[L,c.value.range]])])]),v.value?(d(),u("div",jt,g[5]||(g[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):$.value?a.value.length>0?(d(),u("div",Nt,[t("div",Kt,[t("div",Ot,[g[7]||(g[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"API Key æ€»æ•°",-1)),t("div",Yt,n(a.value.length),1)]),t("div",zt,[g[8]||(g[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»è¯·æ±‚æ•°",-1)),t("div",Gt,n(s(T.value)),1)]),t("div",Ht,[g[9]||(g[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»æˆæœ¬",-1)),t("div",Qt," $"+n(x.value.toFixed(6)),1)])]),t("div",Wt,[t("table",Xt,[g[12]||(g[12]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," API Key "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¯·æ±‚æ•° "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¾“å…¥Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è¾“å‡ºToken "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ç¼“å­˜åˆ›å»º "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ç¼“å­˜è¯»å– "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ€»æˆæœ¬ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æœ€åä½¿ç”¨ ")])],-1)),t("tbody",Zt,[(d(!0),u(B,null,R(a.value,h=>{var M;return d(),u(B,{key:h.apiKeyId},[t("tr",{class:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:y=>_(h.apiKeyId)},[t("td",te,[t("i",{class:D(["mr-2 text-xs text-gray-400",b.value.has(h.apiKeyId)?"fas fa-chevron-down":"fas fa-chevron-right"])},null,2),q(" "+n(h.apiKeyName),1)]),t("td",ee,n(s(h.requests)),1),t("td",se,n(s(h.inputTokens)),1),t("td",ae,n(s(h.outputTokens)),1),t("td",oe,n(s(h.cacheCreateTokens||0)),1),t("td",le,n(s(h.cacheReadTokens||0)),1),t("td",re,n(s(h.totalTokens)),1),t("td",ne," $"+n((h.totalCost||0).toFixed(6)),1),t("td",ie,n(e(h.lastUsedAt)),1)],8,Jt),b.value.has(h.apiKeyId)?(d(),u("tr",{key:`${h.apiKeyId}-details`},[t("td",de,[m.value[h.apiKeyId]?(d(),u("div",ce,g[10]||(g[10]=[t("div",{class:"loading-spinner h-8 w-8 border-4 border-indigo-500"},null,-1)]))):((M=p.value[h.apiKeyId])==null?void 0:M.length)>0?(d(),u("div",ue,[t("div",ge," è¯¦ç»†è¯·æ±‚è®°å½• (æœ€è¿‘ "+n(p.value[h.apiKeyId].length)+" æ¡) ",1),t("div",pe,[t("table",xe,[g[11]||(g[11]=t("thead",{class:"bg-gray-100 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left text-gray-600 dark:text-gray-300"}," æ—¶é—´ "),t("th",{class:"px-3 py-2 text-left text-gray-600 dark:text-gray-300"}," æ¨¡å‹ "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," è¾“å…¥ "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," è¾“å‡º "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," ç¼“å­˜åˆ›å»º "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," ç¼“å­˜è¯»å– "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," æ€»è®¡ "),t("th",{class:"px-3 py-2 text-right text-gray-600 dark:text-gray-300"}," è´¹ç”¨ "),t("th",{class:"px-3 py-2 text-center text-gray-600 dark:text-gray-300"}," çŠ¶æ€ ")])],-1)),t("tbody",ye,[(d(!0),u(B,null,R(p.value[h.apiKeyId],y=>{var k,i;return d(),u("tr",{key:y.id,class:"hover:bg-gray-100 dark:hover:bg-gray-700"},[t("td",me,n(r(y.occurred_at)),1),t("td",ve,n(y.model),1),t("td",fe,n(y.input_tokens),1),t("td",be,n(y.output_tokens),1),t("td",ke,n(y.cache_create_tokens),1),t("td",he,n(y.cache_read_tokens),1),t("td",$e,n(y.total_tokens),1),t("td",_e," $"+n(parseFloat(y.total_cost||0).toFixed(6)),1),t("td",Ce,[(k=y.metadata)!=null&&k._no_usage_data?(d(),u("span",we," éœ€æ ¸å¯¹ ")):(i=y.metadata)!=null&&i._manually_updated?(d(),u("span",Pe," å·²æ›´æ–° ")):(d(),u("span",Se," æ­£å¸¸ "))])])}),128))])])])])):(d(),u("div",Te,"æš‚æ— è¯¦ç»†è®°å½•"))])])):U("",!0)],64)}),128))])])])])):(d(),u("div",Ae,g[13]||(g[13]=[t("i",{class:"fas fa-inbox mb-4 text-4xl"},null,-1),t("p",null,"è¯¥è´¦æˆ·æš‚æ—  API Key è°ƒç”¨æ•°æ®",-1)]))):(d(),u("div",Et,g[6]||(g[6]=[t("i",{class:"fas fa-key mb-4 text-4xl"},null,-1),t("p",null,"è¯·é€‰æ‹©ä¸€ä¸ªè´¦æˆ·æŸ¥çœ‹ API Key è°ƒç”¨æ˜ç»†",-1)])))])]))}},Ve={class:"cost-trends-analysis"},Ue={class:"card p-6"},De={class:"mb-6 flex items-center justify-between"},Ie={class:"flex gap-3"},Me={key:0,class:"flex h-64 items-center justify-center"},qe={key:1,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Be={key:2},Le={class:"mb-6 h-80"},Re={class:"grid grid-cols-1 gap-4 md:grid-cols-4"},je={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Ee={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},Ne={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Ke={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},Oe={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},Ye={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},ze={class:"rounded-lg bg-gradient-to-br from-orange-50 to-red-50 p-4 dark:from-orange-900/20 dark:to-red-900/20"},Ge={__name:"CostTrendsAnalysis",setup(P){const v=rt(),{isDarkMode:f}=st(v),$=C(!1),c=C(null);let a=null;const b=C({range:"30d",interval:"day"}),m=C([]),p=W(()=>{if(m.value.length===0)return{totalCost:0,avgCost:0,maxCost:0,growthRate:0};const s=m.value.map(o=>o.totalCost||o.cost||0),e=s.reduce((o,g)=>o+g,0),r=e/s.length,A=Math.max(...s),I=s[0]||0,_=s[s.length-1]||0,l=I>0?(_-I)/I*100:0;return{totalCost:e,avgCost:r,maxCost:A,growthRate:l}}),T=async()=>{var s,e;$.value=!0;try{console.log("ğŸ” Loading cost trends with params:",b.value);const r=await F.get("/admin/dashboard/cost-efficiency/trends",{params:b.value});console.log("ğŸ“ˆ Trends response:",r),r!=null&&r.success?(m.value=((s=r.data)==null?void 0:s.data)||[],console.log("âœ… Trends data loaded:",m.value.length,"data points"),x()):(console.warn("âš ï¸ Trends response missing success flag:",r),m.value=[]),((e=r==null?void 0:r.data)==null?void 0:e.available)===!1&&N("æ•°æ®åº“æœªå¯ç”¨,æ— æ³•åŠ è½½è¶‹åŠ¿æ•°æ®","warning")}catch(r){console.error("âŒ Failed to load cost trends:",r),N("åŠ è½½è¶‹åŠ¿æ•°æ®å¤±è´¥: "+(r.message||"æœªçŸ¥é”™è¯¯"),"error"),m.value=[]}finally{$.value=!1}},x=()=>{if(!c.value||m.value.length===0)return;a&&a.destroy();const s=m.value.map(r=>r.timestamp?new Date(r.timestamp).toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"}):r.date||r.label||""),e=m.value.map(r=>r.totalCost||r.cost||0);a=new nt(c.value,{type:"line",data:{labels:s,datasets:[{label:"æˆæœ¬",data:e,borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:r=>`æˆæœ¬: $${r.parsed.y.toFixed(6)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:r=>`$${r.toFixed(6)}`,color:f.value?"#9ca3af":"#6b7280"},grid:{color:f.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}},x:{ticks:{color:f.value?"#9ca3af":"#6b7280"},grid:{color:f.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}}}}})};return at(f,()=>{x()}),Y(()=>{T()}),ot(()=>{a&&a.destroy()}),(s,e)=>(d(),u("div",Ve,[t("div",Ue,[t("div",De,[e[4]||(e[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"æˆæœ¬è¶‹åŠ¿åˆ†æ"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},"æŸ¥çœ‹æˆæœ¬å˜åŒ–è¶‹åŠ¿å’Œé¢„æµ‹")],-1)),t("div",Ie,[w(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>b.value.range=r),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:T},e[2]||(e[2]=[t("option",{value:"7days"},"7å¤©",-1),t("option",{value:"30d"},"30å¤©",-1),t("option",{value:"90d"},"90å¤©",-1)]),544),[[L,b.value.range]]),w(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>b.value.interval=r),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:T},e[3]||(e[3]=[t("option",{value:"hour"},"æŒ‰å°æ—¶",-1),t("option",{value:"day"},"æŒ‰å¤©",-1),t("option",{value:"week"},"æŒ‰å‘¨",-1)]),544),[[L,b.value.interval]])])]),$.value?(d(),u("div",Me,e[5]||(e[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):m.value.length===0?(d(),u("div",qe,e[6]||(e[6]=[t("div",{class:"mb-4 text-6xl"},"ğŸ“ˆ",-1),t("h3",{class:"mb-2 text-lg font-semibold text-gray-900 dark:text-gray-100"},"æš‚æ— è¶‹åŠ¿æ•°æ®",-1),t("p",{class:"text-center text-sm text-gray-600 dark:text-gray-400"}," å½“å‰æ—¶é—´èŒƒå›´å†…æ²¡æœ‰æ‰¾åˆ°æˆæœ¬è¶‹åŠ¿æ•°æ® ",-1)]))):(d(),u("div",Be,[t("div",Le,[t("canvas",{ref_key:"chartCanvas",ref:c},null,512)]),t("div",Re,[t("div",je,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æ€»æˆæœ¬",-1)),t("div",Ee," $"+n(p.value.totalCost.toFixed(6)),1)]),t("div",Ne,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¹³å‡æˆæœ¬",-1)),t("div",Ke," $"+n(p.value.avgCost.toFixed(6)),1)]),t("div",Oe,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"æœ€é«˜æˆæœ¬",-1)),t("div",Ye," $"+n(p.value.maxCost.toFixed(6)),1)]),t("div",ze,[e[10]||(e[10]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"å¢é•¿ç‡",-1)),t("div",{class:D(["mt-1 text-xl font-bold",p.value.growthRate>=0?"text-red-600":"text-green-600"])},n(p.value.growthRate>=0?"+":"")+n(p.value.growthRate.toFixed(1))+"% ",3)])])]))])]))}},E="/admin",K={async getAccountCostProfile(P){return(await F.get(`${E}/accounts/${P}/cost-profile`)).data},async updateCostProfile(P,v){return(await F.put(`${E}/accounts/${P}/cost-profile`,v)).data},async createBill(P,v){return(await F.post(`${E}/accounts/${P}/bills`,v)).data},async listBills(P,v={}){return(await F.get(`${E}/accounts/${P}/bills`,{params:{limit:v.limit||20,offset:v.offset||0}})).data},async inferPricing(P){return(await F.post(`${E}/accounts/${P}/infer-pricing`)).data},async validateCosts(P,v){return(await F.post(`${E}/accounts/${P}/validate-costs`,{billingPeriod:v})).data},async getCostComparison(P,v,f){return(await F.get(`${E}/accounts/${P}/cost-comparison`,{params:{startDate:v,endDate:f}})).data},async importBillsCSV(P,v){return(await F.post(`${E}/accounts/${P}/bills/import`,v,{headers:{"Content-Type":"multipart/form-data"}})).data}},He={class:"modal-content"},Qe={class:"modal-header"},We={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Xe={class:"modal-body"},Ze={class:"mb-6"},Je={class:"mb-6"},ts={key:0,class:"config-section"},es={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ss={key:1,class:"config-section"},as={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},os=["onUpdate:modelValue"],ls=["onUpdate:modelValue"],rs=["onUpdate:modelValue"],ns=["onClick"],is={key:2,class:"config-section"},ds={class:"mb-4"},cs={class:"mb-4"},us={class:"mb-4"},gs={key:3,class:"config-section"},ps={class:"mb-4"},xs={class:"config-section"},ys={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ms={class:"mb-6"},vs={class:"modal-footer"},fs=["disabled"],bs={__name:"CostProfileModal",props:{account:{type:Object,required:!0}},emits:["close","saved"],setup(P,{emit:v}){const f=P,$=v,c=C(!1),a=et({billingType:"standard",confidenceLevel:"low",pointConversion:{pointsPerRequest:1,pointsPerToken:.001,costPerPoint:.01},tieredPricing:[{minTokens:0,maxTokens:1e6,costPerMillion:3}],pricingFormula:{baseTokenCost:3e-6,perRequestFee:.002,weight:.5},relativeEfficiency:1,fixedCosts:{monthly_base:0,api_access_fee:0},notes:""});async function b(){if(!f.account.costProfile)return;const x=f.account.costProfile;a.billingType=x.billingType||"standard",a.confidenceLevel=x.confidenceLevel||"low",a.notes=x.notes||"",x.pointConversion&&(a.pointConversion={...x.pointConversion}),x.tieredPricing&&x.tieredPricing.length>0&&(a.tieredPricing=[...x.tieredPricing]),x.pricingFormula&&(a.pricingFormula={...x.pricingFormula}),x.relativeEfficiency&&(a.relativeEfficiency=x.relativeEfficiency),x.fixedCosts&&(a.fixedCosts={...x.fixedCosts})}function m(){a.tieredPricing.push({minTokens:0,maxTokens:1e6,costPerMillion:3})}function p(x){a.tieredPricing.splice(x,1)}async function T(){var x,s;c.value=!0;try{await K.updateCostProfile(f.account.id,a),$("saved")}catch(e){alert(`ä¿å­˜å¤±è´¥: ${((s=(x=e.response)==null?void 0:x.data)==null?void 0:s.error)||e.message}`)}finally{c.value=!1}}return Y(()=>{b()}),(x,s)=>(d(),u("div",{class:"modal-overlay",onClick:s[14]||(s[14]=G(e=>x.$emit("close"),["self"]))},[t("div",He,[t("div",Qe,[t("h3",We," æˆæœ¬é…ç½® - "+n(P.account.name),1),t("button",{class:"close-btn",onClick:s[0]||(s[0]=e=>x.$emit("close"))},s[15]||(s[15]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Xe,[t("form",{onSubmit:G(T,["prevent"])},[t("div",Ze,[s[17]||(s[17]=t("label",{class:"form-label"},"è®¡ä»·æ¨¡å¼",-1)),w(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>a.billingType=e),class:"form-input"},s[16]||(s[16]=[O('<option value="standard" data-v-1a99438c>æ ‡å‡†å®šä»·ï¼ˆä½¿ç”¨å…¬å¼€ä»·æ ¼è¡¨ï¼‰</option><option value="point_based" data-v-1a99438c>ç§¯åˆ†åˆ¶è®¡è´¹</option><option value="tiered" data-v-1a99438c>é˜¶æ¢¯å®šä»·</option><option value="hybrid" data-v-1a99438c>æ··åˆè®¡è´¹</option><option value="estimated" data-v-1a99438c>ä¼°ç®—æ¨¡å¼</option>',5)]),512),[[L,a.billingType]]),s[18]||(s[18]=t("p",{class:"form-hint"},"é€‰æ‹©è´¦æˆ·çš„è®¡è´¹æ–¹å¼",-1))]),t("div",Je,[s[20]||(s[20]=t("label",{class:"form-label"},"ç½®ä¿¡åº¦çº§åˆ«",-1)),w(t("select",{"onUpdate:modelValue":s[2]||(s[2]=e=>a.confidenceLevel=e),class:"form-input"},s[19]||(s[19]=[O('<option value="high" data-v-1a99438c>é«˜ - å·²éªŒè¯å‡†ç¡®</option><option value="medium-high" data-v-1a99438c>è¾ƒé«˜ - å¤šæ¬¡éªŒè¯</option><option value="medium" data-v-1a99438c>ä¸­ç­‰ - éƒ¨åˆ†éªŒè¯</option><option value="low-medium" data-v-1a99438c>è¾ƒä½ - å°‘é‡éªŒè¯</option><option value="low" data-v-1a99438c>ä½ - æœªéªŒè¯</option>',5)]),512),[[L,a.confidenceLevel]]),s[21]||(s[21]=t("p",{class:"form-hint"},"æŒ‡ç¤ºæˆæœ¬è®¡ç®—çš„å¯ä¿¡ç¨‹åº¦",-1))]),a.billingType==="point_based"?(d(),u("div",ts,[s[25]||(s[25]=t("h4",{class:"section-title"},"ç§¯åˆ†æ¢ç®—é…ç½®",-1)),t("div",es,[t("div",null,[s[22]||(s[22]=t("label",{class:"form-label"},"æ¯è¯·æ±‚ç§¯åˆ†",-1)),w(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>a.pointConversion.pointsPerRequest=e),class:"form-input",placeholder:"1",step:"0.001",type:"number"},null,512),[[V,a.pointConversion.pointsPerRequest,void 0,{number:!0}]])]),t("div",null,[s[23]||(s[23]=t("label",{class:"form-label"},"æ¯Tokenç§¯åˆ†",-1)),w(t("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>a.pointConversion.pointsPerToken=e),class:"form-input",placeholder:"0.001",step:"0.00001",type:"number"},null,512),[[V,a.pointConversion.pointsPerToken,void 0,{number:!0}]])]),t("div",null,[s[24]||(s[24]=t("label",{class:"form-label"},"æ¯ç§¯åˆ†æˆæœ¬ ($)",-1)),w(t("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>a.pointConversion.costPerPoint=e),class:"form-input",placeholder:"0.01",step:"0.0001",type:"number"},null,512),[[V,a.pointConversion.costPerPoint,void 0,{number:!0}]])])])])):U("",!0),a.billingType==="tiered"?(d(),u("div",ss,[s[31]||(s[31]=t("h4",{class:"section-title"},"é˜¶æ¢¯å®šä»·é…ç½®",-1)),(d(!0),u(B,null,R(a.tieredPricing,(e,r)=>(d(),u("div",{key:r,class:"tier-item"},[t("div",as,[t("div",null,[s[26]||(s[26]=t("label",{class:"form-label"},"æœ€å°Token",-1)),w(t("input",{"onUpdate:modelValue":A=>e.minTokens=A,class:"form-input",placeholder:"0",type:"number"},null,8,os),[[V,e.minTokens,void 0,{number:!0}]])]),t("div",null,[s[27]||(s[27]=t("label",{class:"form-label"},"æœ€å¤§Token",-1)),w(t("input",{"onUpdate:modelValue":A=>e.maxTokens=A,class:"form-input",placeholder:"1000000",type:"number"},null,8,ls),[[V,e.maxTokens,void 0,{number:!0}]])]),t("div",null,[s[28]||(s[28]=t("label",{class:"form-label"},"æˆæœ¬/ç™¾ä¸‡Token ($)",-1)),w(t("input",{"onUpdate:modelValue":A=>e.costPerMillion=A,class:"form-input",placeholder:"3.0",step:"0.01",type:"number"},null,8,rs),[[V,e.costPerMillion,void 0,{number:!0}]])])]),a.tieredPricing.length>1?(d(),u("button",{key:0,class:"btn-sm btn-danger mt-2",type:"button",onClick:A=>p(r)},s[29]||(s[29]=[t("i",{class:"fas fa-trash"},null,-1),q(" åˆ é™¤ ",-1)]),8,ns)):U("",!0)]))),128)),t("button",{class:"btn-secondary mt-2",type:"button",onClick:m},s[30]||(s[30]=[t("i",{class:"fas fa-plus"},null,-1),q(" æ·»åŠ é˜¶æ¢¯ ",-1)]))])):U("",!0),a.billingType==="hybrid"?(d(),u("div",is,[s[36]||(s[36]=t("h4",{class:"section-title"},"æ··åˆè®¡è´¹å…¬å¼",-1)),t("div",ds,[s[32]||(s[32]=t("label",{class:"form-label"},"åŸºç¡€Tokenæˆæœ¬ ($)",-1)),w(t("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>a.pricingFormula.baseTokenCost=e),class:"form-input",placeholder:"0.000003",step:"0.000001",type:"number"},null,512),[[V,a.pricingFormula.baseTokenCost,void 0,{number:!0}]])]),t("div",cs,[s[33]||(s[33]=t("label",{class:"form-label"},"æ¯è¯·æ±‚å›ºå®šè´¹ç”¨ ($)",-1)),w(t("input",{"onUpdate:modelValue":s[7]||(s[7]=e=>a.pricingFormula.perRequestFee=e),class:"form-input",placeholder:"0.002",step:"0.0001",type:"number"},null,512),[[V,a.pricingFormula.perRequestFee,void 0,{number:!0}]])]),t("div",us,[s[34]||(s[34]=t("label",{class:"form-label"},"æƒé‡ç³»æ•°",-1)),w(t("input",{"onUpdate:modelValue":s[8]||(s[8]=e=>a.pricingFormula.weight=e),class:"form-input",max:"1",min:"0",placeholder:"0.5",step:"0.1",type:"number"},null,512),[[V,a.pricingFormula.weight,void 0,{number:!0}]]),s[35]||(s[35]=t("p",{class:"form-hint"},"0-1ä¹‹é—´ï¼Œè¡¨ç¤ºTokenæˆæœ¬å’Œè¯·æ±‚è´¹ç”¨çš„æ··åˆæ¯”ä¾‹",-1))])])):U("",!0),a.billingType==="estimated"?(d(),u("div",gs,[s[39]||(s[39]=t("h4",{class:"section-title"},"ä¼°ç®—å‚æ•°",-1)),t("div",ps,[s[37]||(s[37]=t("label",{class:"form-label"},"ç›¸å¯¹æ•ˆç‡ç³»æ•°",-1)),w(t("input",{"onUpdate:modelValue":s[9]||(s[9]=e=>a.relativeEfficiency=e),class:"form-input",placeholder:"1.0",step:"0.1",type:"number"},null,512),[[V,a.relativeEfficiency,void 0,{number:!0}]]),s[38]||(s[38]=t("p",{class:"form-hint"},"ç›¸å¯¹äºæ ‡å‡†ä»·æ ¼çš„å€æ•°ï¼ˆå¦‚0.8è¡¨ç¤ºæ¯”æ ‡å‡†ä¾¿å®œ20%ï¼‰",-1))])])):U("",!0),t("div",xs,[s[42]||(s[42]=t("h4",{class:"section-title"},"å›ºå®šè´¹ç”¨ï¼ˆå¯é€‰ï¼‰",-1)),t("div",ys,[t("div",null,[s[40]||(s[40]=t("label",{class:"form-label"},"æœˆåº¦åŸºç¡€è´¹ç”¨ ($)",-1)),w(t("input",{"onUpdate:modelValue":s[10]||(s[10]=e=>a.fixedCosts.monthly_base=e),class:"form-input",placeholder:"0",step:"0.01",type:"number"},null,512),[[V,a.fixedCosts.monthly_base,void 0,{number:!0}]])]),t("div",null,[s[41]||(s[41]=t("label",{class:"form-label"},"APIè®¿é—®è´¹ ($)",-1)),w(t("input",{"onUpdate:modelValue":s[11]||(s[11]=e=>a.fixedCosts.api_access_fee=e),class:"form-input",placeholder:"0",step:"0.01",type:"number"},null,512),[[V,a.fixedCosts.api_access_fee,void 0,{number:!0}]])])])]),t("div",ms,[s[43]||(s[43]=t("label",{class:"form-label"},"å¤‡æ³¨è¯´æ˜",-1)),w(t("textarea",{"onUpdate:modelValue":s[12]||(s[12]=e=>a.notes=e),class:"form-input",placeholder:"è®°å½•é…ç½®æ¥æºæˆ–ç‰¹æ®Šè¯´æ˜",rows:"3"},null,512),[[V,a.notes]])])],32)]),t("div",vs,[t("button",{class:"btn-secondary",type:"button",onClick:s[13]||(s[13]=e=>x.$emit("close"))},"å–æ¶ˆ"),t("button",{class:"btn-primary",disabled:c.value,type:"button",onClick:T},[t("i",{class:D(["fas fa-save",{"fa-spin":c.value}])},null,2),q(" "+n(c.value?"ä¿å­˜ä¸­...":"ä¿å­˜é…ç½®"),1)],8,fs)])])]))}},ks=H(bs,[["__scopeId","data-v-1a99438c"]]),hs={class:"modal-content"},$s={class:"modal-header"},_s={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Cs={class:"modal-body"},ws={key:0,class:"space-y-6"},Ps={class:"mb-4"},Ss={class:"mb-4"},Ts={class:"mb-4"},As={class:"mb-4"},Fs={class:"mb-4"},Vs={class:"text-center"},Us={key:1,class:"space-y-6"},Ds={key:0,class:"overflow-x-auto"},Is={class:"min-w-full text-xs"},Ms={class:"divide-y divide-gray-200 dark:divide-gray-700"},qs={class:"px-2 py-1"},Bs={class:"px-2 py-1 text-right"},Ls={class:"px-2 py-1"},Rs={class:"px-2 py-1 text-gray-600 dark:text-gray-400"},js={class:"mt-2 text-xs text-gray-500"},Es={class:"text-center"},Ns={class:"modal-footer"},Ks=["disabled"],Os={__name:"BillEntryModal",props:{account:{type:Object,required:!0}},emits:["close","saved"],setup(P,{emit:v}){const f=P,$=v,c=C(!1),a=C(!1),b=C([]),m=et({billingPeriod:"",totalCost:null,currency:"USD",notes:"",attachment:null});function p(s){const e=s.target.files[0];e&&(m.attachment=e)}function T(s){const e=s.target.files[0];if(!e)return;const r=new FileReader;r.onload=A=>{try{const _=A.target.result.split(`
`).filter(o=>o.trim()),l=_[0].split(",").map(o=>o.trim());b.value=_.slice(1).map(o=>{const g=o.split(",").map(M=>M.trim()),h={};return l.forEach((M,y)=>{h[M]=g[y]||""}),h})}catch(I){alert("CSV è§£æå¤±è´¥: "+I.message)}},r.readAsText(e)}async function x(){var s,e;c.value=!0;try{if(a.value){for(const r of b.value)await K.createBill(f.account.id,{billingPeriod:r.billingPeriod,totalCost:parseFloat(r.totalCost),currency:r.currency||"USD",notes:r.notes||""});alert(`æˆåŠŸå½•å…¥ ${b.value.length} æ¡è´¦å•`)}else await K.createBill(f.account.id,{billingPeriod:m.billingPeriod,totalCost:m.totalCost,currency:m.currency,notes:m.notes}),alert("è´¦å•å½•å…¥æˆåŠŸ");$("saved"),$("close")}catch(r){alert(`å½•å…¥å¤±è´¥: ${((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.error)||r.message}`)}finally{c.value=!1}}return(s,e)=>(d(),u("div",{class:"modal-overlay",onClick:e[8]||(e[8]=G(r=>s.$emit("close"),["self"]))},[t("div",hs,[t("div",$s,[t("h3",_s," å½•å…¥è´¦å• - "+n(P.account.name),1),t("button",{class:"close-btn",onClick:e[0]||(e[0]=r=>s.$emit("close"))},e[9]||(e[9]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Cs,[a.value?(d(),u("div",Us,[e[24]||(e[24]=O('<div class="rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20" data-v-93b9649c><h4 class="mb-2 text-sm font-semibold text-blue-900 dark:text-blue-300" data-v-93b9649c><i class="fas fa-info-circle" data-v-93b9649c></i> CSV æ ¼å¼è¯´æ˜ </h4><p class="mb-2 text-xs text-blue-800 dark:text-blue-400" data-v-93b9649c> CSV æ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹åˆ—ï¼ˆç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼‰ï¼š </p><code class="block rounded bg-white p-2 text-xs dark:bg-gray-800 dark:text-gray-300" data-v-93b9649c> billingPeriod,totalCost,currency,notes<br data-v-93b9649c> 2025-01,123.45,USD,ä¸€æœˆè´¦å•<br data-v-93b9649c> 2025-02,145.67,USD,äºŒæœˆè´¦å• </code></div>',1)),t("div",null,[e[20]||(e[20]=t("label",{class:"form-label"},"é€‰æ‹© CSV æ–‡ä»¶",-1)),t("input",{accept:".csv",class:"form-input",type:"file",onChange:T},null,32)]),b.value.length>0?(d(),u("div",Ds,[e[22]||(e[22]=t("h4",{class:"mb-2 text-sm font-semibold text-gray-900 dark:text-gray-100"}," é¢„è§ˆï¼ˆå‰5æ¡ï¼‰ ",-1)),t("table",Is,[e[21]||(e[21]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-2 py-1 text-left"},"è®¡è´¹å‘¨æœŸ"),t("th",{class:"px-2 py-1 text-right"},"é‡‘é¢"),t("th",{class:"px-2 py-1 text-left"},"å¸ç§"),t("th",{class:"px-2 py-1 text-left"},"å¤‡æ³¨")])],-1)),t("tbody",Ms,[(d(!0),u(B,null,R(b.value.slice(0,5),(r,A)=>(d(),u("tr",{key:A},[t("td",qs,n(r.billingPeriod),1),t("td",Bs,"$"+n(r.totalCost),1),t("td",Ls,n(r.currency),1),t("td",Rs,n(r.notes||"-"),1)]))),128))])]),t("p",js,"å…± "+n(b.value.length)+" æ¡è®°å½•",1)])):U("",!0),t("div",Es,[t("button",{class:"text-sm text-indigo-600 hover:text-indigo-700 dark:text-indigo-400",type:"button",onClick:e[6]||(e[6]=r=>a.value=!1)},e[23]||(e[23]=[t("i",{class:"fas fa-arrow-left"},null,-1),q(" è¿”å›å•ä¸ªå½•å…¥ ",-1)]))])])):(d(),u("div",ws,[t("form",{onSubmit:G(x,["prevent"])},[t("div",Ps,[e[10]||(e[10]=t("label",{class:"form-label"},"è®¡è´¹å‘¨æœŸ",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>m.billingPeriod=r),class:"form-input",placeholder:"2025-01",required:"",type:"month"},null,512),[[V,m.billingPeriod]]),e[11]||(e[11]=t("p",{class:"form-hint"},"æ ¼å¼ï¼šYYYY-MMï¼ˆå¦‚ 2025-01ï¼‰",-1))]),t("div",Ss,[e[12]||(e[12]=t("label",{class:"form-label"},"å®é™…è´¦å•é‡‘é¢ ($)",-1)),w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>m.totalCost=r),class:"form-input",placeholder:"123.45",required:"",step:"0.01",type:"number"},null,512),[[V,m.totalCost,void 0,{number:!0}]]),e[13]||(e[13]=t("p",{class:"form-hint"},"ä»è´¦å•ä¸­è·å–çš„å®é™…è´¹ç”¨",-1))]),t("div",Ts,[e[15]||(e[15]=t("label",{class:"form-label"},"å¸ç§",-1)),w(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>m.currency=r),class:"form-input"},e[14]||(e[14]=[t("option",{value:"USD"},"ç¾å…ƒ (USD)",-1),t("option",{value:"CNY"},"äººæ°‘å¸ (CNY)",-1),t("option",{value:"EUR"},"æ¬§å…ƒ (EUR)",-1)]),512),[[L,m.currency]])]),t("div",As,[e[16]||(e[16]=t("label",{class:"form-label"},"è´¦å•å¤‡æ³¨",-1)),w(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>m.notes=r),class:"form-input",placeholder:"è®°å½•è´¦å•æ¥æºã€ç‰¹æ®Šæƒ…å†µç­‰",rows:"3"},null,512),[[V,m.notes]])]),t("div",Fs,[e[17]||(e[17]=t("label",{class:"form-label"},"è´¦å•æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰",-1)),t("input",{accept:".pdf,.png,.jpg,.jpeg",class:"form-input",type:"file",onChange:p},null,32),e[18]||(e[18]=t("p",{class:"form-hint"},"æ”¯æŒPDFã€å›¾ç‰‡æ ¼å¼",-1))])],32),t("div",Vs,[t("button",{class:"text-sm text-indigo-600 hover:text-indigo-700 dark:text-indigo-400",type:"button",onClick:e[5]||(e[5]=r=>a.value=!0)},e[19]||(e[19]=[t("i",{class:"fas fa-upload"},null,-1),q(" åˆ‡æ¢åˆ°æ‰¹é‡å¯¼å…¥ ",-1)]))])]))]),t("div",Ns,[t("button",{class:"btn-secondary",type:"button",onClick:e[7]||(e[7]=r=>s.$emit("close"))},"å–æ¶ˆ"),t("button",{class:"btn-primary",disabled:c.value||a.value&&b.value.length===0,type:"button",onClick:x},[t("i",{class:D(["fas fa-save",{"fa-spin":c.value}])},null,2),q(" "+n(c.value?"æäº¤ä¸­...":a.value?`æ‰¹é‡æäº¤ (${b.value.length})`:"æäº¤è´¦å•"),1)],8,Ks)])])]))}},Ys=H(Os,[["__scopeId","data-v-93b9649c"]]),zs={class:"modal-content-large"},Gs={class:"modal-header"},Hs={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Qs={class:"modal-body"},Ws={class:"mb-6"},Xs={class:"flex gap-3"},Zs=["disabled"],Js={key:0,class:"space-y-6"},ta={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},ea={class:"stat-card"},sa={class:"stat-value text-blue-600 dark:text-blue-400"},aa={class:"stat-card"},oa={class:"stat-value text-green-600 dark:text-green-400"},la={class:"stat-card"},ra={class:"stat-hint"},na={key:0,class:"quality-section"},ia={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},da={class:"quality-metric"},ca={class:"flex items-center justify-between"},ua={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},ga={class:"progress-bar mt-2"},pa={class:"quality-metric"},xa={class:"flex items-center justify-between"},ya={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},ma={class:"progress-bar mt-2"},va={class:"quality-metric"},fa={class:"flex items-center justify-between"},ba={class:"text-sm font-bold text-gray-900 dark:text-gray-100"},ka={class:"progress-bar mt-2"},ha={class:"details-section"},$a={class:"grid grid-cols-1 gap-3 text-sm md:grid-cols-2"},_a={class:"detail-item"},Ca={class:"detail-value"},wa={class:"detail-item"},Pa={class:"detail-value"},Sa={class:"detail-item"},Ta={class:"detail-value"},Aa={class:"detail-item"},Fa={key:1,class:"comparison-section"},Va={class:"mb-4 flex items-center justify-between"},Ua={key:2,class:"suggestions-section"},Da={class:"space-y-2"},Ia={key:1,class:"empty-state"},Ma={class:"modal-footer"},qa={__name:"InferenceValidationPanel",props:{account:{type:Object,required:!0}},emits:["close"],setup(P){const v=P,f=C(!1),$=C(""),c=C(null),a=C(null),b=C(!1),m=C(null);let p=null;async function T(){var _,l;if(!$.value){alert("è¯·é€‰æ‹©éªŒè¯å‘¨æœŸ");return}f.value=!0;try{const o=await K.validateCosts(v.account.id,$.value);if(console.log("Validation result:",o),!o){alert("éªŒè¯å¤±è´¥ï¼šæœªæ”¶åˆ°æœåŠ¡å™¨å“åº”");return}if(o.validated===!1&&o.reason==="database_disabled"){alert(`æˆæœ¬éªŒè¯åŠŸèƒ½éœ€è¦ PostgreSQL æ•°æ®åº“æ”¯æŒã€‚

è¯·åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® POSTGRES_ENABLED=true å¹¶é…ç½®æ•°æ®åº“è¿æ¥å‚æ•°åé‡å¯æœåŠ¡ã€‚`);return}if(o.validated===!1&&o.reason==="no_bill_data"){alert(o.message||`æœªæ‰¾åˆ° ${$.value} çš„è´¦å•æ•°æ®ã€‚

è¯·å…ˆå½•å…¥è¯¥å‘¨æœŸçš„è´¦å•æ•°æ®ã€‚`);return}c.value=o,e(),await x()}catch(o){console.error("Validation error:",o),alert(`éªŒè¯å¤±è´¥: ${((l=(_=o.response)==null?void 0:_.data)==null?void 0:l.error)||o.message}`)}finally{f.value=!1}}async function x(){b.value=!0;try{const _=new Date($.value+"-01"),l=new Date(_);l.setMonth(l.getMonth()-5);const o=await K.getCostComparison(v.account.id,l.toISOString().slice(0,10),_.toISOString().slice(0,10));a.value=o,await lt(),s()}catch(_){console.error("Failed to load comparison:",_)}finally{b.value=!1}}function s(){if(!m.value||!a.value)return;p&&p.dispose(),p=it(m.value);const _={tooltip:{trigger:"axis",backgroundColor:"rgba(0, 0, 0, 0.8)",textStyle:{color:"#fff"}},legend:{data:["è®¡ç®—æˆæœ¬","å®é™…è´¦å•"],textStyle:{color:document.documentElement.classList.contains("dark")?"#9CA3AF":"#4B5563"}},xAxis:{type:"category",data:a.value.periods||[],axisLabel:{color:document.documentElement.classList.contains("dark")?"#9CA3AF":"#6B7280"}},yAxis:{type:"value",name:"æˆæœ¬ ($)",axisLabel:{color:document.documentElement.classList.contains("dark")?"#9CA3AF":"#6B7280"}},series:[{name:"è®¡ç®—æˆæœ¬",type:"line",data:a.value.calculatedCosts||[],smooth:!0,itemStyle:{color:"#3B82F6"}},{name:"å®é™…è´¦å•",type:"line",data:a.value.actualBills||[],smooth:!0,itemStyle:{color:"#10B981"}}]};p.setOption(_)}function e(){var o;if(!c.value)return;const _=[],l=Math.abs(c.value.deviationPercent||0);l>20?_.push("åå·®è¾ƒå¤§ï¼Œå»ºè®®é‡æ–°æ¨å¯¼è®¡ä»·å‚æ•°æˆ–æ£€æŸ¥è´¦å•æ•°æ®å‡†ç¡®æ€§"):l>10?_.push("åå·®é€‚ä¸­ï¼Œå¯è€ƒè™‘å½•å…¥æ›´å¤šè´¦å•æ•°æ®ä»¥æé«˜æ¨å¯¼ç²¾åº¦"):l<5&&_.push("è®¡ç®—ç²¾åº¦ä¼˜ç§€ï¼Œå½“å‰é…ç½®å¯é "),((o=c.value.quality)==null?void 0:o.r_squared)<.8&&_.push("RÂ²ç³»æ•°è¾ƒä½ï¼Œæ¨å¯¼æ¨¡å‹å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼Œå»ºè®®æ‰‹åŠ¨è°ƒæ•´å‚æ•°"),c.value.suggestions=_}function r(_){const l=Math.abs(_||0);return l<5?"text-green-600 dark:text-green-400":l<10?"text-yellow-600 dark:text-yellow-400":l<20?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400"}function A(_){return{high:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300","medium-high":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300","low-medium":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",low:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}[_]||"bg-gray-100 text-gray-800"}function I(_){return{high:"é«˜","medium-high":"è¾ƒé«˜",medium:"ä¸­ç­‰","low-medium":"è¾ƒä½",low:"ä½"}[_]||_}return Y(()=>{const _=new Date;$.value=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}`}),(_,l)=>{var o,g;return d(),u("div",{class:"modal-overlay",onClick:l[3]||(l[3]=G(h=>_.$emit("close"),["self"]))},[t("div",zs,[t("div",Gs,[t("h3",Hs," æˆæœ¬éªŒè¯ - "+n(P.account.name),1),t("button",{class:"close-btn",onClick:l[0]||(l[0]=h=>_.$emit("close"))},l[4]||(l[4]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Qs,[t("div",Ws,[l[5]||(l[5]=t("label",{class:"form-label"},"é€‰æ‹©éªŒè¯å‘¨æœŸ",-1)),t("div",Xs,[w(t("input",{"onUpdate:modelValue":l[1]||(l[1]=h=>$.value=h),class:"form-input flex-1",placeholder:"2025-01",type:"month"},null,512),[[V,$.value]]),t("button",{class:"btn-primary",disabled:f.value,onClick:T},[t("i",{class:D(["fas fa-play",{"fa-spin":f.value}])},null,2),q(" "+n(f.value?"éªŒè¯ä¸­...":"å¼€å§‹éªŒè¯"),1)],8,Zs)])]),c.value?(d(),u("div",Js,[t("div",ta,[t("div",ea,[l[6]||(l[6]=t("div",{class:"stat-label"},"è®¡ç®—æˆæœ¬",-1)),t("div",sa," $"+n(((o=c.value.calculatedCost)==null?void 0:o.toFixed(4))||"0.0000"),1),l[7]||(l[7]=t("div",{class:"stat-hint"},"åŸºäºä½¿ç”¨é‡è®¡ç®—",-1))]),t("div",aa,[l[8]||(l[8]=t("div",{class:"stat-label"},"å®é™…è´¦å•",-1)),t("div",oa," $"+n(((g=c.value.actualBill)==null?void 0:g.toFixed(4))||"0.0000"),1),l[9]||(l[9]=t("div",{class:"stat-hint"},"ä»è´¦å•è®°å½•è·å–",-1))]),t("div",la,[l[10]||(l[10]=t("div",{class:"stat-label"},"åå·®ç‡",-1)),t("div",{class:D(["stat-value",r(c.value.deviationPercent)])},n(Math.abs(c.value.deviationPercent||0).toFixed(2))+"% ",3),t("div",ra,n(c.value.deviationPercent>0?"é«˜ä¼°":"ä½ä¼°"),1)])]),c.value.quality?(d(),u("div",na,[l[14]||(l[14]=t("h4",{class:"mb-4 text-sm font-semibold text-gray-900 dark:text-gray-100"}," æ¨å¯¼è´¨é‡è¯„åˆ† ",-1)),t("div",ia,[t("div",da,[t("div",ca,[l[11]||(l[11]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"æ€»åˆ†",-1)),t("span",ua,n((c.value.quality.score*100).toFixed(1))+"% ",1)]),t("div",ga,[t("div",{class:"progress-fill bg-green-500",style:Z({width:c.value.quality.score*100+"%"})},null,4)])]),t("div",pa,[t("div",xa,[l[12]||(l[12]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"RÂ² å†³å®šç³»æ•°",-1)),t("span",ya,n((c.value.quality.r_squared*100).toFixed(1))+"% ",1)]),t("div",ma,[t("div",{class:"progress-fill bg-blue-500",style:Z({width:c.value.quality.r_squared*100+"%"})},null,4)])]),t("div",va,[t("div",fa,[l[13]||(l[13]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},"å¹³å‡ç»å¯¹è¯¯å·®",-1)),t("span",ba,n((c.value.quality.mean_absolute_error*100).toFixed(2))+"% ",1)]),t("div",ka,[t("div",{class:"progress-fill bg-yellow-500",style:Z({width:(1-c.value.quality.mean_absolute_error)*100+"%"})},null,4)])])])])):U("",!0),t("div",ha,[l[19]||(l[19]=t("h4",{class:"mb-3 text-sm font-semibold text-gray-900 dark:text-gray-100"},"éªŒè¯è¯¦æƒ…",-1)),t("div",$a,[t("div",_a,[l[15]||(l[15]=t("span",{class:"detail-label"},"è®¡è´¹å‘¨æœŸ:",-1)),t("span",Ca,n(c.value.billingPeriod),1)]),t("div",wa,[l[16]||(l[16]=t("span",{class:"detail-label"},"è®¡ç®—æ–¹æ³•:",-1)),t("span",Pa,n(c.value.calculationMethod),1)]),t("div",Sa,[l[17]||(l[17]=t("span",{class:"detail-label"},"æ•°æ®æ¥æº:",-1)),t("span",Ta,n(c.value.costSource),1)]),t("div",Aa,[l[18]||(l[18]=t("span",{class:"detail-label"},"ç½®ä¿¡åº¦:",-1)),t("span",{class:D(["inline-flex rounded-full px-2 py-0.5 text-xs font-semibold",A(c.value.confidenceLevel)])},n(I(c.value.confidenceLevel)),3)])])]),a.value?(d(),u("div",Fa,[t("div",Va,[l[21]||(l[21]=t("h4",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"æˆæœ¬å¯¹æ¯”è¶‹åŠ¿",-1)),t("button",{class:"btn-sm btn-secondary",onClick:x},[t("i",{class:D(["fas fa-sync-alt",{"fa-spin":b.value}])},null,2),l[20]||(l[20]=q(" åˆ·æ–° ",-1))])]),t("div",{ref_key:"chartContainer",ref:m,class:"chart-container"},null,512)])):U("",!0),c.value.suggestions?(d(),u("div",Ua,[l[23]||(l[23]=t("h4",{class:"mb-3 text-sm font-semibold text-gray-900 dark:text-gray-100"},[t("i",{class:"fas fa-lightbulb text-yellow-500"}),q(" ä¼˜åŒ–å»ºè®® ")],-1)),t("ul",Da,[(d(!0),u(B,null,R(c.value.suggestions,(h,M)=>(d(),u("li",{key:M,class:"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400"},[l[22]||(l[22]=t("i",{class:"fas fa-check-circle mt-0.5 text-green-500"},null,-1)),t("span",null,n(h),1)]))),128))])])):U("",!0)])):(d(),u("div",Ia,l[24]||(l[24]=[t("i",{class:"fas fa-chart-line mb-3 text-4xl text-gray-300 dark:text-gray-600"},null,-1),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},' é€‰æ‹©è®¡è´¹å‘¨æœŸå¹¶ç‚¹å‡»"å¼€å§‹éªŒè¯"ä»¥æŸ¥çœ‹ç»“æœ ',-1)])))]),t("div",Ma,[t("button",{class:"btn-secondary",type:"button",onClick:l[2]||(l[2]=h=>_.$emit("close"))},"å…³é—­")])])])}}},Ba=H(qa,[["__scopeId","data-v-55a1ec88"]]),La={class:"cost-tracking-management"},Ra={class:"card p-6"},ja={class:"mb-6 flex items-center justify-between"},Ea={class:"flex gap-3"},Na=["disabled"],Ka={key:0,class:"flex h-64 items-center justify-center"},Oa={key:1,class:"overflow-x-auto"},Ya={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},za={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Ga={class:"px-4 py-3"},Ha={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Qa={class:"text-xs text-gray-500 dark:text-gray-400"},Wa={class:"px-4 py-3"},Xa={class:"px-4 py-3"},Za={class:"text-sm text-gray-900 dark:text-gray-100"},Ja={class:"px-4 py-3"},to={key:1,class:"text-xs text-gray-400"},eo={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},so={class:"px-4 py-3 text-right"},ao={class:"flex justify-end gap-2"},oo=["onClick"],lo=["onClick"],ro=["disabled","onClick"],no=["onClick"],io={key:0,class:"py-12 text-center"},co={__name:"CostTrackingManagement",setup(P){const v=C(!1),f=C([]),$=C({platform:"all"}),c=C(null),a=C(!1),b=C(!1),m=C(!1),p=C(null),T=W(()=>$.value.platform==="all"?f.value:f.value.filter(y=>y.platform===$.value.platform));async function x(){v.value=!0;try{let y=[];try{const i=await F.get("/admin/claude-accounts");i.success&&i.data&&y.push(...i.data.map(S=>({...S,platform:S.platform||"claude"})))}catch(i){console.warn("Failed to load Claude accounts:",i.message)}try{const i=await F.get("/admin/claude-console-accounts");i.success&&i.data&&y.push(...i.data.map(S=>({...S,platform:S.platform||"claude-console"})))}catch(i){console.warn("Failed to load Claude Console accounts:",i.message)}try{const i=await F.get("/admin/gemini-accounts");i.success&&i.data&&y.push(...i.data.map(S=>({...S,platform:S.platform||"gemini"})))}catch(i){console.warn("Failed to load Gemini accounts:",i.message)}try{const i=await F.get("/admin/openai-accounts");i.success&&i.data&&y.push(...i.data.map(S=>({...S,platform:S.platform||"openai"})))}catch(i){console.warn("Failed to load OpenAI accounts:",i.message)}try{const i=await F.get("/admin/openai-responses-accounts");i.success&&i.data&&y.push(...i.data.map(S=>({...S,platform:S.platform||"openai-responses"})))}catch(i){console.warn("Failed to load OpenAI Responses accounts:",i.message)}if(console.log("All accounts:",y),y.length===0){f.value=[],v.value=!1;return}const k=await Promise.all(y.map(async i=>{try{const S=await K.getAccountCostProfile(i.id);return{...i,costProfile:(S==null?void 0:S.profile)||null}}catch(S){return console.log(`No cost profile for account ${i.id}:`,S.message),{...i,costProfile:null}}}));f.value=k,console.log("Accounts with profiles:",k)}catch(y){console.error("Unexpected error loading accounts:",y)}finally{v.value=!1}}function s(y){c.value=y,a.value=!0}function e(y){c.value=y,b.value=!0}function r(y){c.value=y,m.value=!0}async function A(y){var k,i,S,z;if(confirm(`ç¡®å®šè¦ä¸ºè´¦æˆ· "${y.name}" æ¨å¯¼è®¡ä»·å‚æ•°å—ï¼Ÿè¿™å°†åŸºäºå†å²è´¦å•æ•°æ®è¿›è¡Œåˆ†æã€‚`)){p.value=y.id;try{const j=await K.inferPricing(y.id);alert(`æ¨å¯¼æˆåŠŸï¼
è´¨é‡åˆ†æ•°: ${(((k=j.quality)==null?void 0:k.score)*100||0).toFixed(1)}%
RÂ²: ${(((i=j.quality)==null?void 0:i.r_squared)*100||0).toFixed(1)}%`),await x()}catch(j){alert(`æ¨å¯¼å¤±è´¥: ${((z=(S=j.response)==null?void 0:S.data)==null?void 0:z.error)||j.message}`)}finally{p.value=null}}}function I(){a.value=!1,x()}function _(){b.value=!1}function l(y){return{claude:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300","claude-console":"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-300",gemini:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",openai:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}[y]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}function o(y){return{high:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300","medium-high":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300","low-medium":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",low:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}[y]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}function g(y){return{high:"é«˜","medium-high":"è¾ƒé«˜",medium:"ä¸­ç­‰","low-medium":"è¾ƒä½",low:"ä½"}[y]||y}function h(y){return{standard:"æ ‡å‡†å®šä»·",point_based:"ç§¯åˆ†åˆ¶",tiered:"é˜¶æ¢¯å®šä»·",hybrid:"æ··åˆè®¡è´¹",estimated:"ä¼°ç®—æ¨¡å¼"}[y]||"æœªé…ç½®"}function M(y){return y?new Date(y).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"-"}return Y(()=>{x()}),(y,k)=>(d(),u("div",La,[t("div",Ra,[t("div",ja,[k[6]||(k[6]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"æˆæœ¬é…ç½®ä¸éªŒè¯"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," ç®¡ç†è´¦æˆ·è®¡ä»·æ¨¡å¼ã€å½•å…¥è´¦å•ã€æ¨å¯¼å‚æ•°å’ŒéªŒè¯æˆæœ¬å‡†ç¡®æ€§ ")],-1)),t("div",Ea,[w(t("select",{"onUpdate:modelValue":k[0]||(k[0]=i=>$.value.platform=i),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",onChange:x},k[4]||(k[4]=[O('<option value="all" data-v-6e67f7b6>å…¨éƒ¨å¹³å°</option><option value="claude" data-v-6e67f7b6>Claude</option><option value="claude-console" data-v-6e67f7b6>Console</option><option value="gemini" data-v-6e67f7b6>Gemini</option><option value="openai" data-v-6e67f7b6>OpenAI</option><option value="openai-responses" data-v-6e67f7b6>OpenAI Responses</option>',6)]),544),[[L,$.value.platform]]),t("button",{class:"btn-primary flex items-center gap-2",disabled:v.value,onClick:x},[t("i",{class:D(["fas fa-sync-alt",{"fa-spin":v.value}])},null,2),k[5]||(k[5]=q(" åˆ·æ–° ",-1))],8,Na)])]),v.value?(d(),u("div",Ka,k[7]||(k[7]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):(d(),u("div",Oa,[t("table",Ya,[k[11]||(k[11]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è´¦æˆ· "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," å¹³å° "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," è®¡ä»·æ¨¡å¼ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," ç½®ä¿¡åº¦ "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æœ€åéªŒè¯ "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," æ“ä½œ ")])],-1)),t("tbody",za,[(d(!0),u(B,null,R(T.value,i=>{var S,z,j;return d(),u("tr",{key:i.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Ga,[t("div",Ha,n(i.name),1),t("div",Qa,n(i.id),1)]),t("td",Wa,[t("span",{class:D(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",l(i.platform)])},n(i.platform),3)]),t("td",Xa,[t("span",Za,n(h((S=i.costProfile)==null?void 0:S.billingType)),1)]),t("td",Ja,[(z=i.costProfile)!=null&&z.confidenceLevel?(d(),u("span",{key:0,class:D(["inline-flex rounded-full px-2 py-1 text-xs font-semibold",o(i.costProfile.confidenceLevel)])},n(g(i.costProfile.confidenceLevel)),3)):(d(),u("span",to,"-"))]),t("td",eo,n((j=i.costProfile)!=null&&j.lastValidatedAt?M(i.costProfile.lastValidatedAt):"-"),1),t("td",so,[t("div",ao,[t("button",{class:"btn-sm btn-secondary",title:"é…ç½®æˆæœ¬",onClick:X=>s(i)},k[8]||(k[8]=[t("i",{class:"fas fa-cog"},null,-1)]),8,oo),t("button",{class:"btn-sm btn-secondary",title:"å½•å…¥è´¦å•",onClick:X=>e(i)},k[9]||(k[9]=[t("i",{class:"fas fa-file-invoice-dollar"},null,-1)]),8,lo),t("button",{class:"btn-sm btn-secondary",disabled:p.value===i.id,title:"æ¨å¯¼å‚æ•°",onClick:X=>A(i)},[t("i",{class:D(["fas fa-robot",{"fa-spin":p.value===i.id}])},null,2)],8,ro),t("button",{class:"btn-sm btn-primary",title:"éªŒè¯æˆæœ¬",onClick:X=>r(i)},k[10]||(k[10]=[t("i",{class:"fas fa-check-circle"},null,-1)]),8,no)])])])}),128))])]),T.value.length===0?(d(),u("div",io,k[12]||(k[12]=[t("i",{class:"fas fa-inbox mb-3 text-4xl text-gray-300 dark:text-gray-600"},null,-1),t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"æš‚æ— è´¦æˆ·æ•°æ®",-1)]))):U("",!0)]))]),a.value?(d(),J(ks,{key:0,account:c.value,onClose:k[1]||(k[1]=i=>a.value=!1),onSaved:I},null,8,["account"])):U("",!0),b.value?(d(),J(Ys,{key:1,account:c.value,onClose:k[2]||(k[2]=i=>b.value=!1),onSaved:_},null,8,["account"])):U("",!0),m.value?(d(),J(Ba,{key:2,account:c.value,onClose:k[3]||(k[3]=i=>m.value=!1)},null,8,["account"])):U("",!0)]))}},uo=H(co,[["__scopeId","data-v-6e67f7b6"]]),go={class:"analytics-container"},po={class:"mb-6"},xo={class:"border-b border-gray-200 dark:border-gray-700"},yo={"aria-label":"Tabs",class:"-mb-px flex space-x-8"},mo=["onClick"],vo={class:"tab-content"},fo={class:"space-y-6"},bo={class:"space-y-6"},ko={class:"space-y-6"},ho={key:0,class:"space-y-6"},$o={__name:"AnalyticsView",setup(P){const v=C("cost-efficiency"),f=[{id:"cost-efficiency",name:"è´¦æˆ·æ€§ä»·æ¯”å¯¹æ¯”",icon:"fas fa-chart-line"},{id:"api-key-breakdown",name:"API Key è°ƒç”¨æ˜ç»†",icon:"fas fa-key"},{id:"cost-trends",name:"æˆæœ¬è¶‹åŠ¿åˆ†æ",icon:"fas fa-chart-area"},{id:"cost-tracking",name:"æˆæœ¬é…ç½®ä¸éªŒè¯",icon:"fas fa-cog"}];return($,c)=>(d(),u("div",go,[c[0]||(c[0]=t("div",{class:"mb-6"},[t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"ç»Ÿè®¡åˆ†æ"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," æ·±åº¦åˆ†æè´¦æˆ·æ€§ä»·æ¯”ã€API Key ä½¿ç”¨æƒ…å†µå’Œæˆæœ¬è¶‹åŠ¿ ")],-1)),t("div",po,[t("div",xo,[t("nav",yo,[(d(),u(B,null,R(f,a=>t("button",{key:a.id,class:D([v.value===a.id?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300","group inline-flex items-center border-b-2 px-1 py-4 text-sm font-medium transition-colors"]),onClick:b=>v.value=a.id},[t("i",{class:D([a.icon,"mr-2"])},null,2),q(" "+n(a.name),1)],10,mo)),64))])])]),t("div",vo,[w(t("div",fo,[Q(It)],512),[[tt,v.value==="cost-efficiency"]]),w(t("div",bo,[Q(Fe)],512),[[tt,v.value==="api-key-breakdown"]]),w(t("div",ko,[Q(Ge)],512),[[tt,v.value==="cost-trends"]]),v.value==="cost-tracking"?(d(),u("div",ho,[Q(uo)])):U("",!0)])]))}},To=H($o,[["__scopeId","data-v-df873dca"]]);export{To as default};
