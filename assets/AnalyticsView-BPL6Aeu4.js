import{r as p,q as I,x as n,y as g,z as t,K as f,aV as b,aT as M,P as r,Q as h,ac as $,C as w,c as K,aX as j,o as D,V as U,S,R,O as q}from"./vue-vendor-Bsazo-x0.js";import{c as _,s as C,a as B,_ as z}from"./index--JXgyoXt.js";import{C as E}from"./chart-yFHxLHpB.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const O={class:"cost-efficiency-analysis"},G={class:"card p-6"},H={class:"mb-6 flex items-center justify-between"},L={class:"flex gap-3"},Q={key:0,class:"flex h-64 items-center justify-center"},X={key:1},Y={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},Z={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},J={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},W={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},tt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},et={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},at={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},st={class:"overflow-x-auto"},rt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ot={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},dt={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},lt={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},it={class:"rounded-full bg-blue-100 px-2 py-1 text-xs dark:bg-blue-900/30"},nt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},gt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},xt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},ct={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},yt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},ut={__name:"CostEfficiencyAnalysis",setup(A){const c=p(!1),x=p({range:"30d",platform:"all"}),y=p({}),m=p([]),d=l=>l>=1e6?(l/1e6).toFixed(2)+"M":l>=1e3?(l/1e3).toFixed(2)+"K":(l==null?void 0:l.toString())||"0",v=async()=>{var l;c.value=!0;try{const s={...x.value},[o,k]=await Promise.all([_.get("/admin/dashboard/cost-efficiency/summary",{params:s}),_.get("/admin/dashboard/cost-efficiency/accounts",{params:{...s,limit:50}})]);o.success&&(y.value=o.data||{}),k.success&&(m.value=((l=k.data)==null?void 0:l.items)||[])}catch{C("加载性价比数据失败","error")}finally{c.value=!1}};return I(()=>{v()}),(l,s)=>(g(),n("div",O,[t("div",G,[t("div",H,[s[4]||(s[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"账户性价比对比"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 对比不同账户的成本效率和使用情况 ")],-1)),t("div",L,[f(t("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>x.value.range=o),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:v},s[2]||(s[2]=[t("option",{value:"today"},"今日",-1),t("option",{value:"7days"},"7天",-1),t("option",{value:"30d"},"30天",-1),t("option",{value:"total"},"全部",-1)]),544),[[b,x.value.range]]),f(t("select",{"onUpdate:modelValue":s[1]||(s[1]=o=>x.value.platform=o),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:v},s[3]||(s[3]=[M('<option value="all">全部平台</option><option value="claude">Claude</option><option value="claude-console">Console</option><option value="gemini">Gemini</option><option value="openai">OpenAI</option>',5)]),544),[[b,x.value.platform]])])]),c.value?(g(),n("div",Q,s[5]||(s[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):(g(),n("div",X,[t("div",Y,[t("div",Z,[s[6]||(s[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总账户数",-1)),t("div",J,r(y.value.totalAccounts||0),1)]),t("div",W,[s[7]||(s[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"平均成本/百万Token",-1)),t("div",tt," $"+r((y.value.avgCostPerMillion||0).toFixed(2)),1)]),t("div",et,[s[8]||(s[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"平均成功率",-1)),t("div",at,r(((y.value.avgSuccessRate||0)*100).toFixed(1))+"% ",1)])]),t("div",st,[t("table",rt,[s[9]||(s[9]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 账户 "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 平台 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 请求数 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总成本 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 成本/百万Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 成功率 ")])],-1)),t("tbody",ot,[(g(!0),n(h,null,$(m.value,o=>(g(),n("tr",{key:o.accountId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",dt,r(o.accountName),1),t("td",lt,[t("span",it,r(o.platform),1)]),t("td",nt,r(d(o.totalRequests)),1),t("td",gt,r(d(o.totalTokens)),1),t("td",xt," $"+r((o.totalCost||0).toFixed(6)),1),t("td",ct," $"+r((o.costPerMillion||0).toFixed(2)),1),t("td",yt,[t("span",{class:w(["rounded-full px-2 py-1 text-xs",o.successRate>=.95?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":o.successRate>=.8?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"])},r(((o.successRate||0)*100).toFixed(1))+"% ",3)])]))),128))])])])]))])]))}},pt={class:"api-key-breakdown-analysis"},mt={class:"card p-6"},vt={class:"mb-6 flex items-center justify-between"},ft={class:"flex gap-3"},kt=["value"],bt={key:0,class:"flex h-64 items-center justify-center"},_t={key:1,class:"flex h-64 flex-col items-center justify-center text-gray-500"},ht={key:2},$t={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},wt={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Ct={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},At={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Tt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Ft={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},St={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Rt={class:"overflow-x-auto"},Kt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},It={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Vt={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},Pt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Nt={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},Mt={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},jt={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Dt={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Ut={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},qt={key:3,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Bt={__name:"ApiKeyBreakdownAnalysis",setup(A){const c=p(!1),x=p([]),y=p(""),m=p({range:"30d"}),d=p([]),v=K(()=>d.value.reduce((e,a)=>e+(a.requests||0),0)),l=K(()=>d.value.reduce((e,a)=>e+(a.totalCost||0),0)),s=e=>e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(2)+"K":(e==null?void 0:e.toString())||"0",o=e=>{if(!e)return"-";const a=new Date(e);return Number.isNaN(a.getTime())?e:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},k=async()=>{try{const e=await _.get("/admin/accounts/usage-stats",{params:{range:"total"}});e.success&&(x.value=e.data||[])}catch{C("加载账户列表失败","error")}},u=async()=>{if(!y.value){d.value=[];return}c.value=!0;try{const e=await _.get(`/admin/accounts/${y.value}/usage-breakdown`,{params:{...m.value,limit:100}});e.success&&(d.value=e.items||[])}catch{C("加载 API Key 明细失败","error")}finally{c.value=!1}};return I(()=>{k()}),(e,a)=>(g(),n("div",pt,[t("div",mt,[t("div",vt,[a[4]||(a[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"API Key 调用明细"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 查看每个 API Key 的详细调用统计 ")],-1)),t("div",ft,[f(t("select",{"onUpdate:modelValue":a[0]||(a[0]=i=>y.value=i),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:u},[a[2]||(a[2]=t("option",{value:""},"选择账户",-1)),(g(!0),n(h,null,$(x.value,i=>(g(),n("option",{key:i.id,value:i.id},r(i.name)+" ("+r(i.platform)+") ",9,kt))),128))],544),[[b,y.value]]),f(t("select",{"onUpdate:modelValue":a[1]||(a[1]=i=>m.value.range=i),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:u},a[3]||(a[3]=[t("option",{value:"today"},"今日",-1),t("option",{value:"7days"},"7天",-1),t("option",{value:"30d"},"30天",-1),t("option",{value:"total"},"全部",-1)]),544),[[b,m.value.range]])])]),c.value?(g(),n("div",bt,a[5]||(a[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):y.value?d.value.length>0?(g(),n("div",ht,[t("div",$t,[t("div",wt,[a[7]||(a[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"API Key 总数",-1)),t("div",Ct,r(d.value.length),1)]),t("div",At,[a[8]||(a[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总请求数",-1)),t("div",Tt,r(s(v.value)),1)]),t("div",Ft,[a[9]||(a[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总成本",-1)),t("div",St," $"+r(l.value.toFixed(6)),1)])]),t("div",Rt,[t("table",Kt,[a[10]||(a[10]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," API Key "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 请求数 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 输入Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 输出Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总成本 "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 最后使用 ")])],-1)),t("tbody",It,[(g(!0),n(h,null,$(d.value,i=>(g(),n("tr",{key:i.apiKeyId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Vt,r(i.apiKeyName),1),t("td",Pt,r(s(i.requests)),1),t("td",Nt,r(s(i.inputTokens)),1),t("td",Mt,r(s(i.outputTokens)),1),t("td",jt,r(s(i.totalTokens)),1),t("td",Dt," $"+r((i.totalCost||0).toFixed(6)),1),t("td",Ut,r(o(i.lastUsedAt)),1)]))),128))])])])])):(g(),n("div",qt,a[11]||(a[11]=[t("i",{class:"fas fa-inbox mb-4 text-4xl"},null,-1),t("p",null,"该账户暂无 API Key 调用数据",-1)]))):(g(),n("div",_t,a[6]||(a[6]=[t("i",{class:"fas fa-key mb-4 text-4xl"},null,-1),t("p",null,"请选择一个账户查看 API Key 调用明细",-1)])))])]))}},zt={class:"cost-trends-analysis"},Et={class:"card p-6"},Ot={class:"mb-6 flex items-center justify-between"},Gt={class:"flex gap-3"},Ht={key:0,class:"flex h-64 items-center justify-center"},Lt={key:1},Qt={class:"mb-6 h-80"},Xt={class:"grid grid-cols-1 gap-4 md:grid-cols-4"},Yt={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Zt={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},Jt={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Wt={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},te={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},ee={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},ae={class:"rounded-lg bg-gradient-to-br from-orange-50 to-red-50 p-4 dark:from-orange-900/20 dark:to-red-900/20"},se={__name:"CostTrendsAnalysis",setup(A){const c=B(),{isDarkMode:x}=j(c),y=p(!1),m=p(null);let d=null;const v=p({range:"30d",interval:"daily"}),l=p([]),s=K(()=>{if(l.value.length===0)return{totalCost:0,avgCost:0,maxCost:0,growthRate:0};const u=l.value.map(F=>F.cost||0),e=u.reduce((F,N)=>F+N,0),a=e/u.length,i=Math.max(...u),T=u[0]||0,V=u[u.length-1]||0,P=T>0?(V-T)/T*100:0;return{totalCost:e,avgCost:a,maxCost:i,growthRate:P}}),o=async()=>{var u;y.value=!0;try{const e=await _.get("/admin/dashboard/cost-efficiency/trends",{params:v.value});e.success&&(l.value=((u=e.data)==null?void 0:u.data)||[],k())}catch{C("加载趋势数据失败","error")}finally{y.value=!1}},k=()=>{if(!m.value||l.value.length===0)return;d&&d.destroy();const u=l.value.map(a=>a.date||a.label),e=l.value.map(a=>a.cost||0);d=new E(m.value,{type:"line",data:{labels:u,datasets:[{label:"成本",data:e,borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:a=>`成本: $${a.parsed.y.toFixed(6)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>`$${a.toFixed(6)}`,color:x.value?"#9ca3af":"#6b7280"},grid:{color:x.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}},x:{ticks:{color:x.value?"#9ca3af":"#6b7280"},grid:{color:x.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}}}}})};return D(x,()=>{k()}),I(()=>{o()}),U(()=>{d&&d.destroy()}),(u,e)=>(g(),n("div",zt,[t("div",Et,[t("div",Ot,[e[4]||(e[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"成本趋势分析"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},"查看成本变化趋势和预测")],-1)),t("div",Gt,[f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>v.value.range=a),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:o},e[2]||(e[2]=[t("option",{value:"7days"},"7天",-1),t("option",{value:"30d"},"30天",-1),t("option",{value:"90d"},"90天",-1)]),544),[[b,v.value.range]]),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>v.value.interval=a),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:o},e[3]||(e[3]=[t("option",{value:"hourly"},"按小时",-1),t("option",{value:"daily"},"按天",-1),t("option",{value:"weekly"},"按周",-1)]),544),[[b,v.value.interval]])])]),y.value?(g(),n("div",Ht,e[5]||(e[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):(g(),n("div",Lt,[t("div",Qt,[t("canvas",{ref_key:"chartCanvas",ref:m},null,512)]),t("div",Xt,[t("div",Yt,[e[6]||(e[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总成本",-1)),t("div",Zt," $"+r(s.value.totalCost.toFixed(6)),1)]),t("div",Jt,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"平均成本",-1)),t("div",Wt," $"+r(s.value.avgCost.toFixed(6)),1)]),t("div",te,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"最高成本",-1)),t("div",ee," $"+r(s.value.maxCost.toFixed(6)),1)]),t("div",ae,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"增长率",-1)),t("div",{class:w(["mt-1 text-xl font-bold",s.value.growthRate>=0?"text-red-600":"text-green-600"])},r(s.value.growthRate>=0?"+":"")+r(s.value.growthRate.toFixed(1))+"% ",3)])])]))])]))}},re={class:"analytics-container"},oe={class:"mb-6"},de={class:"border-b border-gray-200 dark:border-gray-700"},le={"aria-label":"Tabs",class:"-mb-px flex space-x-8"},ie=["onClick"],ne={class:"tab-content"},ge={class:"space-y-6"},xe={class:"space-y-6"},ce={class:"space-y-6"},ye={__name:"AnalyticsView",setup(A){const c=p("cost-efficiency"),x=[{id:"cost-efficiency",name:"账户性价比对比",icon:"fas fa-chart-line"},{id:"api-key-breakdown",name:"API Key 调用明细",icon:"fas fa-key"},{id:"cost-trends",name:"成本趋势分析",icon:"fas fa-chart-area"}];return(y,m)=>(g(),n("div",re,[m[0]||(m[0]=t("div",{class:"mb-6"},[t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"统计分析"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 深度分析账户性价比、API Key 使用情况和成本趋势 ")],-1)),t("div",oe,[t("div",de,[t("nav",le,[(g(),n(h,null,$(x,d=>t("button",{key:d.id,class:w([c.value===d.id?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300","group inline-flex items-center border-b-2 px-1 py-4 text-sm font-medium transition-colors"]),onClick:v=>c.value=d.id},[t("i",{class:w([d.icon,"mr-2"])},null,2),q(" "+r(d.name),1)],10,ie)),64))])])]),t("div",ne,[f(t("div",ge,[R(ut)],512),[[S,c.value==="cost-efficiency"]]),f(t("div",xe,[R(Bt)],512),[[S,c.value==="api-key-breakdown"]]),f(t("div",ce,[R(se)],512),[[S,c.value==="cost-trends"]])])]))}},ke=z(ye,[["__scopeId","data-v-52f8346e"]]);export{ke as default};
