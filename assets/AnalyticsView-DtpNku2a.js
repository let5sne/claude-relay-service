import{r as u,q as I,x as i,y as n,z as t,K as k,aV as b,aT as M,P as r,Q as h,ac as $,C as w,c as K,aX as j,o as D,V as U,S,R,O as q}from"./vue-vendor-Bsazo-x0.js";import{c as _,s as C,a as B,_ as z}from"./index-B6UWfYyl.js";import{C as E}from"./chart-yFHxLHpB.js";import"./element-plus-CqiD73Lu.js";import"./vendor-Dr8jvgFu.js";const O={class:"cost-efficiency-analysis"},G={class:"card p-6"},H={class:"mb-6 flex items-center justify-between"},L={class:"flex gap-3"},Q={key:0,class:"flex h-64 items-center justify-center"},X={key:1},Y={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},Z={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},J={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},W={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},tt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},et={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},at={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},st={class:"overflow-x-auto"},rt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ot={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},dt={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},lt={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},it={class:"rounded-full bg-blue-100 px-2 py-1 text-xs dark:bg-blue-900/30"},nt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},gt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},xt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},ct={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},yt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},ut={__name:"CostEfficiencyAnalysis",setup(A){const c=u(!1),x=u({range:"30d",platform:"all"}),y=u({}),p=u([]),o=d=>d>=1e6?(d/1e6).toFixed(2)+"M":d>=1e3?(d/1e3).toFixed(2)+"K":(d==null?void 0:d.toString())||"0",m=async()=>{var d;c.value=!0;try{const s={...x.value},[v,f]=await Promise.all([_.get("/admin/dashboard/cost-efficiency/summary",{params:s}),_.get("/admin/dashboard/cost-efficiency/accounts",{params:{...s,limit:50}})]);v.success&&(y.value=v.data||{}),f.success&&(p.value=((d=f.data)==null?void 0:d.items)||[])}catch{C("加载性价比数据失败","error")}finally{c.value=!1}};return I(()=>{m()}),(d,s)=>{var v,f,g;return n(),i("div",O,[t("div",G,[t("div",H,[s[4]||(s[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"账户性价比对比"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 对比不同账户的成本效率和使用情况 ")],-1)),t("div",L,[k(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>x.value.range=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:m},s[2]||(s[2]=[t("option",{value:"today"},"今日",-1),t("option",{value:"7days"},"7天",-1),t("option",{value:"30d"},"30天",-1),t("option",{value:"total"},"全部",-1)]),544),[[b,x.value.range]]),k(t("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>x.value.platform=e),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:m},s[3]||(s[3]=[M('<option value="all">全部平台</option><option value="claude">Claude</option><option value="claude-console">Console</option><option value="gemini">Gemini</option><option value="openai">OpenAI</option>',5)]),544),[[b,x.value.platform]])])]),c.value?(n(),i("div",Q,s[5]||(s[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):(n(),i("div",X,[t("div",Y,[t("div",Z,[s[6]||(s[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总账户数",-1)),t("div",J,r(((v=y.value.totals)==null?void 0:v.accountCount)||0),1)]),t("div",W,[s[7]||(s[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"平均成本/百万Token",-1)),t("div",tt," $"+r((((f=y.value.totals)==null?void 0:f.costPerMillion)||0).toFixed(2)),1)]),t("div",et,[s[8]||(s[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"平均成功率",-1)),t("div",at,r(((((g=y.value.totals)==null?void 0:g.successRate)||0)*100).toFixed(1))+"% ",1)])]),t("div",st,[t("table",rt,[s[9]||(s[9]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 账户 "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 平台 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 请求数 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总成本 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 成本/百万Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 成功率 ")])],-1)),t("tbody",ot,[(n(!0),i(h,null,$(p.value,e=>(n(),i("tr",{key:e.accountId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",dt,r(e.accountName),1),t("td",lt,[t("span",it,r(e.platform),1)]),t("td",nt,r(o(e.totalRequests)),1),t("td",gt,r(o(e.totalTokens)),1),t("td",xt," $"+r((e.totalCost||0).toFixed(6)),1),t("td",ct," $"+r((e.costPerMillion||0).toFixed(2)),1),t("td",yt,[t("span",{class:w(["rounded-full px-2 py-1 text-xs",e.successRate>=.95?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":e.successRate>=.8?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"])},r(((e.successRate||0)*100).toFixed(1))+"% ",3)])]))),128))])])])]))])])}}},pt={class:"api-key-breakdown-analysis"},mt={class:"card p-6"},vt={class:"mb-6 flex items-center justify-between"},ft={class:"flex gap-3"},kt=["value"],bt={key:0,class:"flex h-64 items-center justify-center"},_t={key:1,class:"flex h-64 flex-col items-center justify-center text-gray-500"},ht={key:2},$t={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-3"},wt={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Ct={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},At={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Tt={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Ft={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},St={class:"mt-1 text-2xl font-bold text-gray-900 dark:text-gray-100"},Rt={class:"overflow-x-auto"},Kt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},It={class:"divide-y divide-gray-200 bg-white dark:divide-gray-700 dark:bg-gray-900"},Vt={class:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-gray-100"},Pt={class:"px-4 py-3 text-right text-sm text-gray-900 dark:text-gray-100"},Nt={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},Mt={class:"px-4 py-3 text-right text-sm text-gray-600 dark:text-gray-400"},jt={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Dt={class:"px-4 py-3 text-right text-sm font-medium text-gray-900 dark:text-gray-100"},Ut={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},qt={key:3,class:"flex h-64 flex-col items-center justify-center text-gray-500"},Bt={__name:"ApiKeyBreakdownAnalysis",setup(A){const c=u(!1),x=u([]),y=u(""),p=u({range:"30d"}),o=u([]),m=K(()=>o.value.reduce((e,a)=>e+(a.requests||0),0)),d=K(()=>o.value.reduce((e,a)=>e+(a.totalCost||0),0)),s=e=>e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(2)+"K":(e==null?void 0:e.toString())||"0",v=e=>{if(!e)return"-";const a=new Date(e);return Number.isNaN(a.getTime())?e:`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},f=async()=>{try{const e=await _.get("/admin/accounts/usage-stats",{params:{range:"total"}});e.success&&(x.value=e.data||[])}catch{C("加载账户列表失败","error")}},g=async()=>{if(!y.value){o.value=[];return}c.value=!0;try{const e=await _.get(`/admin/accounts/${y.value}/usage-breakdown`,{params:{...p.value,limit:100}});e.success&&(o.value=e.items||[])}catch{C("加载 API Key 明细失败","error")}finally{c.value=!1}};return I(()=>{f()}),(e,a)=>(n(),i("div",pt,[t("div",mt,[t("div",vt,[a[4]||(a[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"API Key 调用明细"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 查看每个 API Key 的详细调用统计 ")],-1)),t("div",ft,[k(t("select",{"onUpdate:modelValue":a[0]||(a[0]=l=>y.value=l),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:g},[a[2]||(a[2]=t("option",{value:""},"选择账户",-1)),(n(!0),i(h,null,$(x.value,l=>(n(),i("option",{key:l.id,value:l.id},r(l.name)+" ("+r(l.platform)+") ",9,kt))),128))],544),[[b,y.value]]),k(t("select",{"onUpdate:modelValue":a[1]||(a[1]=l=>p.value.range=l),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:g},a[3]||(a[3]=[t("option",{value:"today"},"今日",-1),t("option",{value:"7days"},"7天",-1),t("option",{value:"30d"},"30天",-1),t("option",{value:"total"},"全部",-1)]),544),[[b,p.value.range]])])]),c.value?(n(),i("div",bt,a[5]||(a[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):y.value?o.value.length>0?(n(),i("div",ht,[t("div",$t,[t("div",wt,[a[7]||(a[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"API Key 总数",-1)),t("div",Ct,r(o.value.length),1)]),t("div",At,[a[8]||(a[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总请求数",-1)),t("div",Tt,r(s(m.value)),1)]),t("div",Ft,[a[9]||(a[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总成本",-1)),t("div",St," $"+r(d.value.toFixed(6)),1)])]),t("div",Rt,[t("table",Kt,[a[10]||(a[10]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," API Key "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 请求数 "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 输入Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 输出Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总Token "),t("th",{class:"px-4 py-3 text-right text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 总成本 "),t("th",{class:"px-4 py-3 text-left text-xs font-medium uppercase text-gray-500 dark:text-gray-400"}," 最后使用 ")])],-1)),t("tbody",It,[(n(!0),i(h,null,$(o.value,l=>(n(),i("tr",{key:l.apiKeyId,class:"hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Vt,r(l.apiKeyName),1),t("td",Pt,r(s(l.requests)),1),t("td",Nt,r(s(l.inputTokens)),1),t("td",Mt,r(s(l.outputTokens)),1),t("td",jt,r(s(l.totalTokens)),1),t("td",Dt," $"+r((l.totalCost||0).toFixed(6)),1),t("td",Ut,r(v(l.lastUsedAt)),1)]))),128))])])])])):(n(),i("div",qt,a[11]||(a[11]=[t("i",{class:"fas fa-inbox mb-4 text-4xl"},null,-1),t("p",null,"该账户暂无 API Key 调用数据",-1)]))):(n(),i("div",_t,a[6]||(a[6]=[t("i",{class:"fas fa-key mb-4 text-4xl"},null,-1),t("p",null,"请选择一个账户查看 API Key 调用明细",-1)])))])]))}},zt={class:"cost-trends-analysis"},Et={class:"card p-6"},Ot={class:"mb-6 flex items-center justify-between"},Gt={class:"flex gap-3"},Ht={key:0,class:"flex h-64 items-center justify-center"},Lt={key:1},Qt={class:"mb-6 h-80"},Xt={class:"grid grid-cols-1 gap-4 md:grid-cols-4"},Yt={class:"rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},Zt={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},Jt={class:"rounded-lg bg-gradient-to-br from-green-50 to-emerald-50 p-4 dark:from-green-900/20 dark:to-emerald-900/20"},Wt={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},te={class:"rounded-lg bg-gradient-to-br from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},ee={class:"mt-1 text-xl font-bold text-gray-900 dark:text-gray-100"},ae={class:"rounded-lg bg-gradient-to-br from-orange-50 to-red-50 p-4 dark:from-orange-900/20 dark:to-red-900/20"},se={__name:"CostTrendsAnalysis",setup(A){const c=B(),{isDarkMode:x}=j(c),y=u(!1),p=u(null);let o=null;const m=u({range:"30d",interval:"daily"}),d=u([]),s=K(()=>{if(d.value.length===0)return{totalCost:0,avgCost:0,maxCost:0,growthRate:0};const g=d.value.map(F=>F.cost||0),e=g.reduce((F,N)=>F+N,0),a=e/g.length,l=Math.max(...g),T=g[0]||0,V=g[g.length-1]||0,P=T>0?(V-T)/T*100:0;return{totalCost:e,avgCost:a,maxCost:l,growthRate:P}}),v=async()=>{var g;y.value=!0;try{const e=await _.get("/admin/dashboard/cost-efficiency/trends",{params:m.value});e.success&&(d.value=((g=e.data)==null?void 0:g.data)||[],f())}catch{C("加载趋势数据失败","error")}finally{y.value=!1}},f=()=>{if(!p.value||d.value.length===0)return;o&&o.destroy();const g=d.value.map(a=>a.date||a.label),e=d.value.map(a=>a.cost||0);o=new E(p.value,{type:"line",data:{labels:g,datasets:[{label:"成本",data:e,borderColor:"rgb(99, 102, 241)",backgroundColor:"rgba(99, 102, 241, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:a=>`成本: $${a.parsed.y.toFixed(6)}`}}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>`$${a.toFixed(6)}`,color:x.value?"#9ca3af":"#6b7280"},grid:{color:x.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}},x:{ticks:{color:x.value?"#9ca3af":"#6b7280"},grid:{color:x.value?"rgba(75, 85, 99, 0.3)":"rgba(0, 0, 0, 0.1)"}}}}})};return D(x,()=>{f()}),I(()=>{v()}),U(()=>{o&&o.destroy()}),(g,e)=>(n(),i("div",zt,[t("div",Et,[t("div",Ot,[e[4]||(e[4]=t("div",null,[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"成本趋势分析"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},"查看成本变化趋势和预测")],-1)),t("div",Gt,[k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>m.value.range=a),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:v},e[2]||(e[2]=[t("option",{value:"7days"},"7天",-1),t("option",{value:"30d"},"30天",-1),t("option",{value:"90d"},"90天",-1)]),544),[[b,m.value.range]]),k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>m.value.interval=a),class:"rounded-lg border border-gray-300 px-3 py-2 text-sm dark:border-gray-600 dark:bg-gray-800",onChange:v},e[3]||(e[3]=[t("option",{value:"hourly"},"按小时",-1),t("option",{value:"daily"},"按天",-1),t("option",{value:"weekly"},"按周",-1)]),544),[[b,m.value.interval]])])]),y.value?(n(),i("div",Ht,e[5]||(e[5]=[t("div",{class:"loading-spinner h-12 w-12 border-4 border-indigo-500"},null,-1)]))):(n(),i("div",Lt,[t("div",Qt,[t("canvas",{ref_key:"chartCanvas",ref:p},null,512)]),t("div",Xt,[t("div",Yt,[e[6]||(e[6]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"总成本",-1)),t("div",Zt," $"+r(s.value.totalCost.toFixed(6)),1)]),t("div",Jt,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"平均成本",-1)),t("div",Wt," $"+r(s.value.avgCost.toFixed(6)),1)]),t("div",te,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"最高成本",-1)),t("div",ee," $"+r(s.value.maxCost.toFixed(6)),1)]),t("div",ae,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"增长率",-1)),t("div",{class:w(["mt-1 text-xl font-bold",s.value.growthRate>=0?"text-red-600":"text-green-600"])},r(s.value.growthRate>=0?"+":"")+r(s.value.growthRate.toFixed(1))+"% ",3)])])]))])]))}},re={class:"analytics-container"},oe={class:"mb-6"},de={class:"border-b border-gray-200 dark:border-gray-700"},le={"aria-label":"Tabs",class:"-mb-px flex space-x-8"},ie=["onClick"],ne={class:"tab-content"},ge={class:"space-y-6"},xe={class:"space-y-6"},ce={class:"space-y-6"},ye={__name:"AnalyticsView",setup(A){const c=u("cost-efficiency"),x=[{id:"cost-efficiency",name:"账户性价比对比",icon:"fas fa-chart-line"},{id:"api-key-breakdown",name:"API Key 调用明细",icon:"fas fa-key"},{id:"cost-trends",name:"成本趋势分析",icon:"fas fa-chart-area"}];return(y,p)=>(n(),i("div",re,[p[0]||(p[0]=t("div",{class:"mb-6"},[t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"统计分析"),t("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 深度分析账户性价比、API Key 使用情况和成本趋势 ")],-1)),t("div",oe,[t("div",de,[t("nav",le,[(n(),i(h,null,$(x,o=>t("button",{key:o.id,class:w([c.value===o.id?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300","group inline-flex items-center border-b-2 px-1 py-4 text-sm font-medium transition-colors"]),onClick:m=>c.value=o.id},[t("i",{class:w([o.icon,"mr-2"])},null,2),q(" "+r(o.name),1)],10,ie)),64))])])]),t("div",ne,[k(t("div",ge,[R(ut)],512),[[S,c.value==="cost-efficiency"]]),k(t("div",xe,[R(Bt)],512),[[S,c.value==="api-key-breakdown"]]),k(t("div",ce,[R(se)],512),[[S,c.value==="cost-trends"]])])]))}},ke=z(ye,[["__scopeId","data-v-52f8346e"]]);export{ke as default};
